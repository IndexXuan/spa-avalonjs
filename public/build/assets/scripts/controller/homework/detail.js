define([],function(){var apiBaseUrl=avalon.illyGlobal&&avalon.illyGlobal.apiBaseUrl,back=(avalon.illyGlobal.token,function(){if(detail.isDone||!detail.isDoing)return void detail.clearCachedData();detail.dropCurrentDoneComfirm();var app=avalon.vmodels.app;app.$watch("yesOrNo",function(value){return value===!0?void detail.clearCachedData():void(value===!1&&(app.$unwatch("yesOrNo"),avalon.router.go("app.detail.question",{homeworkId:detail.homeworkId,questionId:avalon.vmodels.question.localAnswers.length})))})}),detail=avalon.define({$id:"detail",isDone:!1,isDoing:!1,homeworkId:1,title:"detail.js title",keyPoint:"detail.js keyPoint",keyPointRecord:"detail.js keyPointRecord",exercises:[],questionStartTime:"",wrongCollect:[],audioAnswers:[],result:{rightAward:88,finishedAward:88,totalAward:888,rightCount:15,wrongCount:0,totalScore:100},submit:function(){var spendSeconds=(Date.now()-avalon.vmodels.detail.questionStartTime)/1e3,IntSpendSeconds=parseInt(spendSeconds,10)||0;$http.ajax({method:"PUT",url:apiBaseUrl+"homework/"+detail.homeworkId+"/performance",headers:{},data:{_id:avalon.getVM("detail").homeworkId,spendSeconds:IntSpendSeconds,wrongCollect:avalon.getVM("detail").$model.wrongCollect,audioAnswers:avalon.getVM("detail").$model.audioAnswers,numOfExercise:avalon.getVM("detail").exercises.length},success:function(res){var target=avalon.vmodels.detail.$model.result;target.rightAward=res.rightAward,target.finishedAward=res.finishedAward,target.totalAward=res.totalAward,target.rightCount=res.rightCount,target.wrongCount=res.wrongCount,target.totalScore=res.totalScore,localStorage.setItem("illy-homework-last-result",JSON.stringify(res)),setTimeout(function(){avalon.router.go("app.detail.result",{homeworkId:detail.homeworkId})},16)},error:function(res){avalon.illyError("submit homework error",res),alert("对不起，作业提交失败，请退出重试！"),avalon.router.go("app.list")}})},clearCachedData:function(){var detailVM=avalon.getVM("detail");detailVM.homeworkId="",detailVM&&(detailVM.wrongCollect=[]),detailVM&&(detailVM.audioAnswers=[]);var questionVM=avalon.getVM("question");questionVM&&(questionVM.localAnswers=[]),detail.isDone=!1,detail.isDoing=!1},dropCurrentDoneComfirm:function(){var app=avalon.vmodels.app;app.showConfirm("您确定放弃本次作业？")},back:back,clearLastHomeworkData:function(){detail.homeworkId=0,detail.title="",detail.keyPoint="",detail.keyPointRecord="",detail.exercises.length=0}});return avalon.controller(function($ctrl){$ctrl.$onRendered=function(){},$ctrl.$onEnter=function(){},$ctrl.$onBeforeUnload=function(){back()},$ctrl.$vmodels=[]})});
//# sourceMappingURL=detail.js.map