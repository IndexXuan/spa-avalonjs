define([],function(){var apiBaseUrl=avalon.illyGlobal.apiBaseUrl,cachedPrefix=(avalon.illyGlobal.token,"illy-microsite-list-"),needCache=!0,localLimit=6,list=avalon.define({$id:"list",visited:!1,lists:[],categoryId:1.1111111111111111e23,offset:0,noContent:!1,isLoading:!1,noMoreData:!1,btnShowMore:!1,fetchRemoteData:function(apiArgs,data,target,concat){if(4!==arguments.length&&avalon.illyError("ERROR: must give 4 args!"+arguments),list.noMoreData=!1,list.visited&&needCache&&!concat){var articles=list.lists;return list.lists=avalon.getLocalCache(cachedPrefix+list.categoryId+"-"+target),list.offset=list.lists.length,void(articles.length>localLimit&&articles.length%localLimit<localLimit&&(list.noMoreData=!0))}list.isLoading=!0,$http.ajax({url:apiBaseUrl+apiArgs,headers:{},data:data,success:function(res){list.lists=concat===!0?list.lists.concat(res):res,0===res.length&&(list.noMoreData=!0),list.offset=list.lists.length,0===list.lists.length&&(list.noContent=!0,list.noMoreData=!0);var result=list.lists.$model;avalon.setLocalCache(cachedPrefix+list.categoryId+"-"+target,result),list.isLoading=!1},error:function(res){avalon.illyError("microsite list.js ajax error",res),0===list.lists.length&&(list.noContent=!0),list.isLoading=!1},ajaxFail:function(res){avalon.illyError("microsite list.js ajax failed",res),0===list.lists.length&&(list.noContent=!0),list.isLoading=!1}})},showMore:function(e){e.preventDefault(),list.fetchRemoteData("categories/"+list.categoryId+"/posts",{limit:localLimit,offset:list.offset},"lists",!0)}});return list.lists.$watch("length",function(newLists){void 0!==newLists&&(localLimit>newLists?list.btnShowMore=!1:"hots"!==list.categoryId&&(list.btnShowMore=!0))}),avalon.controller(function($ctrl){$ctrl.$onBeforeUnload=function(){},$ctrl.$onEnter=function(params){return list.noContent=!1,list.visited=avalon.vmodels.root.currentIsVisited,list.categoryId=params.categoryId,avalon.vmodels.site.categoryId=params.categoryId,"hots"===list.categoryId?(list.btnShowMore=!1,void list.fetchRemoteData("posts/hot?limit=10",{},"lists",!1)):void list.fetchRemoteData("categories/"+list.categoryId+"/posts",{limit:localLimit,offset:0},"lists",!1)},$ctrl.$onRendered=function(){},$ctrl.$vmodels=[]})});
//# sourceMappingURL=list.js.map