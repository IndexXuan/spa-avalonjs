define([],function(){var apiBaseUrl=avalon.illyGlobal.apiBaseUrl,token=avalon.illyGlobal.token,defaultAvatarUrl=avalon.illyGlobal.resourceBaseUrl+"images/avatar/children/default1.png?imageView2/1/w/200/h/200",site=avalon.define({$id:"site",$skipArray:["illly_domain","illy_images_base"],illy_domain:avalon.illyGlobal.illyDomain,illy_images_base:avalon.illyGlobal.imagesBaseSrc,illy_resource_base:avalon.illyGlobal.resourceBaseUrl,categoriesNames:[],categoryId:"",navBarMaskShow:!0,report:function(){avalon.vmodels.site.showAlert("感谢反馈， 我们会妥善处理!",3)},fetchAllCategoriesNames:function(){$http.ajax({url:apiBaseUrl+"categories",headers:{},success:function(res){res.unshift({_id:"hots",name:"热门文章"}),site.categoriesNames=res},error:function(res){avalon.illyError("site fetchAllCategoriesNames ajax error!",res)},ajaxFail:function(res){avalon.illyError("site fetchAllCategoriesNames ajax failed!",res)}})},renderNavigator:function(){setTimeout(function(){$("#nav").navigator(),$(".left-fixed").addClass("fixed-navigator"),$("#nav li").removeClass("ui-state-active")},32)},schoolName:"",getUserInfo:function(){$http.ajax({url:apiBaseUrl+"profile",headers:{},dataType:"json",success:function(json){site.avatar=void 0!==json.avatar?json.avatar:defaultAvatarUrl,site.displayName=json.displayName,site.score=json.score}})},getSchoolInfo:function(){$http.ajax({url:apiBaseUrl+"school",headers:{Authorization:"Bearer "+token},dataType:"json",success:function(json){site.schoolName=json.school,avalon.vmodels.root.footerInfo=json.school+" © "+(new Date).getFullYear(),site.studentCount=json.studentCount||100}})},appMessage:"I am message from app ctrl",gMaskShow:!1,gAlertShow:!1,hideDelayTimer:null,showAlert:function(message,hideDelay){var hideDelayTimer=avalon.vmodels.site.hideDelayTimer;clearTimeout(hideDelayTimer),hideDelay>=10&&avalon.illyWarning("is it too long in seconds when hide the mask?"),site.appMessage=message,site.gMaskShow=!0,site.gAlertShow=!0,void 0!==hideDelay&&(avalon.vmodels.site.hideDelayTimer=setTimeout(function(){site.hideAlert()},1e3*hideDelay))},hideAlert:function(){site.gMaskShow=!1,site.gAlertShow=!1},iKnowClick:function(){site.hideAlert()}}),flag=!0,root=avalon.vmodels.root;return avalon.vmodels.root.$watch("currentDataDone",function(rendered){var state=root.currentState;"list"===state?(flag&&(avalon.vmodels.site.navBarMaskShow=!0,flag=!1),rendered===!1?(site.navBarMaskShow=!0,setTimeout(function(){site.navBarMaskShow=!1},1e4)):setTimeout(function(){site.navBarMaskShow=!1},96)):site.navBarMaskShow=!1}),avalon.controller(function($ctrl){$ctrl.$onRendered=function(){var renderedTime=Date.now();setTimeout(function(){avalon.illyInfo("avalon rendered totalTime: ",renderedTime-avalon.initTime)},1111)},site.fetchAllCategoriesNames();var navigatorInitDelay=80;$ctrl.$onEnter=function(){avalon.clearLocalCache("illy-microsite-"),avalon.vmodels.root.$watch("currentState",function(newVal){"index"===newVal&&setTimeout(function(){$("#nav li").removeClass("ui-state-active")},navigatorInitDelay+100),avalon.$(".left-fixed").style.display="detail"===newVal?"none":"block"}),site.getSchoolInfo()},$ctrl.$onBeforeUnload=function(){},$ctrl.$vmodels=[]})});
//# sourceMappingURL=site.js.map