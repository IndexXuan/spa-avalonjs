define([],function(){var apiBaseUrl=avalon.illyGlobal.apiBaseUrl,resourcePrefix=(avalon.illyGlobal.token,avalon.illyGlobal.resourceBaseUrl),defaultAvatarUrl=resourcePrefix+"images/avatar/children/default1.png?imageView2/1/w/200/h/200",limit=6,taskList=avalon.define({$id:"taskList",noContent:!1,lists:[],avatar:"",studentCount:"",visited:!1,offset:0,btnShowMore:!0,goRank:function(){avalon.router.go("task.rank")},goMe:function(){avalon.router.go("task.me")},fetchData:function(data,concat){$http.ajax({method:"",url:apiBaseUrl+"tasks",data:data,headers:{},success:function(lists){concat?taskList.lists.concat(lists):taskList.lists=lists,setTimeout(function(){var newLists=taskList.lists;void 0!==newLists&&0===newLists.length&&(taskList.noContent=!0)},500)},error:function(res){0===taskList.lists.length&&(taskList.noContent=!0),avalon.illyError("ajax error",res)},ajaxFail:function(res){0===taskList.lists.length&&(taskList.noContent=!0),avalon.illyError("ajax failed",res)}})},showMore:function(e){e.preventDefault();var page=2;return taskList.offset<limit?void(taskList.btnShowMore=!1):(taskList.offset=taskList.offset+limit*(page-1),void taskList.fetchRemoteData({offset:taskList.offset},"concat"))},taskTypeMap:{0:"article",1:"activity"},goSpecTask:function(){var target=arguments[0],taskType=target&&target.getAttribute("data-tasktype"),taskId=target&&target.getAttribute("data-taskid"),taskScoreAward=target&&target.getAttribute("data-taskscoreaward"),state="task.detail."+taskList.taskTypeMap[taskType];setTimeout(function(){avalon.router.go(state,{taskId:taskId,scoreAward:taskScoreAward})},16)}});return avalon.controller(function($ctrl){$ctrl.$onBeforeUnload=function(){},$ctrl.$onEnter=function(){avalon.vmodels.task.$watch("score",function(newVal){(void 0!==newVal||""!==newVal)&&(taskList.avatar=resourcePrefix+avalon.vmodels.task.avatar+"?imageView2/1/w/200/h/200"||defaultAvatarUrl,taskList.studentCount=avalon.vmodels.task.studentCount||100,taskList.score=avalon.vmodels.task.score)}),taskList.visited=avalon.vmodels.root.currentIsVisited,taskList.btnShowMore=taskList.offset<=limit?!1:!0,taskList.fetchData()},$ctrl.$onRendered=function(){},$ctrl.$vmodels=[]})});
//# sourceMappingURL=taskList.js.map