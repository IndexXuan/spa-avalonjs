!function(global,factory){"object"==typeof module&&"object"==typeof module.exports?module.exports=global.document?factory(global,!0):function(w){if(!w.document)throw new Error("Avalon requires a window with a document");return factory(w)}:factory(global)}("undefined"!=typeof window?window:this,function(window,noGlobal){function log(){window.console&&avalon.config.debug&&Function.apply.call(console.log,console,arguments)}function noop(){}function oneObject(array,val){"string"==typeof array&&(array=array.match(rword)||[]);for(var result={},value=void 0!==val?val:1,i=0,n=array.length;n>i;i++)result[array[i]]=value;return result}function IE(){if(window.VBArray){var mode=document.documentMode;return mode?mode:window.XMLHttpRequest?7:6}return 0/0}function isWindow(obj){return rwindow.test(serialize.call(obj))}function _number(a,len){return a=Math.floor(a)||0,0>a?Math.max(len+a,0):Math.min(a,len)}function isArrayLike(obj){if(!obj)return!1;var n=obj.length;if(n===n>>>0){var type=serialize.call(obj).slice(8,-1);if(/(?:regexp|string|function|window|global)$/i.test(type))return!1;if("Array"===type)return!0;try{return{}.propertyIsEnumerable.call(obj,"length")===!1?/^\s?function/.test(obj.item||obj.callee):!0}catch(e){return!obj.window}}return!1}function iterator(vars,body,ret){var fun="for(var "+vars+"i=0,n = this.length; i < n; i++){"+body.replace("_","((i in this) && fn.call(scope,this[i],i,this))")+"}"+ret;return Function("fn,scope",fun)}function fixContains(root,el){try{for(;el=el.parentNode;)if(el===root)return!0;return!1}catch(e){return!1}}function outerHTML(){return(new XMLSerializer).serializeToString(this)}function enumerateNode(node,targetNode){if(node&&node.childNodes)for(var el,nodes=node.childNodes,i=0;el=nodes[i++];)if(el.tagName){var svg=DOC.createElementNS(svgns,el.tagName.toLowerCase());ap.forEach.call(el.attributes,function(attr){svg.setAttribute(attr.name,attr.value)}),enumerateNode(el,svg),targetNode.appendChild(svg)}}function fixEvent(event){var ret={};for(var i in event)ret[i]=event[i];var target=ret.target=event.srcElement;if(0===event.type.indexOf("key"))ret.which=null!=event.charCode?event.charCode:event.keyCode;else if(rmouseEvent.test(event.type)){var doc=target.ownerDocument||DOC,box="BackCompat"===doc.compatMode?doc.body:doc.documentElement;ret.pageX=event.clientX+(box.scrollLeft>>0)-(box.clientLeft>>0),ret.pageY=event.clientY+(box.scrollTop>>0)-(box.clientTop>>0),ret.wheelDeltaY=ret.wheelDelta,ret.wheelDeltaX=0}return ret.timeStamp=new Date-0,ret.originalEvent=event,ret.preventDefault=function(){event.returnValue=!1},ret.stopPropagation=function(){event.cancelBubble=!0},ret}function kernel(settings){for(var p in settings)if(ohasOwn.call(settings,p)){var val=settings[p];"function"==typeof kernel.plugins[p]?kernel.plugins[p](val):"object"==typeof kernel[p]?avalon.mix(kernel[p],val):kernel[p]=val}return this}function escapeRegExp(target){return(target+"").replace(rregexp,"\\$&")}function modelFactory(source,$special,$model){if(Array.isArray(source)){var arr=source.concat();source.length=0;var collection=arrayFactory(source);return collection.pushArray(arr),collection}if(!source||source.nodeType>0||source.$id&&source.$events)return source;var $skipArray=Array.isArray(source.$skipArray)?source.$skipArray:[];$skipArray.$special=$special||{};var $vmodel={};$model=$model||{};var $events={},accessors={},computed=[];$$skipArray.forEach(function(name){delete source[name]});var names=Object.keys(source);names.forEach(function(name,accessor){var val=source[name];if($model[name]=val,isObservable(name,val,$skipArray)){$events[name]=[];var valueType=avalon.type(val);"object"===valueType&&isFunction(val.get)&&Object.keys(val).length<=2?(accessor=makeComputedAccessor(name,val),computed.push(accessor)):accessor=rcomplexType.test(valueType)?makeComplexAccessor(name,val,valueType,$events[name],$model):makeSimpleAccessor(name,val),accessors[name]=accessor}}),$vmodel=defineProperties($vmodel,descriptorFactory(accessors),source);for(var i=0;i<names.length;i++){var name=names[i];accessors[name]||($vmodel[name]=source[name])}hideProperty($vmodel,"$id",generateID()),hideProperty($vmodel,"$model",$model),hideProperty($vmodel,"$events",$events),canHideOwn?hideProperty($vmodel,"hasOwnProperty",function(name){return name in $vmodel.$model}):$vmodel.hasOwnProperty=function(name){return name in $vmodel.$model&&"hasOwnProperty"!==name};for(i in EventBus)hideProperty($vmodel,i,EventBus[i].bind($vmodel));return $vmodel.$reinitialize=function(){computed.forEach(function(accessor){delete accessor._value,delete accessor.oldArgs,accessor.digest=function(){accessor.call($vmodel)},dependencyDetection.begin({callback:function(vm,dependency){var name=dependency._name;if(dependency!==accessor){var list=vm.$events[name];injectDependency(list,accessor.digest)}}});try{accessor.get.call($vmodel)}finally{dependencyDetection.end()}})},$vmodel.$reinitialize(),$vmodel}function hideProperty(host,name,value){canHideOwn?Object.defineProperty(host,name,{value:value,writable:!0,enumerable:!1,configurable:!0}):host[name]=value}function makeSimpleAccessor(name,value){function accessor(value){var oldValue=accessor._value;return arguments.length>0?(stopRepeatAssign||isEqual(value,oldValue)||(accessor.updateValue(this,value),accessor.notify(this,value,oldValue)),this):(dependencyDetection.collectDependency(this,accessor),oldValue)}return accessorFactory(accessor,name),accessor._value=value,accessor}function makeComputedAccessor(name,options){function accessor(value){var oldValue=accessor._value,init="_value"in accessor;if(arguments.length>0){if(stopRepeatAssign)return this;if("function"==typeof accessor.set&&accessor.oldArgs!==value){accessor.oldArgs=value;var $events=this.$events,lock=$events[name];$events[name]=[],accessor.set.call(this,value),$events[name]=lock,value=accessor.get.call(this),value!==oldValue&&(accessor.updateValue(this,value),accessor.notify(this,value,oldValue))}return this}return value=accessor.get.call(this),accessor.updateValue(this,value),init&&oldValue!==value&&accessor.notify(this,value,oldValue),value}return accessor.set=options.set,accessor.get=options.get,accessorFactory(accessor,name),accessor}function makeComplexAccessor(name,initValue,valueType,list,parentModel){function accessor(value){var oldValue=accessor._value,son=accessor._vmodel;if(arguments.length>0){if(stopRepeatAssign)return this;if("array"===valueType){var a=son,b=value,an=a.length,bn=b.length;a.$lock=!0,an>bn?a.splice(bn,an-bn):bn>an&&a.push.apply(a,b.slice(an));for(var n=Math.min(an,bn),i=0;n>i;i++)a.set(i,b[i]);delete a.$lock,a._fire("set")}else if("object"===valueType){var observes=this.$events[name]||[],newObject=avalon.mix(!0,{},value);for(i in son)son.hasOwnProperty(i)&&ohasOwn.call(newObject,i)&&(son[i]=newObject[i]);son=accessor._vmodel=modelFactory(value),son.$events[subscribers]=observes,observes.length&&observes.forEach(function(data){data.type&&(data.rollback&&data.rollback(),bindingHandlers[data.type](data,data.vmodels))})}return accessor.updateValue(this,son.$model),accessor.notify(this,this._value,oldValue),this}return dependencyDetection.collectDependency(this,accessor),son}accessorFactory(accessor,name),parentModel[name]=Array.isArray(initValue)?initValue:parentModel[name]||{};var son=accessor._vmodel=modelFactory(initValue,0,parentModel[name]);return son.$events[subscribers]=list,accessor}function globalUpdateValue(vmodel,value){vmodel.$model[this._name]=this._value=value}function globalNotify(vmodel,value,oldValue){var name=this._name,array=vmodel.$events[name];array&&(fireDependencies(array),EventBus.$fire.call(vmodel,name,value,oldValue))}function accessorFactory(accessor,name){accessor._name=name,accessor.updateValue=globalUpdateValue,accessor.notify=globalNotify}function isObservable(name,value,$skipArray){if(isFunction(value)||value&&value.nodeType)return!1;if(-1!==$skipArray.indexOf(name))return!1;var $special=$skipArray.$special;return name&&"$"===name.charAt(0)&&!$special[name]?!1:!0}function keysVM(obj){for(var arr=Object.keys(obj.$model?obj.$model:obj),i=0;i<$$skipArray.length;i++){var index=arr.indexOf($$skipArray[i]);-1!==index&&arr.splice(index,1)}return arr}function VBMediator(instance,accessors,name,value){var accessor=accessors[name];return 4!==arguments.length?accessor.call(instance):void accessor.call(instance,value)}function arrayFactory(model){var array=[];array.$id=generateID(),array.$model=model,array.$events={},array.$events[subscribers]=[],array._=modelFactory({length:model.length}),array._.$watch("length",function(a,b){array.$fire("length",a,b)});for(var i in EventBus)array[i]=EventBus[i];return avalon.mix(array,arrayPrototype),array}function mutateArray(method,pos,n,index,method2,pos2,n2){for(var oldLen=this.length,loop=2;--loop;){switch(method){case"add":var array=this.$model.slice(pos,pos+n).map(function(el){return rcomplexType.test(avalon.type(el))?el.$id?el:modelFactory(el,0,el):el});_splice.apply(this,[pos,0].concat(array)),this._fire("add",pos,n);break;case"del":var ret=this._splice(pos,n);this._fire("del",pos,n)}method2&&(method=method2,pos=pos2,n=n2,loop=2,method2=0)}return this._fire("index",index),this.length!==oldLen&&(this._.length=this.length),ret}function sortByIndex(array,indexes){for(var map={},i=0,n=indexes.length;n>i;i++){map[i]=array[i];var j=indexes[i];j in map?(array[i]=map[j],delete map[j]):array[i]=array[j]}}function injectDependency(list,data){data.oneTime||list&&avalon.Array.ensure(list,data)&&data.element&&(injectDisposeQueue(data,list),new Date-beginTime>444&&rejectDisposeQueue())}function fireDependencies(list){if(list&&list.length){new Date-beginTime>444&&"object"==typeof list[0]&&rejectDisposeQueue();for(var fn,args=aslice.call(arguments,1),i=list.length;fn=list[--i];){var el=fn.element;if(el&&el.parentNode)try{var valueFn=fn.evaluator;if(fn.$repeat)fn.handler.apply(fn,args);else if("$repeat"in fn||!valueFn)bindingHandlers[fn.type](fn,fn.vmodels);else if("on"!==fn.type){var value=valueFn.apply(0,fn.args||[]);fn.handler(value,el,fn)}}catch(e){console.log(e)}}}}function getUid(elem,makeID){return elem.uuid||makeID||(elem.uuid=++disposeCount),elem.uuid}function injectDisposeQueue(data,list){var elem=data.element;data.uuid||(data.uuid=1!==elem.nodeType?data.type+(data.pos||0)+"-"+getUid(elem.parentNode):data.name+"-"+getUid(elem));var lists=data.lists||(data.lists=[]);avalon.Array.ensure(lists,list),list.$uuid=list.$uuid||generateID(),disposeQueue[data.uuid]||(disposeQueue[data.uuid]=1,disposeQueue.push(data))}function rejectDisposeQueue(data){if(!avalon.optimize){for(var i=disposeQueue.length,n=i,allTypes=[],iffishTypes={},newInfo={};data=disposeQueue[--i];){var type=data.type;newInfo[type]?newInfo[type]++:(newInfo[type]=1,allTypes.push(type))}var diff=!1;if(allTypes.forEach(function(type){oldInfo[type]!==newInfo[type]&&(iffishTypes[type]=1,diff=!0)}),i=n,diff)for(;data=disposeQueue[--i];)if(null!==data.element){if(iffishTypes[data.type]&&shouldDispose(data.element)){disposeQueue.splice(i,1),delete disposeQueue[data.uuid];for(var list,lists=data.lists,k=0;list=lists[k++];)avalon.Array.remove(lists,list),avalon.Array.remove(list,data);disposeData(data)}}else disposeQueue.splice(i,1);oldInfo=newInfo,beginTime=new Date}}function disposeData(data){delete disposeQueue[data.uuid],data.element=null,data.rollback&&data.rollback();for(var key in data)data[key]=null}function shouldDispose(el){try{{el.parentNode.nodeType}}catch(e){return!0}return el.ifRemove&&!root.contains(el.ifRemove)&&ifGroup===el.parentNode?(el.parentNode&&el.parentNode.removeChild(el),!0):el.msRetain?0:1===el.nodeType?!root.contains(el):!avalon.contains(root,el)}function isVML(src){var nodeName=src.nodeName;return nodeName.toLowerCase()===nodeName&&src.scopeName&&""===src.outerText}function fixVML(node){"url(#default#VML)"!==node.currentStyle.behavior&&(node.style.behavior="url(#default#VML)",node.style.display="inline-block",node.style.zoom=1)}function hyphen(target){return target.replace(/([a-z\d])([A-Z]+)/g,"$1-$2").toLowerCase()}function camelize(target){return!target||target.indexOf("-")<0&&target.indexOf("_")<0?target:target.replace(/[-_][^-_]/g,function(match){return match.charAt(1).toUpperCase()})}function fakeClassList(node){if(!("classList"in node)){node.classList={node:node};for(var k in fakeClassListMethods)node.classList[k.slice(1)]=fakeClassListMethods[k]}return node.classList}function parseData(data){try{if("object"==typeof data)return data;data="true"===data?!0:"false"===data?!1:"null"===data?null:+data+""===data?+data:rbrace.test(data)?avalon.parseJSON(data):data}catch(e){}return data}function getWindow(node){return node.window&&node.document?node:9===node.nodeType?node.defaultView||node.parentWindow:!1}function showHidden(node,array){if(node.offsetWidth<=0){if(rdisplayswap.test(cssHooks["@:get"](node,"display"))){var obj={node:node};for(var name in cssShow)obj[name]=node.style[name],node.style[name]=cssShow[name];array.push(obj)}var parent=node.parentNode;parent&&1===parent.nodeType&&showHidden(parent,array)}}function getValType(elem){var ret=elem.tagName.toLowerCase();return"input"===ret&&/checkbox|radio/.test(elem.type)?"checked":ret}function addAssign(vars,scope,name,data){for(var prop,ret=[],prefix=" = "+name+".",i=vars.length;prop=vars[--i];)scope.hasOwnProperty(prop)&&(ret.push(prop+prefix+prop),data.vars.push(prop),"duplex"===data.type&&(vars.get=name+"."+prop),vars.splice(i,1));return ret}function uniqSet(array){for(var ret=[],unique={},i=0;i<array.length;i++){var el=array[i],id=el&&"string"==typeof el.$id?el.$id:el;unique[id]||(unique[id]=ret.push(el))}return ret}function parseFilter(val,filters){return filters=filters.replace(rthimRightParentheses,"").replace(rthimOtherParentheses,function(){return"],|"}).replace(rquoteFilterName,function(a,b){return"["+quote(b)}).replace(rpatchBracket,function(){return'"],["'}).replace(rthimLeftParentheses,function(){return'",'})+"]","return this.filters.$filter("+val+", "+filters+")"}function parseExpr(code,scopes,data){var dataType=data.type,filters=data.filters||"",exprId=scopes.map(function(el){return String(el.$id).replace(rproxy,"$1")})+code+dataType+filters,vars=getVariables(code).concat(),assigns=[],names=[],args=[],prefix="";scopes=uniqSet(scopes),data.vars=[];for(var i=0,sn=scopes.length;sn>i;i++)if(vars.length){var name="vm"+expose+"_"+i;names.push(name),args.push(scopes[i]),assigns.push.apply(assigns,addAssign(vars,scopes[i],name,data))}if(assigns.length||"duplex"!==dataType){"duplex"!==dataType&&(code.indexOf("||")>-1||code.indexOf("&&")>-1)&&data.vars.forEach(function(v){var reg=new RegExp("\\b"+v+"(?:\\.\\w+|\\[\\w+\\])+","ig");code=code.replace(reg,function(_,cap){var c=_.charAt(v.length),r=code.slice(cap+_.length),method=/^\s*\(/.test(r);if("."===c||"["===c||method){var name="var"+String(Math.random()).replace(/^0\./,"");if(method){var array=_.split(".");if(array.length>2){var last=array.pop();return assigns.push(name+" = "+array.join(".")),name+"."+last}return _}return assigns.push(name+" = "+_),name}return _})}),data.args=args,delete data.vars;var fn=evaluatorPool.get(exprId);if(fn)return void(data.evaluator=fn);if(prefix=assigns.join(", "),prefix&&(prefix="var "+prefix),/\S/.test(filters)){if(!/text|html/.test(data.type))throw Error("ms-"+data.type+"不支持过滤器");code="\nvar ret"+expose+" = "+code+";\r\n",code+=parseFilter("ret"+expose,filters);try{fn=Function.apply(noop,names.concat("'use strict';\n"+prefix+code)),data.evaluator=evaluatorPool.put(exprId,function(){return fn.apply(avalon,arguments)})}catch(e){log("debug: parse error,"+e.message)}return void(vars=assigns=names=null)}if("duplex"===dataType){var _body="'use strict';\nreturn function(vvv){\n	"+prefix+";\n	if(!arguments.length){\n		return "+code+"\n	}\n	"+(rduplex.test(code)?code:vars.get)+"= vvv;\n} ";try{fn=Function.apply(noop,names.concat(_body)),data.evaluator=evaluatorPool.put(exprId,fn)}catch(e){log("debug: parse error,"+e.message)}return void(vars=assigns=names=null)}if("on"===dataType){-1===code.indexOf("(")?code+=".call(this, $event)":code=code.replace("(",".call(this,"),names.push("$event"),code="\nreturn "+code+";";var lastIndex=code.lastIndexOf("\nreturn"),header=code.slice(0,lastIndex),footer=code.slice(lastIndex);code=header+"\n"+footer}else code="\nreturn "+code+";";try{fn=Function.apply(noop,names.concat("'use strict';\n"+prefix+code)),data.evaluator=evaluatorPool.put(exprId,fn)}catch(e){log("debug: parse error,"+e.message)}vars=assigns=names=null}}function stringifyExpr(code){var hasExpr=rexpr.test(code);if(hasExpr){var array=scanExpr(code);return 1===array.length?array[0].value:array.map(function(el){return el.expr?"("+el.value+")":quote(el.value)}).join(" + ")}return code}function parseExprProxy(code,scopes,data,noRegister){code=code||"",parseExpr(code,scopes,data),data.evaluator&&!noRegister&&(data.handler=bindingExecutors[data.handlerName||data.type],avalon.injectBinding(data))}function checkScan(elem,callback,innerHTML){var id=setTimeout(function(){var currHTML=elem.innerHTML;clearTimeout(id),currHTML===innerHTML?callback():checkScan(elem,callback,currHTML)})}function createSignalTower(elem,vmodel){var id=elem.getAttribute("avalonctrl")||vmodel.$id;elem.setAttribute("avalonctrl",id),vmodel.$events.expr=elem.tagName+'[avalonctrl="'+id+'"]'}function executeBindings(bindings,vmodels){for(var data,i=0;data=bindings[i++];)data.vmodels=vmodels,bindingHandlers[data.type](data,vmodels),data.evaluator&&data.element&&1===data.element.nodeType&&data.element.removeAttribute(data.name);bindings.length=0}function bindingSorter(a,b){return a.priority-b.priority}function scanAttr(elem,vmodels,match){var scanNode=!0;if(vmodels.length){for(var attr,attributes=getAttributes?getAttributes(elem):elem.attributes,bindings=[],fixAttrs=[],msData={},uniq={},i=0;attr=attributes[i++];)if(attr.specified&&(match=attr.name.match(rmsAttr))){var type=match[1],param=match[2]||"",value=attr.value,name=attr.name;if(uniq[name])continue;if(uniq[name]=1,events[type]?(param=type,type="on"):obsoleteAttrs[type]&&("enabled"===type&&(log("warning!ms-enabled或ms-attr-enabled已经被废弃"),type="disabled",value="!("+value+")"),param=type,type="attr",name="ms-"+type+"-"+param,fixAttrs.push([attr.name,name,value])),msData[name]=value,"function"==typeof bindingHandlers[type]){var newValue=value.replace(roneTime,""),oneTime=value!==newValue,binding={type:type,param:param,element:elem,name:name,value:newValue,oneTime:oneTime,uuid:name+"-"+getUid(elem),priority:(priorityMap[type]||10*type.charCodeAt(0))+(Number(param.replace(/\D/g,""))||0)};if("html"===type||"text"===type){var token=getToken(value);avalon.mix(binding,token),binding.filters=binding.filters.replace(rhasHtml,function(){return binding.type="html",binding.group=1,""})}else if("duplex"===type)var hasDuplex=name;else"ms-if-loop"===name&&(binding.priority+=100);bindings.push(binding),"widget"===type&&(elem.msData=elem.msData||msData)}}if(bindings.length){for(bindings.sort(bindingSorter),fixAttrs.forEach(function(arr){log("warning!请改用"+arr[1]+"代替"+arr[0]+"!"),elem.removeAttribute(arr[0]),elem.setAttribute(arr[1],arr[2])}),hasDuplex&&msData["ms-attr-value"]&&!elem.scopeName&&"text"===elem.type&&log("warning!一个控件不能同时定义ms-attr-value与"+hasDuplex),i=0;binding=bindings[i];i++){if(type=binding.type,rnoscanAttrBinding.test(type))return executeBindings(bindings.slice(0,i+1),vmodels);scanNode&&(scanNode=!rnoscanNodeBinding.test(type))}executeBindings(bindings,vmodels)}}scanNode&&!stopScan[elem.tagName]&&rbind.test(elem.innerHTML.replace(rlt,"<").replace(rgt,">"))&&(mergeTextNodes&&mergeTextNodes(elem),scanNodeList(elem,vmodels))}function scanNodeList(parent,vmodels){var nodes=avalon.slice(parent.childNodes);scanNodeArray(nodes,vmodels)}function scanNodeArray(nodes,vmodels){for(var node,i=0;node=nodes[i++];)switch(node.nodeType){case 1:scanTag(node,vmodels),node.msCallback&&(node.msCallback(),node.msCallback=void 0);break;case 3:rexpr.test(node.nodeValue)&&scanText(node,vmodels,i)}}function scanTag(elem,vmodels,node){var a=elem.getAttribute("ms-skip");if(!elem.getAttributeNode)return log("warning "+elem.tagName+" no getAttributeNode method");var b=elem.getAttributeNode("ms-important"),c=elem.getAttributeNode("ms-controller");if("string"!=typeof a){if(node=b||c){var newVmodel=avalon.vmodels[node.value];if(!newVmodel)return;vmodels=node===b?[newVmodel]:[newVmodel].concat(vmodels);var name=node.name;elem.removeAttribute(name),avalon(elem).removeClass(name),createSignalTower(elem,newVmodel)}scanAttr(elem,vmodels)}}function getToken(value){if(value.indexOf("|")>0){var scapegoat=value.replace(rstringLiteral,function(_){return Array(_.length+1).join("1")}),index=scapegoat.replace(r11a,"ᄢ㍄").indexOf("|");if(index>-1)return{filters:value.slice(index),value:value.slice(0,index),expr:!0}}return{value:value,filters:"",expr:!0}}function scanExpr(str){for(var value,stop,tokens=[],start=0;;){if(stop=str.indexOf(openTag,start),-1===stop)break;if(value=str.slice(start,stop),value&&tokens.push({value:value,filters:"",expr:!1}),start=stop+openTag.length,stop=str.indexOf(closeTag,start),-1===stop)break;value=str.slice(start,stop),value&&tokens.push(getToken(value,start)),start=stop+closeTag.length}return value=str.slice(start),value&&tokens.push({value:value,expr:!1,filters:""}),tokens}function scanText(textNode,vmodels,index){var bindings=[];if(tokens=scanExpr(textNode.data),tokens.length){for(var i=0;token=tokens[i++];){var node=DOC.createTextNode(token.value);token.expr&&(token.value=token.value.replace(roneTime,function(){return token.oneTime=!0,""}),token.type="text",token.element=node,token.filters=token.filters.replace(rhasHtml,function(){return token.type="html",""}),token.pos=1e3*index+i,bindings.push(token)),avalonFragment.appendChild(node)}textNode.parentNode.replaceChild(avalonFragment,textNode),bindings.length&&executeBindings(bindings,vmodels)}}function getTemplateNodes(data,id,text){var div=data.templateCache&&data.templateCache[id];if(div){for(var firstChild,dom=DOC.createDocumentFragment();firstChild=div.firstChild;)dom.appendChild(firstChild);return dom}return avalon.parseHTML(text)}function fixNull(val){return null==val?"":val}function pipe(val,data,action){return data.param.replace(/\w+/g,function(name){var hook=avalon.duplexHooks[name];hook&&"function"==typeof hook[action]&&(val=hook[action](val,data))}),val}function ticker(){for(var n=ribbon.length-1;n>=0;n--){var el=ribbon[n];el()===!1&&ribbon.splice(n,1)}ribbon.length||clearInterval(TimerID)}function shimController(data,transation,proxy,fragments){var content=data.template.cloneNode(!0),nodes=avalon.slice(content.childNodes);content.insertBefore(DOC.createComment(data.signature),content.firstChild),transation.appendChild(content);var nv=[proxy].concat(data.vmodels),fragment={nodes:nodes,vmodels:nv};fragments.push(fragment)}function getComments(data){for(var node,ret=[],nodes=data.element.parentNode.childNodes,i=0;node=nodes[i++];)if(node.nodeValue===data.signature)ret.push(node);else if(node.nodeValue===data.signature+":end")break;return ret}function sweepNodes(start,end,callback){for(;;){var node=end.previousSibling;if(!node)break;if(node.parentNode.removeChild(node),callback&&callback.call(node),node===start)break}}function withProxyFactory(){var proxy=modelFactory({$key:"",$outer:{},$host:{},$val:{get:function(){return this.$host[this.$key]},set:function(val){this.$host[this.$key]=val}}},{$val:1});return proxy.$id=generateID("$proxy$with"),proxy}function withProxyAgent(proxy,key,data){proxy=proxy||withProxyPool.pop(),proxy?proxy.$reinitialize():proxy=withProxyFactory();var host=data.$repeat;return proxy.$key=key,proxy.$host=host,proxy.$outer=data.$outer,host.$events?proxy.$events.$val=host.$events[key]:proxy.$events={},proxy}function recycleProxies(proxies){eachProxyRecycler(proxies)}function eachProxyRecycler(proxies){proxies.forEach(function(proxy){proxyRecycler(proxy,eachProxyPool)}),proxies.length=0}function eachProxyFactory(name){var source={$host:[],$outer:{},$index:0,$first:!1,$last:!1,$remove:avalon.noop};source[name]={get:function(){var e=this.$events,array=e.$index;e.$index=e[name];try{return this.$host[this.$index]}finally{e.$index=array}},set:function(val){try{var e=this.$events,array=e.$index;e.$index=[],this.$host.set(this.$index,val)}finally{e.$index=array}}};var second={$last:1,$first:1,$index:1},proxy=modelFactory(source,second);return proxy.$id=generateID("$proxy$each"),proxy}function eachProxyAgent(index,data){for(var proxy,param=data.param||"el",i=0,n=eachProxyPool.length;n>i;i++){var candidate=eachProxyPool[i];candidate&&candidate.hasOwnProperty(param)&&(proxy=candidate,eachProxyPool.splice(i,1))}proxy||(proxy=eachProxyFactory(param));var host=data.$repeat,last=host.length-1;return proxy.$index=index,proxy.$first=0===index,proxy.$last=index===last,proxy.$host=host,proxy.$outer=data.$outer,proxy.$remove=function(){return host.removeAt(proxy.$index)},proxy}function proxyRecycler(proxy,proxyPool){for(var i in proxy.$events){var arr=proxy.$events[i];Array.isArray(arr)&&(arr.forEach(function(data){"object"==typeof data&&disposeData(data)}),arr.length=0)}proxy.$host=proxy.$outer={},proxyPool.unshift(proxy)>kernel.maxRepeatSize&&proxyPool.pop()}function parseDisplay(nodeName,val){var key="_"+nodeName;if(!parseDisplay[key]){var node=DOC.createElement(nodeName);root.appendChild(node),val=W3C?getComputedStyle(node,null).display:node.currentStyle.display,root.removeChild(node),parseDisplay[key]=val}return parseDisplay[key]}function numberFormat(number,decimals,point,thousands){number=(number+"").replace(/[^0-9+\-Ee.]/g,"");var n=isFinite(+number)?+number:0,prec=isFinite(+decimals)?Math.abs(decimals):3,sep=thousands||",",dec=point||".",s="",toFixedFix=function(n,prec){var k=Math.pow(10,prec);return""+(Math.round(n*k)/k).toFixed(prec)};return s=(prec?toFixedFix(n,prec):""+Math.round(n)).split("."),s[0].length>3&&(s[0]=s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,sep)),(s[1]||"").length<prec&&(s[1]=s[1]||"",s[1]+=new Array(prec-s[1].length+1).join("0")),s.join(dec)}function doScrollCheck(){try{root.doScroll("left"),fireReady()}catch(e){setTimeout(doScrollCheck)}}var expose=new Date-0,DOC=window.document,head=DOC.getElementsByTagName("head")[0],ifGroup=head.insertBefore(document.createElement("avalon"),head.firstChild);ifGroup.innerHTML="X<style id='avalonStyle'>.avalonHide{ display: none!important }</style>",ifGroup.setAttribute("ms-skip","1"),ifGroup.className="avalonHide";var innerRequire,rnative=/\[native code\]/,subscribers="$"+expose,otherRequire=window.require,otherDefine=window.define,stopRepeatAssign=!1,rword=/[^, ]+/g,rcomplexType=/^(?:object|array)$/,rsvg=/^\[object SVG\w*Element\]$/,rwindow=/^\[object (?:Window|DOMWindow|global)\]$/,oproto=Object.prototype,ohasOwn=oproto.hasOwnProperty,serialize=oproto.toString,ap=Array.prototype,aslice=ap.slice,W3C=window.dispatchEvent,root=DOC.documentElement,avalonFragment=DOC.createDocumentFragment(),cinerator=DOC.createElement("div"),class2type={};"Boolean Number String Function Array Date RegExp Object Error".replace(rword,function(name){class2type["[object "+name+"]"]=name.toLowerCase()});var generateID=function(prefix){return prefix=prefix||"avalon",String(Math.random()+Math.random()).replace(/\d\.\d{4}/,prefix)},IEVersion=IE();avalon=function(el){return new avalon.init(el)},avalon.profile=function(){window.console&&avalon.config.profile&&Function.apply.call(console.log,console,arguments)},avalon.nextTick=new function(){function callback(){for(var n=queue.length,i=0;n>i;i++)queue[i]();queue=queue.slice(n)}var tickImmediate=window.setImmediate,tickObserver=window.MutationObserver;if(tickImmediate)return tickImmediate.bind(window);var queue=[];if(tickObserver){var node=document.createTextNode("avalon");return new tickObserver(callback).observe(node,{characterData:!0}),function(fn){queue.push(fn),node.data=Math.random()}}return window.VBArray?function(fn){queue.push(fn);var node=DOC.createElement("script");node.onreadystatechange=function(){callback(),node.onreadystatechange=null,head.removeChild(node),node=null},head.appendChild(node)}:function(fn){setTimeout(fn,4)}},avalon.init=function(el){this[0]=this.element=el},avalon.fn=avalon.prototype=avalon.init.prototype,avalon.type=function(obj){return null==obj?String(obj):"object"==typeof obj||"function"==typeof obj?class2type[serialize.call(obj)]||"object":typeof obj};var isFunction="object"==typeof alert?function(fn){try{return/^\s*\bfunction\b/.test(fn+"")}catch(e){return!1}}:function(fn){return"[object Function]"===serialize.call(fn)};avalon.isFunction=isFunction,avalon.isWindow=function(obj){return obj?obj==obj.document&&obj.document!=obj:!1},isWindow(window)&&(avalon.isWindow=isWindow);var enu;for(enu in avalon({}))break;var enumerateBUG="0"!==enu;avalon.isPlainObject=function(obj,key){if(!obj||"object"!==avalon.type(obj)||obj.nodeType||avalon.isWindow(obj))return!1;try{if(obj.constructor&&!ohasOwn.call(obj,"constructor")&&!ohasOwn.call(obj.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}if(enumerateBUG)for(key in obj)return ohasOwn.call(obj,key);for(key in obj);return void 0===key||ohasOwn.call(obj,key)},rnative.test(Object.getPrototypeOf)&&(avalon.isPlainObject=function(obj){return"[object Object]"===serialize.call(obj)&&Object.getPrototypeOf(obj)===oproto}),avalon.mix=avalon.fn.mix=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=!1;for("boolean"==typeof target&&(deep=target,target=arguments[1]||{},i++),"object"==typeof target||isFunction(target)||(target={}),i===length&&(target=this,i--);length>i;i++)if(null!=(options=arguments[i]))for(name in options){src=target[name];try{copy=options[name]}catch(e){continue}target!==copy&&(deep&&copy&&(avalon.isPlainObject(copy)||(copyIsArray=Array.isArray(copy)))?(copyIsArray?(copyIsArray=!1,clone=src&&Array.isArray(src)?src:[]):clone=src&&avalon.isPlainObject(src)?src:{},target[name]=avalon.mix(deep,clone,copy)):void 0!==copy&&(target[name]=copy))}return target},avalon.mix({rword:rword,subscribers:subscribers,version:1.46,ui:{},log:log,slice:W3C?function(nodes,start,end){return aslice.call(nodes,start,end)}:function(nodes,start,end){var ret=[],len=nodes.length;if(void 0===end&&(end=len),"number"==typeof end&&isFinite(end)){start=_number(start,len),end=_number(end,len);for(var i=start;end>i;++i)ret[i-start]=nodes[i]}return ret},noop:noop,error:function(str,e){throw(e||Error)(str)},oneObject:oneObject,range:function(start,end,step){step||(step=1),null==end&&(end=start||0,start=0);for(var index=-1,length=Math.max(0,Math.ceil((end-start)/step)),result=new Array(length);++index<length;)result[index]=start,start+=step;return result},eventHooks:[],bind:function(el,type,fn,phase){var hooks=avalon.eventHooks,hook=hooks[type];"object"==typeof hook&&(type=hook.type,hook.deel&&(fn=hook.deel(el,type,fn,phase)));var callback=W3C?fn:function(e){fn.call(el,fixEvent(e))};return W3C?el.addEventListener(type,callback,!!phase):el.attachEvent("on"+type,callback),callback},unbind:function(el,type,fn,phase){var hooks=avalon.eventHooks,hook=hooks[type],callback=fn||noop;"object"==typeof hook&&(type=hook.type,hook.deel&&(fn=hook.deel(el,type,fn,!1))),W3C?el.removeEventListener(type,callback,!!phase):el.detachEvent("on"+type,callback)},css:function(node,name,value){node instanceof avalon&&(node=node[0]);var fn,prop=/[_-]/.test(name)?camelize(name):name;if(name=avalon.cssName(prop)||prop,void 0===value||"boolean"==typeof value){fn=cssHooks[prop+":get"]||cssHooks["@:get"],"background"===name&&(name="backgroundColor");var val=fn(node,name);return value===!0?parseFloat(val)||0:val}if(""===value)node.style[name]="";else{if(null==value||value!==value)return;isFinite(value)&&!avalon.cssNumber[prop]&&(value+="px"),fn=cssHooks[prop+":set"]||cssHooks["@:set"],fn(node,name,value)}},each:function(obj,fn){if(obj){var i=0;if(isArrayLike(obj))for(var n=obj.length;n>i&&fn(i,obj[i])!==!1;i++);else for(i in obj)if(obj.hasOwnProperty(i)&&fn(i,obj[i])===!1)break;

}},getWidgetData:function(elem,prefix){var raw=avalon(elem).data(),result={};for(var i in raw)0===i.indexOf(prefix)&&(result[i.replace(prefix,"").replace(/\w/,function(a){return a.toLowerCase()})]=raw[i]);return result},Array:{ensure:function(target,item){return-1===target.indexOf(item)?target.push(item):void 0},removeAt:function(target,index){return!!target.splice(index,1).length},remove:function(target,item){var index=target.indexOf(item);return~index?avalon.Array.removeAt(target,index):!1}}});var bindingHandlers=avalon.bindingHandlers={},bindingExecutors=avalon.bindingExecutors={},Cache=new function(){function LRU(maxLength){this.size=0,this.limit=maxLength,this.head=this.tail=void 0,this._keymap={}}var p=LRU.prototype;return p.put=function(key,value){var entry={key:key,value:value};return this._keymap[key]=entry,this.tail?(this.tail.newer=entry,entry.older=this.tail):this.head=entry,this.tail=entry,this.size===this.limit?this.shift():this.size++,value},p.shift=function(){var entry=this.head;entry&&(this.head=this.head.newer,this.head.older=entry.newer=entry.older=this._keymap[entry.key]=void 0)},p.get=function(key){var entry=this._keymap[key];if(void 0!==entry)return entry===this.tail?entry.value:(entry.newer&&(entry===this.head&&(this.head=entry.newer),entry.newer.older=entry.older),entry.older&&(entry.older.newer=entry.newer),entry.newer=void 0,entry.older=this.tail,this.tail&&(this.tail.newer=entry),this.tail=entry,entry.value)},LRU};if(!"司徒正美".trim){var rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(rtrim,"")}}var hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString"),hasProtoEnumBug=function(){}.propertyIsEnumerable("prototype"),dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;if(Object.keys||(Object.keys=function(object){var theKeys=[],skipProto=hasProtoEnumBug&&"function"==typeof object;if("string"==typeof object||object&&object.callee)for(var i=0;i<object.length;++i)theKeys.push(String(i));else for(var name in object)skipProto&&"prototype"===name||!ohasOwn.call(object,name)||theKeys.push(String(name));if(hasDontEnumBug)for(var ctor=object.constructor,skipConstructor=ctor&&ctor.prototype===object,j=0;dontEnumsLength>j;j++){var dontEnum=dontEnums[j];skipConstructor&&"constructor"===dontEnum||!ohasOwn.call(object,dontEnum)||theKeys.push(dontEnum)}return theKeys}),Array.isArray||(Array.isArray=function(a){return"[object Array]"===serialize.call(a)}),noop.bind||(Function.prototype.bind=function(scope){if(arguments.length<2&&void 0===scope)return this;var fn=this,argv=arguments;return function(){var i,args=[];for(i=1;i<argv.length;i++)args.push(argv[i]);for(i=0;i<arguments.length;i++)args.push(arguments[i]);return fn.apply(scope,args)}}),rnative.test([].map)||avalon.mix(ap,{indexOf:function(item,index){var n=this.length,i=~~index;for(0>i&&(i+=n);n>i;i++)if(this[i]===item)return i;return-1},lastIndexOf:function(item,index){var n=this.length,i=null==index?n-1:index;for(0>i&&(i=Math.max(0,n+i));i>=0;i--)if(this[i]===item)return i;return-1},forEach:iterator("","_",""),filter:iterator("r=[],j=0,","if(_)r[j++]=this[i]","return r"),map:iterator("r=[],","r[i]=_","return r"),some:iterator("","if(_)return true","return false"),every:iterator("","if(!_)return false","return true")}),avalon.contains=fixContains,DOC.contains||(DOC.contains=function(b){return fixContains(DOC,b)}),window.SVGElement){DOC.createTextNode("x").contains||(Node.prototype.contains=function(arg){return!!(16&this.compareDocumentPosition(arg))});var svgns="http://www.w3.org/2000/svg",svg=DOC.createElementNS(svgns,"svg");svg.innerHTML='<circle cx="50" cy="50" r="40" fill="red" />',rsvg.test(svg.firstChild)||Object.defineProperties(SVGElement.prototype,{outerHTML:{enumerable:!0,configurable:!0,get:outerHTML,set:function(html){var tagName=this.tagName.toLowerCase(),par=this.parentNode,frag=avalon.parseHTML(html);if("svg"===tagName)par.insertBefore(frag,this);else{var newFrag=DOC.createDocumentFragment();enumerateNode(frag,newFrag),par.insertBefore(newFrag,this)}par.removeChild(this)}},innerHTML:{enumerable:!0,configurable:!0,get:function(){var s=this.outerHTML,ropen=new RegExp("<"+this.nodeName+'\\b(?:(["\'])[^"]*?(\\1)|[^>])*>',"i"),rclose=new RegExp("</"+this.nodeName+">$","i");return s.replace(ropen,"").replace(rclose,"")},set:function(html){if(avalon.clearHTML){avalon.clearHTML(this);var frag=avalon.parseHTML(html);enumerateNode(frag,this)}}}})}!root.outerHTML&&window.HTMLElement&&HTMLElement.prototype.__defineGetter__("outerHTML",outerHTML);var rmouseEvent=/^(?:mouse|contextmenu|drag)|click/,eventHooks=avalon.eventHooks;if("onmouseenter"in root||avalon.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(origType,fixType){eventHooks[origType]={type:fixType,deel:function(elem,_,fn){return function(e){var t=e.relatedTarget;return t&&(t===elem||16&elem.compareDocumentPosition(t))?void 0:(delete e.type,e.type=origType,fn.call(elem,e))}}}}),avalon.each({AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"},function(construct,fixType){window[construct]&&!eventHooks.animationend&&(eventHooks.animationend={type:fixType})}),"oninput"in DOC.createElement("input")||(eventHooks.input={type:"propertychange",deel:function(elem,_,fn){return function(e){return"value"===e.propertyName?(e.type="input",fn.call(elem,e)):void 0}}}),void 0===DOC.onmousewheel){var fixWheelType=void 0!==DOC.onwheel?"wheel":"DOMMouseScroll",fixWheelDelta="wheel"===fixWheelType?"deltaY":"detail";eventHooks.mousewheel={type:fixWheelType,deel:function(elem,_,fn){return function(e){e.wheelDeltaY=e.wheelDelta=e[fixWheelDelta]>0?-120:120,e.wheelDeltaX=0,Object.defineProperty&&Object.defineProperty(e,"type",{value:"mousewheel"}),fn.call(elem,e)}}}}var openTag,closeTag,rexpr,rexprg,rbind,rregexp=/[-.*+?^${}()|[\]\/\\]/g,plugins={loader:function(builtin){var flag=innerRequire&&builtin;window.require=flag?innerRequire:otherRequire,window.define=flag?innerRequire.define:otherDefine},interpolate:function(array){if(openTag=array[0],closeTag=array[1],openTag===closeTag)throw new SyntaxError("openTag===closeTag");var test=openTag+"test"+closeTag;if(cinerator.innerHTML=test,cinerator.innerHTML!==test&&cinerator.innerHTML.indexOf("&lt;")>-1)throw new SyntaxError("此定界符不合法");kernel.openTag=openTag,kernel.closeTag=closeTag,cinerator.innerHTML="";var o=escapeRegExp(openTag),c=escapeRegExp(closeTag);rexpr=new RegExp(o+"(.*?)"+c),rexprg=new RegExp(o+"(.*?)"+c,"g"),rbind=new RegExp(o+".*?"+c+"|\\sms-")}};kernel.debug=!0,kernel.plugins=plugins,kernel.plugins.interpolate(["{{","}}"]),kernel.paths={},kernel.shim={},kernel.maxRepeatSize=100,avalon.config=kernel;var ravalon=/(\w+)\[(avalonctrl)="(\S+)"\]/,findNodes=DOC.querySelectorAll?function(str){return DOC.querySelectorAll(str)}:function(str){for(var el,match=str.match(ravalon),all=DOC.getElementsByTagName(match[1]),nodes=[],i=0;el=all[i++];)el.getAttribute(match[2])===match[3]&&nodes.push(el);return nodes},EventBus={$watch:function(type,callback){if("function"==typeof callback){var callbacks=this.$events[type];callbacks?callbacks.push(callback):this.$events[type]=[callback]}else this.$events=this.$watch.backup;return this},$unwatch:function(type,callback){var n=arguments.length;if(0===n)this.$watch.backup=this.$events,this.$events={};else if(1===n)this.$events[type]=[];else for(var callbacks=this.$events[type]||[],i=callbacks.length;~--i<0;)if(callbacks[i]===callback)return callbacks.splice(i,1);return this},$fire:function(type){var special,i,v,callback;/^(\w+)!(\S+)$/.test(type)&&(special=RegExp.$1,type=RegExp.$2);var events=this.$events;if(events){var args=aslice.call(arguments,1),detail=[type].concat(args);if("all"===special)for(i in avalon.vmodels)v=avalon.vmodels[i],v!==this&&v.$fire.apply(v,detail);else if("up"===special||"down"===special){var elements=events.expr?findNodes(events.expr):[];if(0===elements.length)return;for(i in avalon.vmodels)if(v=avalon.vmodels[i],v!==this&&v.$events.expr){var eventNodes=findNodes(v.$events.expr);if(0===eventNodes.length)continue;ap.forEach.call(eventNodes,function(node){ap.forEach.call(elements,function(element){var ok="down"===special?element.contains(node):node.contains(element);ok&&(node._avalon=v)})})}var nodes=DOC.getElementsByTagName("*"),alls=[];for(ap.forEach.call(nodes,function(el){el._avalon&&(alls.push(el._avalon),el._avalon="",el.removeAttribute("_avalon"))}),"up"===special&&alls.reverse(),i=0;(callback=alls[i++])&&callback.$fire.apply(callback,detail)!==!1;);}else{var callbacks=events[type]||[],all=events.$all||[];for(i=0;callback=callbacks[i++];)isFunction(callback)&&callback.apply(this,args);for(i=0;callback=all[i++];)isFunction(callback)&&callback.apply(this,arguments)}}}},VMODELS=avalon.vmodels={};avalon.define=function(id,factory){var $id=id.$id||id;if($id||log("warning: vm必须指定$id"),VMODELS[$id]&&log("warning: "+$id+" 已经存在于avalon.vmodels中"),"object"==typeof id)var model=modelFactory(id);else{var scope={$watch:noop};factory(scope),model=modelFactory(scope),stopRepeatAssign=!0,factory(model),stopRepeatAssign=!1}return model.$id=$id,VMODELS[$id]=model};var $$skipArray=String("$id,$watch,$unwatch,$fire,$events,$model,$skipArray,$reinitialize").match(rword),defineProperty=Object.defineProperty,canHideOwn=!0;try{defineProperty({},"_",{value:"x"});var defineProperties=Object.defineProperties}catch(e){canHideOwn=!1}var isEqual=Object.is||function(v1,v2){return 0===v1&&0===v2?1/v1===1/v2:v1!==v1?v2!==v2:v1===v2},descriptorFactory=W3C?function(obj){var descriptors={};for(var i in obj)descriptors[i]={get:obj[i],set:obj[i],enumerable:!0,configurable:!0};return descriptors}:function(a){return a};if(!canHideOwn&&("__defineGetter__"in avalon&&(defineProperty=function(obj,prop,desc){return"value"in desc&&(obj[prop]=desc.value),"get"in desc&&obj.__defineGetter__(prop,desc.get),"set"in desc&&obj.__defineSetter__(prop,desc.set),obj},defineProperties=function(obj,descs){for(var prop in descs)descs.hasOwnProperty(prop)&&defineProperty(obj,prop,descs[prop]);return obj}),IEVersion)){var VBClassPool={};window.execScript(["Function parseVB(code)","	ExecuteGlobal(code)","End Function"].join("\n"),"VBScript"),defineProperties=function(name,accessors,properties){var buffer=[];buffer.push("\r\n	Private [__data__], [__proxy__]","	Public Default Function [__const__](d"+expose+", p"+expose+")","		Set [__data__] = d"+expose+": set [__proxy__] = p"+expose,"		Set [__const__] = Me","	End Function");for(name in properties)accessors.hasOwnProperty(name)||buffer.push("	Public ["+name+"]");$$skipArray.forEach(function(name){accessors.hasOwnProperty(name)||buffer.push("	Public ["+name+"]")}),buffer.push("	Public [hasOwnProperty]");for(name in accessors)buffer.push("	Public Property Let ["+name+"](val"+expose+")",'		Call [__proxy__](Me,[__data__], "'+name+'", val'+expose+")","	End Property","	Public Property Set ["+name+"](val"+expose+")",'		Call [__proxy__](Me,[__data__], "'+name+'", val'+expose+")","	End Property","	Public Property Get ["+name+"]","	On Error Resume Next","		Set["+name+'] = [__proxy__](Me,[__data__],"'+name+'")',"	If Err.Number <> 0 Then","		["+name+'] = [__proxy__](Me,[__data__],"'+name+'")',"	End If","	On Error Goto 0","	End Property");buffer.push("End Class");var body=buffer.join("\r\n"),className=VBClassPool[body];className||(className=generateID("VBClass"),window.parseVB("Class "+className+body),window.parseVB(["Function "+className+"Factory(a, b)","	Dim o","	Set o = (New "+className+")(a, b)","	Set "+className+"Factory = o","End Function"].join("\r\n")),VBClassPool[body]=className);var ret=window[className+"Factory"](accessors,VBMediator);return ret}}var _splice=ap.splice,arrayPrototype={_splice:_splice,_fire:function(method,a,b){fireDependencies(this.$events[subscribers],method,a,b)},size:function(){return this._.length},pushArray:function(array){var m=array.length,n=this.length;return m&&(ap.push.apply(this.$model,array),mutateArray.call(this,"add",n,m,Math.max(0,n-1))),m+n},push:function(){var i,array=[],n=arguments.length;for(i=0;n>i;i++)array[i]=arguments[i];return this.pushArray(array)},unshift:function(){var m=arguments.length,n=this.length;return m&&(ap.unshift.apply(this.$model,arguments),mutateArray.call(this,"add",0,m,0)),m+n},shift:function(){if(this.length){var el=this.$model.shift();return mutateArray.call(this,"del",0,1,0),el}},pop:function(){var n=this.length;if(n){var el=this.$model.pop();return mutateArray.call(this,"del",n-1,1,Math.max(0,n-2)),el}},splice:function(start){var change,m=arguments.length,args=[],removed=_splice.apply(this.$model,arguments);return removed.length&&(args.push("del",start,removed.length,0),change=!0),m>2&&(change?args.splice(3,1,0,"add",start,m-2):args.push("add",start,m-2,0),change=!0),change?mutateArray.apply(this,args):[]},contains:function(el){return-1!==this.indexOf(el)},remove:function(el){return this.removeAt(this.indexOf(el))},removeAt:function(index){return index>=0?(this.$model.splice(index,1),mutateArray.call(this,"del",index,1,0)):[]},clear:function(){return this.$model.length=this.length=this._.length=0,this._fire("clear",0),this},removeAll:function(all){if(Array.isArray(all))for(var i=this.length-1;i>=0;i--)-1!==all.indexOf(this[i])&&this.removeAt(i);else if("function"==typeof all)for(i=this.length-1;i>=0;i--){var el=this[i];all(el,i)&&this.removeAt(i)}else this.clear()},ensure:function(el){return this.contains(el)||this.push(el),this},set:function(index,val){if(index<this.length&&index>-1){var valueType=avalon.type(val);val&&val.$model&&(val=val.$model);var target=this[index];if("object"===valueType)for(var i in val)target.hasOwnProperty(i)&&(target[i]=val[i]);else"array"===valueType?target.clear().push.apply(target,val):target!==val&&(this[index]=val,this.$model[index]=val,this._fire("set",index,val))}return this}};"sort,reverse".replace(rword,function(method){arrayPrototype[method]=function(){var hasSort,newArray=this.$model,oldArray=newArray.concat(),mask=Math.random(),indexes=[];ap[method].apply(newArray,arguments);for(var i=0,n=oldArray.length;n>i;i++){var neo=newArray[i],old=oldArray[i];if(isEqual(neo,old))indexes.push(i);else{var index=oldArray.indexOf(neo);indexes.push(index),oldArray[index]=mask,hasSort=!0}}return hasSort&&(sortByIndex(this,indexes),this._fire("move",indexes),this._fire("index",0)),this}});var dependencyDetection=function(){var currentFrame,outerFrames=[];return{begin:function(accessorObject){outerFrames.push(currentFrame),currentFrame=accessorObject},end:function(){currentFrame=outerFrames.pop()},collectDependency:function(vmodel,accessor){currentFrame&&currentFrame.callback(vmodel,accessor)}}}(),ronduplex=/^(duplex|on)$/;avalon.injectBinding=function(data){var valueFn=data.evaluator;if(valueFn){dependencyDetection.begin({callback:function(vmodel,dependency){injectDependency(vmodel.$events[dependency._name],data)}});try{var value=ronduplex.test(data.type)?data:valueFn.apply(0,data.args);void 0===value&&delete data.evaluator,data.handler(value,data.element,data)}catch(e){log("warning:exception throwed in [avalon.injectBinding] ",e),delete data.evaluator;var node=data.element;if(3===node.nodeType){var parent=node.parentNode;kernel.commentInterpolate?parent.replaceChild(DOC.createComment(data.value),node):node.data=openTag+(data.oneTime?"::":"")+data.value+closeTag}}finally{dependencyDetection.end()}}};var disposeCount=0,disposeQueue=avalon.$$subscribers=[],beginTime=new Date,oldInfo={},tagHooks={area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],col:[2,"<table><colgroup>","</colgroup></table>"],legend:[1,"<fieldset>","</fieldset>"],option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],tr:[2,"<table>","</table>"],td:[3,"<table><tr>","</tr></table>"],g:[1,'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1">',"</svg>"],_default:W3C?[0,"",""]:[1,"X<div>","</div>"]};tagHooks.th=tagHooks.td,tagHooks.optgroup=tagHooks.option,tagHooks.tbody=tagHooks.tfoot=tagHooks.colgroup=tagHooks.caption=tagHooks.thead,String("circle,defs,ellipse,image,line,path,polygon,polyline,rect,symbol,text,use").replace(rword,function(tag){tagHooks[tag]=tagHooks.g});var rtagName=/<([\w:]+)/,rxhtml=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rcreate=W3C?/[^\d\D]/:/(<(?:script|link|style|meta|noscript))/gi,scriptTypes=oneObject(["","text/javascript","text/ecmascript","application/ecmascript","application/javascript"]),rnest=/<(?:tb|td|tf|th|tr|col|opt|leg|cap|area)/,script=DOC.createElement("script"),rhtml=/<|&#?\w+;/;avalon.parseHTML=function(html){var fragment=avalonFragment.cloneNode(!1);if("string"!=typeof html)return fragment;if(!rhtml.test(html))return fragment.appendChild(DOC.createTextNode(html)),fragment;html=html.replace(rxhtml,"<$1></$2>").trim();var firstChild,neo,tag=(rtagName.exec(html)||["",""])[1].toLowerCase(),wrap=tagHooks[tag]||tagHooks._default,wrapper=cinerator;W3C||(html=html.replace(rcreate,"<br class=msNoScope>$1")),wrapper.innerHTML=wrap[1]+html+wrap[2];var els=wrapper.getElementsByTagName("script");if(els.length)for(var el,i=0;el=els[i++];)scriptTypes[el.type]&&(neo=script.cloneNode(!1),ap.forEach.call(el.attributes,function(attr){attr&&attr.specified&&(neo[attr.name]=attr.value,neo.setAttribute(attr.name,attr.value))}),neo.text=el.text,el.parentNode.replaceChild(neo,el));if(!W3C){var target="X<div>"===wrap[1]?wrapper.lastChild.firstChild:wrapper.lastChild;if(target&&"TABLE"===target.tagName&&"tbody"!==tag)for(els=target.childNodes,i=0;el=els[i++];)if("TBODY"===el.tagName&&!el.innerHTML){target.removeChild(el);break}els=wrapper.getElementsByTagName("br");for(var n=els.length;el=els[--n];)"msNoScope"===el.className&&el.parentNode.removeChild(el);for(els=wrapper.all,i=0;el=els[i++];)isVML(el)&&fixVML(el)}for(i=wrap[0];i--;wrapper=wrapper.lastChild);for(;firstChild=wrapper.firstChild;)fragment.appendChild(firstChild);return fragment},avalon.innerHTML=function(node,html){if(!W3C&&!rcreate.test(html)&&!rnest.test(html))try{return void(node.innerHTML=html)}catch(e){}var a=this.parseHTML(html);this.clearHTML(node).appendChild(a)},avalon.clearHTML=function(node){for(node.textContent="";node.firstChild;)node.removeChild(node.firstChild);return node};var fakeClassListMethods={_toString:function(){var node=this.node,cls=node.className,str="string"==typeof cls?cls:cls.baseVal;return str.split(/\s+/).join(" ")},_contains:function(cls){return(" "+this+" ").indexOf(" "+cls+" ")>-1},_add:function(cls){this.contains(cls)||this._set(this+" "+cls)},_remove:function(cls){this._set((" "+this+" ").replace(" "+cls+" "," "))},__set:function(cls){cls=cls.trim();var node=this.node;rsvg.test(node)?node.setAttribute("class",cls):node.className=cls}};"add,remove".replace(rword,function(method){avalon.fn[method+"Class"]=function(cls){var el=this[0];return cls&&"string"==typeof cls&&el&&1===el.nodeType&&cls.replace(/\S+/g,function(c){fakeClassList(el)[method](c)}),this}}),avalon.fn.mix({hasClass:function(cls){var el=this[0]||{};return 1===el.nodeType&&fakeClassList(el).contains(cls)},toggleClass:function(value,stateVal){for(var className,i=0,classNames=String(value).split(/\s+/),isBool="boolean"==typeof stateVal;className=classNames[i++];){var state=isBool?stateVal:!this.hasClass(className);this[state?"addClass":"removeClass"](className)}return this},attr:function(name,value){return 2===arguments.length?(this[0].setAttribute(name,value),this):this[0].getAttribute(name)},data:function(name,value){switch(name="data-"+hyphen(name||""),arguments.length){case 2:return this.attr(name,value),this;case 1:var val=this.attr(name);return parseData(val);case 0:var ret={};return ap.forEach.call(this[0].attributes,function(attr){attr&&(name=attr.name,name.indexOf("data-")||(name=camelize(name.slice(5)),ret[name]=parseData(attr.value)))}),ret}},removeData:function(name){return name="data-"+hyphen(name),this[0].removeAttribute(name),this},css:function(name,value){if(avalon.isPlainObject(name))for(var i in name)avalon.css(this,i,name[i]);else var ret=avalon.css(this,name,value);return void 0!==ret?ret:this},position:function(){var offsetParent,offset,elem=this[0],parentOffset={top:0,left:0};if(elem)return"fixed"===this.css("position")?offset=elem.getBoundingClientRect():(offsetParent=this.offsetParent(),offset=this.offset(),"HTML"!==offsetParent[0].tagName&&(parentOffset=offsetParent.offset()),parentOffset.top+=avalon.css(offsetParent[0],"borderTopWidth",!0),parentOffset.left+=avalon.css(offsetParent[0],"borderLeftWidth",!0),parentOffset.top-=offsetParent.scrollTop(),parentOffset.left-=offsetParent.scrollLeft()),{top:offset.top-parentOffset.top-avalon.css(elem,"marginTop",!0),left:offset.left-parentOffset.left-avalon.css(elem,"marginLeft",!0)}},offsetParent:function(){for(var offsetParent=this[0].offsetParent;offsetParent&&"static"===avalon.css(offsetParent,"position");)offsetParent=offsetParent.offsetParent;return avalon(offsetParent||root)},bind:function(type,fn,phase){return this[0]?avalon.bind(this[0],type,fn,phase):void 0},unbind:function(type,fn,phase){return this[0]&&avalon.unbind(this[0],type,fn,phase),this},val:function(value){var node=this[0];if(node&&1===node.nodeType){var get=0===arguments.length,access=get?":get":":set",fn=valHooks[getValType(node)+access];if(fn)var val=fn(node,value);else{if(get)return(node.value||"").replace(/\r/g,"");node.value=value}}return get?val:this}});var rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rvalidchars=/^[\],:{}\s]*$/,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rvalidescape=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,rvalidtokens=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g;avalon.parseJSON=window.JSON?JSON.parse:function(data){if("string"==typeof data){if(data=data.trim(),data&&rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,"")))return new Function("return "+data)();avalon.error("Invalid JSON: "+data)}return data},avalon.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){avalon.fn[method]=function(val){var node=this[0]||{},win=getWindow(node),top="scrollTop"===method;return arguments.length?void(win?win.scrollTo(top?avalon(win).scrollLeft():val,top?val:avalon(win).scrollTop()):node[method]=val):win?prop in win?win[prop]:root[method]:node[method]}});var cssHooks=avalon.cssHooks={},prefixes=["","-webkit-","-o-","-moz-","-ms-"],cssMap={"float":W3C?"cssFloat":"styleFloat"};if(avalon.cssNumber=oneObject("animationIterationCount,columnCount,order,flex,flexGrow,flexShrink,fillOpacity,fontWeight,lineHeight,opacity,orphans,widows,zIndex,zoom"),avalon.cssName=function(name,host,camelCase){if(cssMap[name])return cssMap[name];host=host||root.style;for(var i=0,n=prefixes.length;n>i;i++)if(camelCase=camelize(prefixes[i]+name),camelCase in host)return cssMap[name]=camelCase;return null},cssHooks["@:set"]=function(node,name,value){try{node.style[name]=value}catch(e){}},window.getComputedStyle)cssHooks["@:get"]=function(node,name){if(!node||!node.style)throw new Error("getComputedStyle要求传入一个节点 "+node);var ret,styles=getComputedStyle(node,null);return styles&&(ret="filter"===name?styles.getPropertyValue(name):styles[name],""===ret&&(ret=node.style[name])),ret},cssHooks["opacity:get"]=function(node){var ret=cssHooks["@:get"](node,"opacity");return""===ret?"1":ret};else{var rnumnonpx=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,rposition=/^(top|right|bottom|left)$/,ralpha=/alpha\([^)]*\)/i,ie8=!!window.XDomainRequest,salpha="DXImageTransform.Microsoft.Alpha",border={thin:ie8?"1px":"2px",medium:ie8?"3px":"4px",thick:ie8?"5px":"6px"};cssHooks["@:get"]=function(node,name){var currentStyle=node.currentStyle,ret=currentStyle[name];if(rnumnonpx.test(ret)&&!rposition.test(ret)){var style=node.style,left=style.left,rsLeft=node.runtimeStyle.left;node.runtimeStyle.left=currentStyle.left,style.left="fontSize"===name?"1em":ret||0,ret=style.pixelLeft+"px",style.left=left,node.runtimeStyle.left=rsLeft}return"medium"===ret&&(name=name.replace("Width","Style"),"none"===currentStyle[name]&&(ret="0px")),""===ret?"auto":border[ret]||ret},cssHooks["opacity:set"]=function(node,name,value){var style=node.style,opacity=isFinite(value)&&1>=value?"alpha(opacity="+100*value+")":"",filter=style.filter||"";style.zoom=1,style.filter=(ralpha.test(filter)?filter.replace(ralpha,opacity):filter+" "+opacity).trim(),style.filter||style.removeAttribute("filter")},cssHooks["opacity:get"]=function(node){var alpha=node.filters.alpha||node.filters[salpha],op=alpha&&alpha.enabled?alpha.opacity:100;return op/100+""}}"top,left".replace(rword,function(name){cssHooks[name+":get"]=function(node){var computed=cssHooks["@:get"](node,name);return/px$/.test(computed)?computed:avalon(node).position()[name]+"px"}});var cssShow={position:"absolute",visibility:"hidden",display:"block"},rdisplayswap=/^(none|table(?!-c[ea]).+)/;"Width,Height".replace(rword,function(name){var method=name.toLowerCase(),clientProp="client"+name,scrollProp="scroll"+name,offsetProp="offset"+name;cssHooks[method+":get"]=function(node,which,override){var boxSizing=-4;"number"==typeof override&&(boxSizing=override),which="Width"===name?["Left","Right"]:["Top","Bottom"];var ret=node[offsetProp];return 2===boxSizing?ret+avalon.css(node,"margin"+which[0],!0)+avalon.css(node,"margin"+which[1],!0):(0>boxSizing&&(ret=ret-avalon.css(node,"border"+which[0]+"Width",!0)-avalon.css(node,"border"+which[1]+"Width",!0)),-4===boxSizing&&(ret=ret-avalon.css(node,"padding"+which[0],!0)-avalon.css(node,"padding"+which[1],!0)),ret)},cssHooks[method+"&get"]=function(node){var hidden=[];showHidden(node,hidden);for(var obj,val=cssHooks[method+":get"](node),i=0;obj=hidden[i++];){node=obj.node;for(var n in obj)"string"==typeof obj[n]&&(node.style[n]=obj[n])}return val},avalon.fn[method]=function(value){var node=this[0];if(0===arguments.length){if(node.setTimeout)return node["inner"+name]||node.document.documentElement[clientProp];if(9===node.nodeType){var doc=node.documentElement;return Math.max(node.body[scrollProp],doc[scrollProp],node.body[offsetProp],doc[offsetProp],doc[clientProp])}return cssHooks[method+"&get"](node)}return this.css(method,value)},avalon.fn["inner"+name]=function(){return cssHooks[method+":get"](this[0],void 0,-2)},avalon.fn["outer"+name]=function(includeMargin){return cssHooks[method+":get"](this[0],void 0,includeMargin===!0?2:0)}}),avalon.fn.offset=function(){var node=this[0],box={left:0,top:0};if(!node||!node.tagName||!node.ownerDocument)return box;var doc=node.ownerDocument,body=doc.body,root=doc.documentElement,win=doc.defaultView||doc.parentWindow;if(!avalon.contains(root,node))return box;node.getBoundingClientRect&&(box=node.getBoundingClientRect());var clientTop=root.clientTop||body.clientTop,clientLeft=root.clientLeft||body.clientLeft,scrollTop=Math.max(win.pageYOffset||0,root.scrollTop,body.scrollTop),scrollLeft=Math.max(win.pageXOffset||0,root.scrollLeft,body.scrollLeft);return{top:box.top+scrollTop-clientTop,left:box.left+scrollLeft-clientLeft}};var roption=/^<option(?:\s+\w+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s>]+))?)*\s+value[\s=]/i,valHooks={"option:get":IEVersion?function(node){return roption.test(node.outerHTML)?node.value:node.text.trim()}:function(node){return node.value},"select:get":function(node,value){for(var option,options=node.options,index=node.selectedIndex,getter=valHooks["option:get"],one="select-one"===node.type||0>index,values=one?null:[],max=one?index+1:options.length,i=0>index?max:one?index:0;max>i;i++)if(option=options[i],(option.selected||i===index)&&!option.disabled){if(value=getter(option),one)return value;values.push(value)}return values},"select:set":function(node,values,optionSet){values=[].concat(values);for(var el,getter=valHooks["option:get"],i=0;el=node.options[i++];)(el.selected=values.indexOf(getter(el))>-1)&&(optionSet=!0);optionSet||(node.selectedIndex=-1)}},meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},quote=window.JSON&&JSON.stringify||function(str){return'"'+str.replace(/[\\\"\x00-\x1f]/g,function(a){var c=meta[a];return"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"'},keywords=["break,case,catch,continue,debugger,default,delete,do,else,false","finally,for,function,if,in,instanceof,new,null,return,switch,this","throw,true,try,typeof,var,void,while,with","abstract,boolean,byte,char,class,const,double,enum,export,extends","final,float,goto,implements,import,int,interface,long,native","package,private,protected,public,short,static,super,synchronized","throws,transient,volatile","arguments,let,yield,undefined"].join(","),rrexpstr=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|[\s\t\n]*\.[\s\t\n]*[$\w\.]+/g,rsplit=/[^\w$]+/g,rkeywords=new RegExp(["\\b"+keywords.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),rnumber=/\b\d[^,]*/g,rcomma=/^,+|,+$/g,variablePool=new Cache(512),getVariables=function(code){var key=","+code.trim(),ret=variablePool.get(key);if(ret)return ret;var match=code.replace(rrexpstr,"").replace(rsplit,",").replace(rkeywords,"").replace(rnumber,"").replace(rcomma,"").split(/^$|,+/);return variablePool.put(key,uniqSet(match))},evaluatorPool=new Cache(128),rduplex=/\w\[.*\]|\w\.\w/,rproxy=/(\$proxy\$[a-z]+)\d+$/,rthimRightParentheses=/\)\s*$/,rthimOtherParentheses=/\)\s*\|/g,rquoteFilterName=/\|\s*([$\w]+)/g,rpatchBracket=/"\s*\["/g,rthimLeftParentheses=/"\s*\(/g;avalon.parseExprProxy=parseExprProxy,avalon.scan=function(elem,vmodel){elem=elem||root;var vmodels=vmodel?[].concat(vmodel):[];scanTag(elem,vmodels)};var stopScan=oneObject("area,base,basefont,br,col,command,embed,hr,img,input,link,meta,param,source,track,wbr,noscript,script,style,textarea".toUpperCase()),getBindingCallback=function(elem,name,vmodels){var callback=elem.getAttribute(name);if(callback)for(var vm,i=0;vm=vmodels[i++];)if(vm.hasOwnProperty(callback)&&"function"==typeof vm[callback])return vm[callback]},mergeTextNodes=IEVersion&&window.MutationObserver?function(elem){for(var text,node=elem.firstChild;node;){var aaa=node.nextSibling;3===node.nodeType?text?(text.nodeValue+=node.nodeValue,elem.removeChild(node)):text=node:text=null,node=aaa}}:0,roneTime=/^\s*::/,rmsAttr=/ms-(\w+)-?(.*)/,priorityMap={"if":10,repeat:90,data:100,widget:110,each:1400,"with":1500,duplex:2e3,on:3e3},events=oneObject("animationend,blur,change,input,click,dblclick,focus,keydown,keypress,keyup,mousedown,mouseenter,mouseleave,mousemove,mouseout,mouseover,mouseup,scan,scroll,submit"),obsoleteAttrs=oneObject("value,title,alt,checked,selected,disabled,readonly,enabled"),rnoscanAttrBinding=/^if|widget|repeat$/,rnoscanNodeBinding=/^each|with|html|include$/;if(!W3C)var attrPool=new Cache(512),rattrs=/\s+(ms-[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,rquote=/^['"]/,rtag=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/i,ramp=/&amp;/g,getAttributes=function(elem){var html=elem.outerHTML;if("</"===html.slice(0,2)||!html.trim())return[];var match,k,v,str=html.match(rtag)[0],attributes=[],ret=attrPool.get(str);if(ret)return ret;for(;k=rattrs.exec(str);){v=k[2],v&&(v=(rquote.test(v)?v.slice(1,-1):v).replace(ramp,"&"));var name=k[1].toLowerCase();match=name.match(rmsAttr);var binding={name:name,specified:!0,value:v||""};attributes.push(binding)}return attrPool.put(str,attributes)};var rhasHtml=/\|\s*html(?:\b|$)/,r11a=/\|\|/g,rlt=/&lt;/g,rgt=/&gt;/g,rstringLiteral=/(['"])(\\\1|.)+?\1/g,bools=["autofocus,autoplay,async,allowTransparency,checked,controls","declare,disabled,defer,defaultChecked,defaultSelected","contentEditable,isMap,loop,multiple,noHref,noResize,noShade","open,readOnly,selected"].join(","),boolMap={};bools.replace(rword,function(name){boolMap[name.toLowerCase()]=name});var propMap={"accept-charset":"acceptCharset","char":"ch",charoff:"chOff","class":"className","for":"htmlFor","http-equiv":"httpEquiv"},anomaly=["accessKey,bgColor,cellPadding,cellSpacing,codeBase,codeType,colSpan","dateTime,defaultValue,frameBorder,longDesc,maxLength,marginWidth,marginHeight","rowSpan,tabIndex,useMap,vSpace,valueType,vAlign"].join(",");

anomaly.replace(rword,function(name){propMap[name.toLowerCase()]=name});var rnoscripts=/<noscript.*?>(?:[\s\S]+?)<\/noscript>/gim,rnoscriptText=/<noscript.*?>([\s\S]+?)<\/noscript>/im,getXHR=function(){return new(window.XMLHttpRequest||ActiveXObject)("Microsoft.XMLHTTP")},templatePool=avalon.templateCache={};bindingHandlers.attr=function(data,vmodels){var value=stringifyExpr(data.value.trim());if("include"===data.type){var elem=data.element;data.includeRendered=getBindingCallback(elem,"data-include-rendered",vmodels),data.includeLoaded=getBindingCallback(elem,"data-include-loaded",vmodels);var outer=data.includeReplace=!!avalon(elem).data("includeReplace");avalon(elem).data("includeCache")&&(data.templateCache={}),data.startInclude=DOC.createComment("ms-include"),data.endInclude=DOC.createComment("ms-include-end"),outer?(data.element=data.startInclude,elem.parentNode.insertBefore(data.startInclude,elem),elem.parentNode.insertBefore(data.endInclude,elem.nextSibling)):(elem.insertBefore(data.startInclude,elem.firstChild),elem.appendChild(data.endInclude))}data.handlerName="attr",parseExprProxy(value,vmodels,data)},bindingExecutors.attr=function(val,elem,data){var method=data.type,attrName=data.param;if("css"===method)avalon(elem).css(attrName,val);else if("attr"===method){var toRemove=val===!1||null===val||void 0===val;!W3C&&propMap[attrName]&&(attrName=propMap[attrName]);var bool=boolMap[attrName];if("boolean"==typeof elem[bool]&&(elem[bool]=!!val,val||(toRemove=!0)),toRemove)return elem.removeAttribute(attrName);var isInnate=rsvg.test(elem)?!1:DOC.namespaces&&isVML(elem)?!0:attrName in elem.cloneNode(!1);isInnate?elem[attrName]=val+"":elem.setAttribute(attrName,val)}else if("include"===method&&val){var vmodels=data.vmodels,rendered=data.includeRendered,loaded=data.includeLoaded,replace=data.includeReplace,target=replace?elem.parentNode:elem,scanTemplate=function(text){if(loaded){var newText=loaded.apply(target,[text].concat(vmodels));"string"==typeof newText&&(text=newText)}rendered&&checkScan(target,function(){rendered.call(target)},0/0);var lastID=data.includeLastID;if(data.templateCache&&lastID&&lastID!==val){var lastTemplate=data.templateCache[lastID];lastTemplate||(lastTemplate=data.templateCache[lastID]=DOC.createElement("div"),ifGroup.appendChild(lastTemplate))}for(data.includeLastID=val;;){var node=data.startInclude.nextSibling;if(!node||node===data.endInclude)break;target.removeChild(node),lastTemplate&&lastTemplate.appendChild(node)}var dom=getTemplateNodes(data,val,text),nodes=avalon.slice(dom.childNodes);target.insertBefore(dom,data.endInclude),scanNodeArray(nodes,vmodels)};if("src"===data.param)if("string"==typeof templatePool[val])avalon.nextTick(function(){scanTemplate(templatePool[val])});else if(Array.isArray(templatePool[val]))templatePool[val].push(scanTemplate);else{var xhr=getXHR();xhr.onreadystatechange=function(){if(4===xhr.readyState){var s=xhr.status;if(s>=200&&300>s||304===s||1223===s){for(var fn,text=xhr.responseText,f=0;fn=templatePool[val][f++];)fn(text);templatePool[val]=text}}},templatePool[val]=[scanTemplate],xhr.open("GET",val,!0),"withCredentials"in xhr&&(xhr.withCredentials=!0),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.send(null)}else{var el=val&&1===val.nodeType?val:DOC.getElementById(val);if(el){if("NOSCRIPT"===el.tagName&&!el.innerHTML&&!el.fixIE78){xhr=getXHR(),xhr.open("GET",location,!1),xhr.send(null);for(var noscripts=DOC.getElementsByTagName("noscript"),array=(xhr.responseText||"").match(rnoscripts)||[],n=array.length,i=0;n>i;i++){var tag=noscripts[i];tag&&(tag.style.display="none",tag.fixIE78=(array[i].match(rnoscriptText)||["","&nbsp;"])[1])}}avalon.nextTick(function(){scanTemplate(el.fixIE78||el.value||el.innerText||el.innerHTML)})}}}else if(root.hasAttribute||"string"!=typeof val||"src"!==method&&"href"!==method||(val=val.replace(/&amp;/g,"&")),elem[method]=val,window.chrome&&"EMBED"===elem.tagName){var parent=elem.parentNode,comment=document.createComment("ms-src");parent.replaceChild(comment,elem),parent.replaceChild(elem,comment)}},"title,alt,src,value,css,include,href".replace(rword,function(name){bindingHandlers[name]=bindingHandlers.attr}),bindingHandlers["class"]=function(binding,vmodels){var rightExpr,oldStyle=binding.param,text=binding.value;if(binding.handlerName="class",!oldStyle||isFinite(oldStyle)){binding.param="";var colonIndex=text.replace(rexprg,function(a){return a.replace(/./g,"0")}).indexOf(":");if(-1===colonIndex){var className=text;rightExpr=!0}else className=text.slice(0,colonIndex),rightExpr=text.slice(colonIndex+1);className=rexpr.test(text)?stringifyExpr(className):quote(className),binding.expr="["+className+","+rightExpr+"]"}else binding.expr="["+quote(oldStyle)+","+text+"]",binding.oldStyle=oldStyle;var method=binding.type;if("hover"===method||"active"===method){if(!binding.hasBindEvent){var elem=binding.element,$elem=avalon(elem),activate="mouseenter",abandon="mouseleave";if("active"===method){elem.tabIndex=elem.tabIndex||-1,activate="mousedown",abandon="mouseup";var fn0=$elem.bind("mouseleave",function(){binding.toggleClass&&$elem.removeClass(binding.newClass)})}}var fn1=$elem.bind(activate,function(){binding.toggleClass&&$elem.addClass(binding.newClass)}),fn2=$elem.bind(abandon,function(){binding.toggleClass&&$elem.removeClass(binding.newClass)});binding.rollback=function(){$elem.unbind("mouseleave",fn0),$elem.unbind(activate,fn1),$elem.unbind(abandon,fn2)},binding.hasBindEvent=!0}parseExprProxy(binding.expr,vmodels,binding)},bindingExecutors["class"]=function(arr,elem,binding){var $elem=avalon(elem);binding.newClass=arr[0],binding.toggleClass=!!arr[1],binding.oldClass&&binding.newClass!==binding.oldClass&&$elem.removeClass(binding.oldClass),binding.oldClass=binding.newClass,"class"===binding.type&&(binding.oldStyle?$elem.toggleClass(binding.oldStyle,!!arr[1]):$elem.toggleClass(binding.newClass,binding.toggleClass))},"hover,active".replace(rword,function(method){bindingHandlers[method]=bindingHandlers["class"]}),bindingExecutors.data=function(val,elem,data){var key="data-"+data.param;val&&"object"==typeof val?elem[key]=val:elem.setAttribute(key,String(val))};var duplexBinding=bindingHandlers.duplex=function(data,vmodels){var hasCast,elem=data.element;if(parseExprProxy(data.value,vmodels,data,1),data.changed=getBindingCallback(elem,"data-duplex-changed",vmodels)||noop,data.evaluator&&data.args){var params=[],casting=oneObject("string,number,boolean,checked");"radio"===elem.type&&""===data.param&&(data.param="checked"),elem.msData&&(elem.msData["ms-duplex"]=data.value),data.param.replace(/\w+/g,function(name){/^(checkbox|radio)$/.test(elem.type)&&/^(radio|checked)$/.test(name)&&("radio"===name&&log("ms-duplex-radio已经更名为ms-duplex-checked"),name="checked",data.isChecked=!0),"bool"===name?(name="boolean",log("ms-duplex-bool已经更名为ms-duplex-boolean")):"text"===name&&(name="string",log("ms-duplex-text已经更名为ms-duplex-string")),casting[name]&&(hasCast=!0),avalon.Array.ensure(params,name)}),hasCast||params.push("string"),data.param=params.join("-"),data.bound=function(type,callback){elem.addEventListener?elem.addEventListener(type,callback,!1):elem.attachEvent("on"+type,callback);var old=data.rollback;data.rollback=function(){elem.avalonSetter=null,avalon.unbind(elem,type,callback),old&&old()}};for(var i in avalon.vmodels){var v=avalon.vmodels[i];v.$fire("avalon-ms-duplex-init",data)}var cpipe=data.pipe||(data.pipe=pipe);cpipe(null,data,"init");var tagName=elem.tagName;duplexBinding[tagName]&&duplexBinding[tagName](elem,data.evaluator.apply(null,data.args),data)}};avalon.duplexHooks={checked:{get:function(val,data){return!data.element.oldValue}},string:{get:function(val){return val},set:fixNull},"boolean":{get:function(val){return"true"===val},set:fixNull},number:{get:function(val,data){var number=parseFloat(val);if(-val===-number)return number;var arr=/strong|medium|weak/.exec(data.element.getAttribute("data-duplex-number"))||["medium"];switch(arr[0]){case"strong":return 0;case"medium":return""===val?"":0;case"weak":return val}},set:fixNull}};var TimerID,ribbon=[];avalon.tick=function(fn){1===ribbon.push(fn)&&(TimerID=setInterval(ticker,60))};var watchValueInTimer=noop,rmsinput=/text|password|hidden/;!new function(){function newSetter(value){setters[this.tagName].call(this,value),rmsinput.test(this.type)&&!this.msFocus&&this.avalonSetter&&this.avalonSetter()}try{var setters={},aproto=HTMLInputElement.prototype,bproto=HTMLTextAreaElement.prototype,inputProto=HTMLInputElement.prototype;Object.getOwnPropertyNames(inputProto),setters.INPUT=Object.getOwnPropertyDescriptor(aproto,"value").set,Object.defineProperty(aproto,"value",{set:newSetter}),setters.TEXTAREA=Object.getOwnPropertyDescriptor(bproto,"value").set,Object.defineProperty(bproto,"value",{set:newSetter})}catch(e){watchValueInTimer=avalon.tick}},IEVersion&&avalon.bind(DOC,"selectionchange",function(){var el=DOC.activeElement;el&&"function"==typeof el.avalonSetter&&el.avalonSetter()}),duplexBinding.INPUT=function(element,evaluator,data){function callback(value){data.changed.call(this,value,data)}function compositionStart(){composing=!0}function compositionEnd(){composing=!1}function delay(e){setTimeout(function(){updateVModel(e)})}var $type=element.type,bound=data.bound,$elem=avalon(element),composing=!1,updateVModel=function(){var val=element.value;if(!composing&&val!==element.oldValue){var lastValue=data.pipe(val,data,"get");$elem.data("duplexObserve")!==!1&&(evaluator(lastValue),callback.call(element,lastValue))}};if(data.handler=function(){var val=data.pipe(evaluator(),data,"set")+"";val!==element.oldValue&&(element.value=element.oldValue=val)},data.isChecked||"radio"===$type){var IE6=6===IEVersion;updateVModel=function(){if($elem.data("duplexObserve")!==!1){var lastValue=data.pipe(element.value,data,"get");evaluator(lastValue),callback.call(element,lastValue)}},data.handler=function(){var val=evaluator(),checked=data.isChecked?!!val:val+""===element.value;element.oldValue=checked,IE6?setTimeout(function(){element.defaultChecked=checked,element.checked=checked},31):element.checked=checked},bound("click",updateVModel)}else if("checkbox"===$type)updateVModel=function(){if($elem.data("duplexObserve")!==!1){var method=element.checked?"ensure":"remove",array=evaluator();Array.isArray(array)||(log("ms-duplex应用于checkbox上要对应一个数组"),array=[array]);var val=data.pipe(element.value,data,"get");avalon.Array[method](array,val),callback.call(element,array)}},data.handler=function(){var array=[].concat(evaluator()),val=data.pipe(element.value,data,"get");element.checked=array.indexOf(val)>-1},bound(W3C?"change":"click",updateVModel);else{var events=element.getAttribute("data-duplex-event")||"input";element.attributes["data-event"]&&log("data-event指令已经废弃，请改用data-duplex-event"),events.replace(rword,function(name){switch(name){case"input":IEVersion?(IEVersion>8?bound("input",updateVModel):bound("propertychange",function(e){"value"===e.propertyName&&updateVModel()}),bound("dragend",delay)):(bound("input",updateVModel),bound("compositionstart",compositionStart),bound("compositionend",compositionEnd),bound("DOMAutoComplete",updateVModel));break;default:bound(name,updateVModel)}}),bound("focus",function(){element.msFocus=!0}),bound("blur",function(){element.msFocus=!1}),rmsinput.test($type)&&watchValueInTimer(function(){if(root.contains(element))element.msFocus||element.oldValue===element.value||updateVModel();else if(!element.msRetain)return!1}),element.avalonSetter=updateVModel}element.oldValue=element.value,avalon.injectBinding(data),callback.call(element,element.value)},duplexBinding.TEXTAREA=duplexBinding.INPUT,duplexBinding.SELECT=function(element,evaluator,data){function updateVModel(){if($elem.data("duplexObserve")!==!1){var val=$elem.val();val=Array.isArray(val)?val.map(function(v){return data.pipe(v,data,"get")}):data.pipe(val,data,"get"),val+""!==element.oldValue&&evaluator(val),data.changed.call(element,val,data)}}var $elem=avalon(element);data.handler=function(){var val=evaluator();val=val&&val.$model||val,Array.isArray(val)?element.multiple||log("ms-duplex在<select multiple=true>上要求对应一个数组"):element.multiple&&log("ms-duplex在<select multiple=false>不能对应一个数组"),val=Array.isArray(val)?val.map(String):val+"",val+""!==element.oldValue&&($elem.val(val),element.oldValue=val+"")},data.bound("change",updateVModel),element.msCallback=function(){avalon.injectBinding(data),data.changed.call(element,evaluator(),data)}},bindingExecutors.html=function(val,elem,data){var isHtmlFilter=1!==elem.nodeType,parent=isHtmlFilter?elem.parentNode:elem;if(parent&&(val=null==val?"":val,data.oldText!==val)){if(data.oldText=val,3===elem.nodeType){var signature=generateID("html");parent.insertBefore(DOC.createComment(signature),elem),data.element=DOC.createComment(signature+":end"),parent.replaceChild(data.element,elem),elem=data.element}if("object"!=typeof val)var fragment=avalon.parseHTML(String(val));else if(11===val.nodeType)fragment=val;else if(1===val.nodeType||val.item){var nodes=1===val.nodeType?val.childNodes:val.item;for(fragment=avalonFragment.cloneNode(!0);nodes[0];)fragment.appendChild(nodes[0])}if(nodes=avalon.slice(fragment.childNodes),isHtmlFilter){for(var endValue=elem.nodeValue.slice(0,-4);;){var node=elem.previousSibling;if(!node||8===node.nodeType&&node.nodeValue===endValue)break;parent.removeChild(node)}parent.insertBefore(fragment,elem)}else avalon.clearHTML(elem).appendChild(fragment);scanNodeArray(nodes,data.vmodels)}},bindingHandlers["if"]=bindingHandlers.data=bindingHandlers.text=bindingHandlers.html=function(data,vmodels){parseExprProxy(data.value,vmodels,data)},bindingExecutors["if"]=function(val,elem,data){try{if(!elem.parentNode)return}catch(e){return}if(val)8===elem.nodeType&&(elem.parentNode.replaceChild(data.template,elem),elem.ifRemove=null,elem=data.element=data.template),elem.getAttribute(data.name)&&(elem.removeAttribute(data.name),scanAttr(elem,data.vmodels)),data.rollback=null;else if(1===elem.nodeType){var node=data.element=DOC.createComment("ms-if");elem.parentNode.replaceChild(node,elem),elem.ifRemove=node,data.template=elem,ifGroup.appendChild(elem),data.rollback=function(){elem.parentNode===ifGroup&&ifGroup.removeChild(elem)}}};var rdash=/\(([^)]*)\)/;bindingHandlers.on=function(data,vmodels){var value=data.value;data.type="on";var eventType=data.param.replace(/-\d+$/,"");if("function"==typeof bindingHandlers.on[eventType+"Hook"]&&bindingHandlers.on[eventType+"Hook"](data),value.indexOf("(")>0&&value.indexOf(")")>-1){var matched=(value.match(rdash)||["",""])[1].trim();(""===matched||"$event"===matched)&&(value=value.replace(rdash,""))}parseExprProxy(value,vmodels,data)},bindingExecutors.on=function(callback,elem,data){callback=function(e){var fn=data.evaluator||noop;return fn.apply(this,data.args.concat(e))};var eventType=data.param.replace(/-\d+$/,"");if("scan"===eventType)callback.call(elem,{type:eventType});else if("function"==typeof data.specialBind)data.specialBind(elem,callback);else var removeFn=avalon.bind(elem,eventType,callback);data.rollback=function(){"function"==typeof data.specialUnbind?data.specialUnbind():avalon.unbind(elem,eventType,removeFn)}},bindingHandlers.repeat=function(data,vmodels){var type=data.type;parseExprProxy(data.value,vmodels,data,1),data.proxies=[];var freturn=!1;try{var $repeat=data.$repeat=data.evaluator.apply(0,data.args||[]),xtype=avalon.type($repeat);"object"!==xtype&&"array"!==xtype?(freturn=!0,avalon.log("warning:"+data.value+"只能是对象或数组")):data.xtype=xtype}catch(e){freturn=!0}var arr=data.value.split(".")||[];if(arr.length>1){arr.pop();for(var v,n=arr[0],i=0;v=vmodels[i++];)if(v&&v.hasOwnProperty(n)){var events=v[n].$events||{};events[subscribers]=events[subscribers]||[],events[subscribers].push(data);break}}var elem=data.element;if(1===elem.nodeType){elem.removeAttribute(data.name),data.sortedCallback=getBindingCallback(elem,"data-with-sorted",vmodels),data.renderedCallback=getBindingCallback(elem,"data-"+type+"-rendered",vmodels);var signature=generateID(type),start=DOC.createComment(signature),end=DOC.createComment(signature+":end");if(data.signature=signature,data.template=avalonFragment.cloneNode(!1),"repeat"===type){var parent=elem.parentNode;parent.replaceChild(end,elem),parent.insertBefore(start,end),data.template.appendChild(elem)}else{for(;elem.firstChild;)data.template.appendChild(elem.firstChild);elem.appendChild(start),elem.appendChild(end)}data.element=end,data.handler=bindingExecutors.repeat,data.rollback=function(){var elem=data.element;elem&&data.handler("clear")}}if(!freturn){data.$outer={};var check0="$key",check1="$val";for(Array.isArray($repeat)&&(check0="$first",check1="$last"),i=0;v=vmodels[i++];)if(v.hasOwnProperty(check0)&&v.hasOwnProperty(check1)){data.$outer=v;break}var $events=$repeat.$events,$list=($events||{})[subscribers];injectDependency($list,data),"object"===xtype?data.handler("append"):$repeat.length&&data.handler("add",0,$repeat.length)}},bindingExecutors.repeat=function(method,pos,el){var data=this;if(!method&&data.xtype){var old=data.$repeat,neo=data.evaluator.apply(0,data.args||[]);if("array"===data.xtype){if(old.length===neo.length)return;method="add",pos=0,data.$repeat=neo,el=neo.length}else{if(keysVM(old).join(";;")===keysVM(neo).join(";;"))return;method="append",data.$repeat=neo}}if(method){var start,fragment,end=data.element,comments=getComments(data),parent=end.parentNode,proxies=data.proxies,transation=avalonFragment.cloneNode(!1);switch(method){case"add":for(var n=pos+el,fragments=[],i=pos;n>i;i++){var proxy=eachProxyAgent(i,data);proxies.splice(i,0,proxy),shimController(data,transation,proxy,fragments)}for(parent.insertBefore(transation,comments[pos]||end),i=0;fragment=fragments[i++];)scanNodeArray(fragment.nodes,fragment.vmodels),fragment.nodes=fragment.vmodels=null;break;case"del":sweepNodes(comments[pos],comments[pos+el]||end);var removed=proxies.splice(pos,el);recycleProxies(removed,"each");break;case"clear":start=comments[0],start&&(sweepNodes(start,end),"object"===data.xtype?parent.insertBefore(start,end):recycleProxies(proxies,"each"));break;case"move":if(start=comments[0]){var node,signature=start.nodeValue,rooms=[],room=[];for(sweepNodes(start,end,function(){room.unshift(this),this.nodeValue===signature&&(rooms.unshift(room),room=[])}),sortByIndex(rooms,pos),sortByIndex(proxies,pos);room=rooms.shift();)for(;node=room.shift();)transation.appendChild(node);parent.insertBefore(transation,end)}break;case"index":for(var last=proxies.length-1;el=proxies[pos];pos++)el.$index=pos,el.$first=0===pos,el.$last=pos===last;return;case"set":proxy=proxies[pos],proxy&&fireDependencies(proxy.$events[data.param||"el"]);break;case"append":var object=data.$repeat,pool=Array.isArray(proxies)||!proxies?{}:proxies;data.proxies=pool;var keys=[];fragments=[];for(var key in pool)object.hasOwnProperty(key)||(proxyRecycler(pool[key],withProxyPool),delete pool[key]);for(key in object)object.hasOwnProperty(key)&&"hasOwnProperty"!==key&&keys.push(key);if(data.sortedCallback){var keys2=data.sortedCallback.call(parent,keys);keys2&&Array.isArray(keys2)&&keys2.length&&(keys=keys2)}for(i=0;key=keys[i++];)"hasOwnProperty"!==key&&(pool[key]=withProxyAgent(pool[key],key,data),shimController(data,transation,pool[key],fragments));for(parent.insertBefore(transation,end),i=0;fragment=fragments[i++];)scanNodeArray(fragment.nodes,fragment.vmodels),fragment.nodes=fragment.vmodels=null}if(!data.$repeat||data.$repeat.hasOwnProperty("$lock"))return;"clear"===method&&(method="del");var callback=data.renderedCallback||noop,args=arguments;parent.oldValue&&"SELECT"===parent.tagName&&avalon(parent).val(parent.oldValue.split(",")),callback.apply(parent,args)}},"with,each".replace(rword,function(name){bindingHandlers[name]=bindingHandlers.repeat});var withProxyPool=[],eachProxyPool=[];bindingExecutors.text=function(val,elem){if(val=null==val?"":val,3===elem.nodeType)try{elem.data=val}catch(e){}else"textContent"in elem?elem.textContent=val:elem.innerText=val},avalon.parseDisplay=parseDisplay,bindingHandlers.visible=function(data,vmodels){parseExprProxy(data.value,vmodels,data)},bindingExecutors.visible=function(val,elem,binding){val?(elem.style.display=binding.display||"","none"===avalon(elem).css("display")&&(elem.style.display=binding.display=parseDisplay(elem.nodeName))):elem.style.display="none"},bindingHandlers.widget=function(data,vmodels){var args=data.value.match(rword),elem=data.element,widget=args[0],id=args[1];id&&"$"!==id||(id=generateID(widget));var optName=args[2]||widget,constructor=avalon.ui[widget];if("function"==typeof constructor){vmodels=elem.vmodels||vmodels;for(var v,i=0;v=vmodels[i++];)if(v.hasOwnProperty(optName)&&"object"==typeof v[optName]){var vmOptions=v[optName];vmOptions=vmOptions.$model||vmOptions;break}if(vmOptions){var wid=vmOptions[widget+"Id"];"string"==typeof wid&&(log("warning!不再支持"+widget+"Id"),id=wid)}var widgetData=avalon.getWidgetData(elem,widget);data.value=[widget,id,optName].join(","),data[widget+"Id"]=id,data.evaluator=noop,elem.msData["ms-widget-id"]=id;var options=data[widget+"Options"]=avalon.mix({},constructor.defaults,vmOptions||{},widgetData);elem.removeAttribute("ms-widget");var vmodel=constructor(elem,data,vmodels)||{};if(vmodel.$id){avalon.vmodels[id]=vmodel,createSignalTower(elem,vmodel);try{vmodel.$init(function(){avalon.scan(elem,[vmodel].concat(vmodels)),"function"==typeof options.onInit&&options.onInit.call(elem,vmodel,options,vmodels)})}catch(e){}data.rollback=function(){try{vmodel.$remove(),vmodel.widgetElement=null}catch(e){}elem.msData={},delete avalon.vmodels[vmodel.$id]},injectDisposeQueue(data,widgetList),window.chrome&&elem.addEventListener("DOMNodeRemovedFromDocument",function(){setTimeout(rejectDisposeQueue)})}else avalon.scan(elem,vmodels)}else vmodels.length&&(elem.vmodels=vmodels)};var widgetList=[],rscripts=/<script[^>]*>([\S\s]*?)<\/script\s*>/gim,ron=/\s+(on[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,ropen=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/gi,rsanitize={a:/\b(href)\=("javascript[^"]*"|'javascript[^']*')/gi,img:/\b(src)\=("javascript[^"]*"|'javascript[^']*')/gi,form:/\b(action)\=("javascript[^"]*"|'javascript[^']*')/gi},rsurrogate=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,rnoalphanumeric=/([^\#-~| |!])/g,filters=avalon.filters={uppercase:function(str){return str.toUpperCase()},lowercase:function(str){return str.toLowerCase()},truncate:function(str,length,truncation){return length=length||30,truncation="string"==typeof truncation?truncation:"...",str.length>length?str.slice(0,length-truncation.length)+truncation:String(str)},$filter:function(val){for(var i=1,n=arguments.length;n>i;i++){var array=arguments[i],fn=avalon.filters[array.shift()];if("function"==typeof fn){var arr=[val].concat(array);val=fn.apply(null,arr)}}return val},camelize:camelize,sanitize:function(str){return str.replace(rscripts,"").replace(ropen,function(a){var match=a.toLowerCase().match(/<(\w+)\s/);if(match){var reg=rsanitize[match[1]];reg&&(a=a.replace(reg,function(s,name,value){var quote=value.charAt(0);return name+"="+quote+"javascript:void(0)"+quote}))}return a.replace(ron," ").replace(/\s+/g," ")})},escape:function(str){return String(str).replace(/&/g,"&amp;").replace(rsurrogate,function(value){var hi=value.charCodeAt(0),low=value.charCodeAt(1);return"&#"+(1024*(hi-55296)+(low-56320)+65536)+";"}).replace(rnoalphanumeric,function(value){return"&#"+value.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")},currency:function(amount,symbol,fractionSize){return(symbol||"￥")+numberFormat(amount,isFinite(fractionSize)?fractionSize:2)},number:numberFormat};!new function(){function toInt(str){return parseInt(str,10)||0}function padNumber(num,digits,trim){var neg="";for(0>num&&(neg="-",num=-num),num=""+num;num.length<digits;)num="0"+num;return trim&&(num=num.substr(num.length-digits)),neg+num}function dateGetter(name,size,offset,trim){return function(date){var value=date["get"+name]();return(offset>0||value>-offset)&&(value+=offset),0===value&&-12===offset&&(value=12),padNumber(value,size,trim)}}function dateStrGetter(name,shortForm){return function(date,formats){var value=date["get"+name](),get=(shortForm?"SHORT"+name:name).toUpperCase();return formats[get][value]}}function timeZoneGetter(date){var zone=-1*date.getTimezoneOffset(),paddedZone=zone>=0?"+":"";return paddedZone+=padNumber(Math[zone>0?"floor":"ceil"](zone/60),2)+padNumber(Math.abs(zone%60),2)}function ampmGetter(date,formats){return date.getHours()<12?formats.AMPMS[0]:formats.AMPMS[1]}var DATE_FORMATS={yyyy:dateGetter("FullYear",4),yy:dateGetter("FullYear",2,0,!0),y:dateGetter("FullYear",1),MMMM:dateStrGetter("Month"),MMM:dateStrGetter("Month",!0),MM:dateGetter("Month",2,1),M:dateGetter("Month",1,1),dd:dateGetter("Date",2),d:dateGetter("Date",1),HH:dateGetter("Hours",2),H:dateGetter("Hours",1),hh:dateGetter("Hours",2,-12),h:dateGetter("Hours",1,-12),mm:dateGetter("Minutes",2),m:dateGetter("Minutes",1),ss:dateGetter("Seconds",2),s:dateGetter("Seconds",1),sss:dateGetter("Milliseconds",3),EEEE:dateStrGetter("Day"),EEE:dateStrGetter("Day",!0),a:ampmGetter,Z:timeZoneGetter},rdateFormat=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/,raspnetjson=/^\/Date\((\d+)\)\/$/;filters.date=function(date,format){var fn,match,locate=filters.date.locate,text="",parts=[];if(format=format||"mediumDate",format=locate[format]||format,"string"==typeof date)if(/^\d+$/.test(date))date=toInt(date);else if(raspnetjson.test(date))date=+RegExp.$1;else{var trimDate=date.trim(),dateArray=[0,0,0,0,0,0,0],oDate=new Date(0);trimDate=trimDate.replace(/^(\d+)\D(\d+)\D(\d+)/,function(_,a,b,c){var array=4===c.length?[c,a,b]:[a,b,c];return dateArray[0]=toInt(array[0]),dateArray[1]=toInt(array[1])-1,dateArray[2]=toInt(array[2]),""});var dateSetter=oDate.setFullYear,timeSetter=oDate.setHours;trimDate=trimDate.replace(/[T\s](\d+):(\d+):?(\d+)?\.?(\d)?/,function(_,a,b,c,d){return dateArray[3]=toInt(a),dateArray[4]=toInt(b),dateArray[5]=toInt(c),d&&(dateArray[6]=Math.round(1e3*parseFloat("0."+d))),""});var tzHour=0,tzMin=0;trimDate=trimDate.replace(/Z|([+-])(\d\d):?(\d\d)/,function(z,symbol,c,d){return dateSetter=oDate.setUTCFullYear,timeSetter=oDate.setUTCHours,symbol&&(tzHour=toInt(symbol+c),tzMin=toInt(symbol+d)),""}),dateArray[3]-=tzHour,dateArray[4]-=tzMin,dateSetter.apply(oDate,dateArray.slice(0,3)),timeSetter.apply(oDate,dateArray.slice(3)),date=oDate}if("number"==typeof date&&(date=new Date(date)),"date"===avalon.type(date)){for(;format;)match=rdateFormat.exec(format),match?(parts=parts.concat(match.slice(1)),format=parts.pop()):(parts.push(format),format=null);return parts.forEach(function(value){fn=DATE_FORMATS[value],text+=fn?fn(date,locate):value.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),text}};var locate={AMPMS:{0:"上午",1:"下午"},DAY:{0:"星期日",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},MONTH:{0:"1月",1:"2月",2:"3月",3:"4月",4:"5月",5:"6月",6:"7月",7:"8月",8:"9月",9:"10月",10:"11月",11:"12月"},SHORTDAY:{0:"周日",1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六"},fullDate:"y年M月d日EEEE",longDate:"y年M月d日",medium:"yyyy-M-d H:mm:ss",mediumDate:"yyyy-M-d",mediumTime:"H:mm:ss","short":"yy-M-d ah:mm",shortDate:"yy-M-d",shortTime:"ah:mm"};locate.SHORTMONTH=locate.MONTH,filters.date.locate=locate};var modules=avalon.modules={"domReady!":{exports:avalon,state:3},avalon:{exports:avalon,state:4}};modules.exports=modules.avalon,new function(){function makeRequest(name,config){var res="js";name=name.replace(/^(\w+)\!/,function(a,b){return res=b,""}),"ready"===res&&(log("debug: ready!已经被废弃，请使用domReady!"),res="domReady");var query="";name=name.replace(rquery,function(a){return query=a,""});var suffix="."+res,ext=/js|css/.test(suffix)?suffix:"";name=name.replace(/\.[a-z0-9]+$/g,function(a){return a===suffix?(ext=a,""):a});var req=avalon.mix({query:query,ext:ext,res:res,name:name,toUrl:toUrl},config);return req.toUrl(name),req}function fireRequest(req){var name=req.name,res=req.res,module=modules[name],urlNoQuery=name&&req.urlNoQuery;if(module&&module.state>=1)return name;if(module=modules[urlNoQuery],module&&module.state>=3)return innerRequire(module.deps||[],module.factory,urlNoQuery),urlNoQuery;if(name&&!module){module=modules[urlNoQuery]={id:urlNoQuery,state:1};var wrap=function(obj){resources[res]=obj,obj.load(name,req,function(a){arguments.length&&void 0!==a&&(module.exports=a),module.state=4,checkDeps()})};resources[res]?wrap(resources[res]):innerRequire([res],wrap)}return name?urlNoQuery:res+"!"}function checkCycle(deps,nick){for(var id,i=0;id=deps[i++];)if(4!==modules[id].state&&(id===nick||checkCycle(modules[id].deps,nick)))return!0}function checkFail(node,onError,fuckIE){var id=trimQuery(node.src);return node.onload=node.onreadystatechange=node.onerror=null,onError||fuckIE&&modules[id]&&!modules[id].state?(setTimeout(function(){head.removeChild(node),node=null}),void log("debug: 加载 "+id+" 失败"+onError+" "+!modules[id].state)):!0}function checkDeps(){loop:for(var id,i=loadings.length;id=loadings[--i];){var obj=modules[id],deps=obj.deps;if(deps){for(var key,j=0;key=deps[j];j++)if(4!==Object(modules[key]).state)continue loop;4!==obj.state&&(loadings.splice(i,1),fireFactory(obj.id,obj.deps,obj.factory),checkDeps())}}}function loadJS(url,id,callback){function onload(){var factory=factorys.pop();factory&&factory.require(id),callback&&callback(),checkFail(node,!1,!supportLoad)&&(log("debug: 已成功加载 "+url),id&&loadings.push(id),checkDeps())}var node=DOC.createElement("script");node.className=subscribers;var loadID,supportLoad="onload"in node,onEvent=supportLoad?"onload":"onreadystatechange",index=0;node[onEvent]=supportLoad?onload:function(){rreadyState.test(node.readyState)&&(++index,1===index?loadID=setTimeout(onload,500):(clearTimeout(loadID),onload()))},node.onerror=function(){checkFail(node,!0)},head.insertBefore(node,head.firstChild),node.src=url,log("debug: 正准备加载 "+url)}function trimQuery(url){return(url||"").replace(rquery,"")}function isAbsUrl(path){return/^(?:[a-z]+:)?\/\//i.test(String(path))}function getFullUrl(node,src){return"1"[0]?node[src]:node.getAttribute(src,4)}function getCurrentScript(){var stack;try{a.b.c()}catch(e){stack=e.stack,!stack&&window.opera&&(stack=(String(e).match(/of linked script \S+/g)||[]).join(" "))}if(stack)return stack=stack.split(/[@ ]/g).pop(),stack="("===stack[0]?stack.slice(1,-1):stack.replace(/\s/,""),trimQuery(stack.replace(/(:\d+)?:\d+$/i,""));for(var node,nodes=head.getElementsByTagName("script"),i=nodes.length;node=nodes[--i];)if(node.className===subscribers&&"interactive"===node.readyState){var url=getFullUrl(node,"src");return node.className=trimQuery(url)}}function fireFactory(id,deps,factory){var module=Object(modules[id]);module.state=4;for(var d,i=0,array=[];d=deps[i++];)if("exports"===d){var obj=module.exports||(module.exports={});array.push(obj)}else array.push(modules[d].exports);try{var ret=factory.apply(window,array)}catch(e){log("执行["+id+"]模块的factory抛错： ",e)}return void 0!==ret&&(module.exports=ret),rcallback.test(id)&&delete modules[id],delete module.factory,ret}function toUrl(id){0===id.indexOf(this.res+"!")&&(id=id.slice(this.res.length+1));var url=id,usePath=0,baseUrl=this.baseUrl,rootUrl=this.parentUrl||baseUrl;eachIndexArray(id,kernel.paths,function(value,key){url=url.replace(key,value),usePath=1}),usePath||eachIndexArray(id,kernel.packages,function(value,key,item){url=url.replace(item.name,item.location)}),this.mapUrl&&eachIndexArray(this.mapUrl,kernel.map,function(array){eachIndexArray(url,array,function(mdValue,mdKey){url=url.replace(mdKey,mdValue),rootUrl=baseUrl})});var ext=this.ext;ext&&usePath&&url.slice(-ext.length)===ext&&(url=url.slice(0,-ext.length)),isAbsUrl(url)||(rootUrl=this.built||/^\w/.test(url)?baseUrl:rootUrl,url=joinPath(rootUrl,url));var urlNoQuery=url+ext;return url=urlNoQuery+this.query,eachIndexArray(id,kernel.urlArgs,function(value){url+=(-1===url.indexOf("?")?"?":"&")+value}),this.url=url,this.urlNoQuery=urlNoQuery}function makeIndexArray(hash,useStar,part){
var index=hash2array(hash,useStar,part);return index.sort(descSorterByName),index}function makeMatcher(prefix){return new RegExp("^"+prefix+"(/|$)")}function makeExports(value){return function(){var ret;return value.init&&(ret=value.init.apply(window,arguments)),ret||value.exports&&getGlobal(value.exports)}}function hash2array(hash,useStar,part){var array=[];for(var key in hash)if(ohasOwn.call(hash,key)){var item={name:key,val:hash[key]};array.push(item),item.reg="*"===key&&useStar?/^/:makeMatcher(key),part&&"*"!==key&&(item.reg=new RegExp("/"+key.replace(/^\//,"")+"(/|$)"))}return array}function eachIndexArray(moduleID,array,matcher){array=array||[];for(var el,i=0;el=array[i++];)if(el.reg.test(moduleID))return matcher(el.val,el.name,el),!1}function descSorterByName(a,b){var aaa=a.name,bbb=b.name;return"*"===bbb?-1:"*"===aaa?1:bbb.length-aaa.length}function joinPath(a,b){if("/"!==a.charAt(a.length-1)&&(a+="/"),"./"===b.slice(0,2))return a+b.slice(2);if(".."===b.slice(0,2)){for(a+=b;rdeuce.test(a);)a=a.replace(rdeuce,"");return a}return"/"===b.slice(0,1)?a+b.slice(1):a+b}function getGlobal(value){if(!value)return value;var g=window;return value.split(".").forEach(function(part){g=g[part]}),g}var loadings=[],factorys=[],rjsext=/\.js$/i,requireQueue=[],isUserFirstRequire=!1;innerRequire=avalon.require=function(array,factory,parentUrl,defineConfig){if(isUserFirstRequire){Array.isArray(array)||avalon.error("require方法的第一个参数应为数组 "+array);var deps=[],uniq={},id=parentUrl||"callback"+setTimeout("1");defineConfig=defineConfig||{},defineConfig.baseUrl=kernel.baseUrl;var isBuilt=!!defineConfig.built;if(parentUrl&&(defineConfig.parentUrl=parentUrl.substr(0,parentUrl.lastIndexOf("/")),defineConfig.mapUrl=parentUrl.replace(rjsext,"")),isBuilt){var req=makeRequest(defineConfig.defineName,defineConfig);id=req.urlNoQuery}else array.forEach(function(name){var req=makeRequest(name,defineConfig),url=fireRequest(req);url&&(uniq[url]||(deps.push(url),uniq[url]="司徒正美"))});var module=modules[id];module&&4===module.state||(modules[id]={id:id,deps:isBuilt?array.concat():deps,factory:factory||noop,state:3}),module||loadings.push(id),checkDeps()}else if(requireQueue.push(avalon.slice(arguments)),arguments.length<=2){isUserFirstRequire=!0;for(var args,queue=requireQueue.splice(0,requireQueue.length);args=queue.shift();)innerRequire.apply(null,args)}},innerRequire.define=function(name,deps,factory){"string"!=typeof name&&(factory=deps,deps=name,name="anonymous"),Array.isArray(deps)||(factory=deps,deps=[]);var config={built:!isUserFirstRequire,defineName:name},args=[deps,factory,config];factory.require=function(url){if(args.splice(2,0,url),modules[url]){modules[url].state=3;var isCycle=!1;try{isCycle=checkCycle(modules[url].deps,url)}catch(e){}isCycle&&avalon.error(url+"模块与之前的模块存在循环依赖，请不要直接用script标签引入"+url+"模块")}delete factory.require,innerRequire.apply(null,args)};var url=config.built?"unknown":getCurrentScript();if(url){var module=modules[url];module&&(module.state=2),factory.require(url)}else factorys.push(factory)},innerRequire.config=kernel,innerRequire.define.amd=modules;var allpaths=kernel["orig.paths"]={},allmaps=kernel["orig.map"]={},allpackages=kernel.packages=[],allargs=kernel["orig.args"]={};avalon.mix(plugins,{paths:function(hash){avalon.mix(allpaths,hash),kernel.paths=makeIndexArray(allpaths)},map:function(hash){avalon.mix(allmaps,hash);var list=makeIndexArray(allmaps,1,1);avalon.each(list,function(_,item){item.val=makeIndexArray(item.val)}),kernel.map=list},packages:function(array){array=array.concat(allpackages);for(var pkg,uniq={},ret=[],i=0;pkg=array[i++];){pkg="string"==typeof pkg?{name:pkg}:pkg;var name=pkg.name;if(!uniq[name]){var url=joinPath(pkg.location||name,pkg.main||"main");url=url.replace(rjsext,""),ret.push(pkg),uniq[name]=pkg.location=url,pkg.reg=makeMatcher(name)}}kernel.packages=ret.sort()},urlArgs:function(hash){"string"==typeof hash&&(hash={"*":hash}),avalon.mix(allargs,hash),kernel.urlArgs=makeIndexArray(allargs,1)},baseUrl:function(url){if(!isAbsUrl(url)){var baseElement=head.getElementsByTagName("base")[0];baseElement&&head.removeChild(baseElement);var node=DOC.createElement("a");node.href=url,url=getFullUrl(node,"href"),baseElement&&head.insertBefore(baseElement,head.firstChild)}url.length>3&&(kernel.baseUrl=url)},shim:function(obj){for(var i in obj){var value=obj[i];Array.isArray(value)&&(value=obj[i]={deps:value}),value.exportsFn||!value.exports&&!value.init||(value.exportsFn=makeExports(value))}kernel.shim=obj}});var rreadyState=/complete|loaded/,resources=innerRequire.plugins={ready:{load:noop},js:{load:function(name,req,onLoad){var url=req.url,id=req.urlNoQuery,shim=kernel.shim[name.replace(rjsext,"")];shim?innerRequire(shim.deps||[],function(){var args=avalon.slice(arguments);loadJS(url,id,function(){onLoad(shim.exportsFn?shim.exportsFn.apply(0,args):void 0)})}):loadJS(url,id)}},css:{load:function(name,req,onLoad){var url=req.url,node=DOC.createElement("link");node.rel="stylesheet",node.href=url,head.insertBefore(node,head.firstChild),log("debug: 已成功加载 "+url),onLoad()}},text:{load:function(name,req,onLoad){var url=req.url,xhr=getXHR();xhr.onreadystatechange=function(){if(4===xhr.readyState){var status=xhr.status;status>399&&600>status?avalon.error(url+" 对应资源不存在或没有开启 CORS"):(log("debug: 已成功加载 "+url),onLoad(xhr.responseText))}};var time="_="+(new Date-0),_url=-1===url.indexOf("?")?url+"?"+time:url+"&"+time;xhr.open("GET",_url,!0),"withCredentials"in xhr&&(xhr.withCredentials=!0),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.send(),log("debug: 正准备加载 "+url)}}};innerRequire.checkDeps=checkDeps;var rquery=/(\?[^#]*)$/,rcallback=/^callback\d+$/,rdeuce=/\/\w+\/\.\./,mainNode=DOC.scripts[DOC.scripts.length-1],dataMain=mainNode.getAttribute("data-main");if(dataMain){plugins.baseUrl(dataMain);var href=kernel.baseUrl;kernel.baseUrl=href.slice(0,href.lastIndexOf("/")+1),loadJS(href.replace(rjsext,"")+".js")}else{var loaderUrl=trimQuery(getFullUrl(mainNode,"src"));kernel.baseUrl=loaderUrl.slice(0,loaderUrl.lastIndexOf("/")+1)}};var isReady,readyList=[],fireReady=function(fn){for(isReady=!0,innerRequire&&(modules["domReady!"].state=4,innerRequire.checkDeps());fn=readyList.shift();)fn(avalon)};if("complete"===DOC.readyState)setTimeout(fireReady);else if(W3C)DOC.addEventListener("DOMContentLoaded",fireReady);else{DOC.attachEvent("onreadystatechange",function(){"complete"===DOC.readyState&&fireReady()});try{var isTop=null===window.frameElement}catch(e){}root.doScroll&&isTop&&window.external&&doScrollCheck()}avalon.bind(window,"load",fireReady),avalon.ready=function(fn){isReady?fn(avalon):readyList.push(fn)},avalon.config({loader:!0}),avalon.ready(function(){avalon.scan(DOC.body)}),"function"==typeof define&&define.amd&&define("avalon",[],function(){return avalon});var _avalon=window.avalon;return avalon.noConflict=function(deep){return deep&&window.avalon===avalon&&(window.avalon=_avalon),avalon},void 0===noGlobal&&(window.avalon=avalon),avalon});
//# sourceMappingURL=avalon.js.map