!function(global,factory){"object"==typeof module&&"object"==typeof module.exports?module.exports=global.document?factory(global,!0):function(w){if(!w.document)throw new Error("Avalon requires a window with a document");return factory(w)}:factory(global)}("undefined"!=typeof window?window:this,function(window,noGlobal){function log(){window.console&&avalon.config.debug&&Function.apply.call(console.log,console,arguments)}function scpCompile(array){return Function.apply(noop,array)}function noop(){}function oneObject(array,val){"string"==typeof array&&(array=array.match(rword)||[]);for(var result={},value=void 0!==val?val:1,i=0,n=array.length;n>i;i++)result[array[i]]=value;return result}function IE(){if(window.VBArray){var mode=document.documentMode;return mode?mode:window.XMLHttpRequest?7:6}return 0/0}function isWindow(obj){return rwindow.test(serialize.call(obj))}function _number(a,len){return a=Math.floor(a)||0,0>a?Math.max(len+a,0):Math.min(a,len)}function isArrayLike(obj){if(!obj)return!1;var n=obj.length;if(n===n>>>0){var type=serialize.call(obj).slice(8,-1);if(/(?:regexp|string|function|window|global)$/i.test(type))return!1;if("Array"===type)return!0;try{return{}.propertyIsEnumerable.call(obj,"length")===!1?/^\s?function/.test(obj.item||obj.callee):!0}catch(e){return!obj.window}}return!1}function iterator(vars,body,ret){var fun="for(var "+vars+"i=0,n = this.length; i < n; i++){"+body.replace("_","((i in this) && fn.call(scope,this[i],i,this))")+"}"+ret;return Function("fn,scope",fun)}function fixContains(root,el){try{for(;el=el.parentNode;)if(el===root)return!0;return!1}catch(e){return!1}}function outerHTML(){return(new XMLSerializer).serializeToString(this)}function enumerateNode(node,targetNode){if(node&&node.childNodes)for(var el,nodes=node.childNodes,i=0;el=nodes[i++];)if(el.tagName){var svg=DOC.createElementNS(svgns,el.tagName.toLowerCase());ap.forEach.call(el.attributes,function(attr){svg.setAttribute(attr.name,attr.value)}),enumerateNode(el,svg),targetNode.appendChild(svg)}}function fixEvent(event){var ret={};for(var i in event)ret[i]=event[i];var target=ret.target=event.srcElement;if(0===event.type.indexOf("key"))ret.which=null!=event.charCode?event.charCode:event.keyCode;else if(rmouseEvent.test(event.type)){var doc=target.ownerDocument||DOC,box="BackCompat"===doc.compatMode?doc.body:doc.documentElement;ret.pageX=event.clientX+(box.scrollLeft>>0)-(box.clientLeft>>0),ret.pageY=event.clientY+(box.scrollTop>>0)-(box.clientTop>>0),ret.wheelDeltaY=ret.wheelDelta,ret.wheelDeltaX=0}return ret.timeStamp=new Date-0,ret.originalEvent=event,ret.preventDefault=function(){event.returnValue=!1},ret.stopPropagation=function(){event.cancelBubble=!0},ret}function kernel(settings){for(var p in settings)if(ohasOwn.call(settings,p)){var val=settings[p];"function"==typeof kernel.plugins[p]?kernel.plugins[p](val):"object"==typeof kernel[p]?avalon.mix(kernel[p],val):kernel[p]=val}return this}function escapeRegExp(target){return(target+"").replace(rregexp,"\\$&")}function $watch(expr,binding){var $events=this.$events||(this.$events={}),queue=$events[expr]||($events[expr]=[]);if("function"==typeof binding){var backup=binding;backup.uniqueNumber=Math.random(),binding={element:root,type:"user-watcher",handler:noop,vmodels:[this],expr:expr,uniqueNumber:backup.uniqueNumber},binding.wildcard=/\*/.test(expr)}if(binding.update)binding.oneTime||avalon.Array.ensure(queue,binding);else{if(/\w\.*\B/.test(expr)){binding.getter=noop;var host=this;binding.update=function(){var args=this.fireArgs||[];args[2]&&binding.handler.apply(host,args),delete this.fireArgs},queue.sync=!0,avalon.Array.ensure(queue,binding)}else avalon.injectBinding(binding);backup&&(binding.handler=backup)}return function(){binding.update=binding.getter=binding.handler=noop,binding.element=DOC.createElement("a")}}function $emit(key,args){var event=this.$events;if(event&&event[key]){args&&(args[2]=key),notifySubscribers(event[key],args);var parent=this.$up;parent&&(this.$pathname&&$emit.call(parent,this.$pathname+"."+key,args),$emit.call(parent,"*."+key,args))}else if(parent=this.$up){var path=this.$pathname+"."+key,arr=path.split(".");-1===arr.indexOf("*")?($emit.call(parent,path,args),arr[1]="*",$emit.call(parent,arr.join("."),args)):$emit.call(parent,path,args)}}function collectDependency(el,key){for(;;){if(el.$watch){var e=el.$events||(el.$events={}),array=e[key]||(e[key]=[]);return void dependencyDetection.collectDependency(array)}if(el=el.$up,!el)break;key=el.$pathname+"."+key}}function notifySubscribers(subs,args){if(subs){new Date-beginTime>444&&"object"==typeof subs[0]&&rejectDisposeQueue();for(var sub,users=[],renders=[],i=0;sub=subs[i++];)"user-watcher"===sub.type?users.push(sub):renders.push(sub);if(kernel.async){for(buffer.render(),i=0;sub=renders[i++];)if(sub.update){var uuid=getUid(sub);buffer.queue[uuid]||(buffer.queue[uuid]=1,buffer.queue.push(sub))}}else for(i=0;sub=renders[i++];)sub.update&&sub.update();for(i=0;sub=users[i++];)(args&&args[2]===sub.expr||sub.wildcard)&&(sub.fireArgs=args),sub.update()}}function modelFactory(source,options){return options=options||{},options.watch=!0,observeObject(source,options)}function Component(){}function observeObject(source,options){function trackBy(name){return hasOwn[name]===!0}if(!source||source.$id&&source.$accessors)return source;options=options||nullObject;var force=options.force||nullObject,old=options.old,oldAccessors=old&&old.$accessors||nullObject,$vmodel=new Component,accessors={},hasOwn={},skip=[],simple=[],$skipArray={};source.$skipArray&&($skipArray=oneObject(source.$skipArray),delete source.$skipArray);var computed=source.$computed;if(computed){delete source.$computed;for(var name in computed)hasOwn[name]=!0,function(key,value){var old;accessors[key]={get:function(){return old=value.get.call(this)},set:function(x){if("function"==typeof value.set){var older=old;value.set.call(this,x);var newer=this[key];this.$fire&&newer!==older&&this.$fire(key,newer,older)}},enumerable:!0,configurable:!0}}(name,computed[name])}for(name in source){var value=source[name];$$skipArray[name]||(hasOwn[name]=!0),"function"==typeof value||value&&value.nodeType||!force[name]&&("$"===name.charAt(0)||$$skipArray[name]||$skipArray[name])?skip.push(name):isComputed(value)?(log("warning:计算属性建议放在$computed对象中统一定义"),function(key,value){var old;accessors[key]={get:function(){return old=value.get.call(this)},set:function(x){if("function"==typeof value.set){var older=old;value.set.call(this,x);var newer=this[key];this.$fire&&newer!==older&&this.$fire(key,newer,older)}},enumerable:!0,configurable:!0}}(name,value)):(simple.push(name),accessors[name]=oldAccessors[name]?oldAccessors[name]:makeGetSet(name,value))}accessors.$model=$modelDescriptor,$vmodel=defineProperties($vmodel,accessors,source),skip.forEach(function(name){$vmodel[name]=source[name]}),hideProperty($vmodel,"$id","anonymous"),hideProperty($vmodel,"$up",old?old.$up:null),hideProperty($vmodel,"$track",Object.keys(hasOwn)),hideProperty($vmodel,"$active",!1),hideProperty($vmodel,"$pathname",old?old.$pathname:""),hideProperty($vmodel,"$accessors",accessors),hideProperty($vmodel,"hasOwnProperty",trackBy),options.watch&&(hideProperty($vmodel,"$watch",function(){return $watch.apply($vmodel,arguments)}),hideProperty($vmodel,"$fire",function(path,a){if(0===path.indexOf("all!")){var ee=path.slice(4);for(var i in avalon.vmodels){var v=avalon.vmodels[i];v.$fire&&v.$fire.apply(v,[ee,a])}}else $emit.call($vmodel,path,[a])})),simple.forEach(function(name){var val=$vmodel[name]=source[name];val&&"object"==typeof val&&(val.$up=$vmodel,val.$pathname=name),$emit.call($vmodel,name)});for(name in computed)value=$vmodel[name];return $vmodel.$active=!0,$vmodel}function isComputed(val){if(val&&"object"==typeof val){for(var i in val)if("get"!==i&&"set"!==i)return!1;return"function"==typeof val.get}}function makeGetSet(key,value){var childVm;return value=0/0,{get:function(){return this.$active&&collectDependency(this,key),value},set:function(newVal){if(value!==newVal){var oldValue=value;childVm=observe(newVal,value),childVm?value=childVm:(childVm=void 0,value=newVal),Object(childVm)===childVm&&(childVm.$pathname=key,childVm.$up=this),this.$active&&$emit.call(this,key,[value,oldValue])}},enumerable:!0,configurable:!0}}function observe(obj,old,hasReturn,watch){if(Array.isArray(obj))return observeArray(obj,old,watch);if(avalon.isPlainObject(obj)){if(old){var keys=getKeys(obj),keys2=getKeys(old);if(keys.join(";")===keys2.join(";")){for(var i in obj)obj.hasOwnProperty(i)&&(old[i]=obj[i]);return old}old.$active=!1}return observeObject(obj,{old:old,watch:watch})}return hasReturn?obj:void 0}function observeArray(array,old,watch){if(old){var args=[0,old.length].concat(array);return old.splice.apply(old,args),old}for(var i in newProto)array[i]=newProto[i];hideProperty(array,"$up",null),hideProperty(array,"$pathname",""),hideProperty(array,"$track",createTrack(array.length)),array._=observeObject({length:0/0},{watch:!0}),array._.length=array.length,array._.$watch("length",function(a,b){$emit.call(array.$up,array.$pathname+".length",[a,b])}),watch&&hideProperty(array,"$watch",function(){return $watch.apply(array,arguments)}),W3C?Object.defineProperty(array,"$model",$modelDescriptor):array.$model=toJson(array);for(var j=0,n=array.length;n>j;j++){var el=array[j]=observe(array[j],0,1,1);Object(el)===el&&(el.$up=array)}return array}function hideProperty(host,name,value){canHideOwn?Object.defineProperty(host,name,{value:value,writable:!0,enumerable:!1,configurable:!0}):host[name]=value}function toJson(val){var xtype=avalon.type(val);if("array"===xtype){for(var array=[],i=0;i<val.length;i++)array[i]=toJson(val[i]);return array}if("object"===xtype){var obj={};for(i in val)if("__proxy__"!==i&&"__data__"!==i&&"__const__"!==i&&val.hasOwnProperty(i)){var value=val[i];obj[i]=value&&value.nodeType?value:toJson(value)}return obj}return val}function VBMediator(instance,accessors,name,value){var accessor=accessors[name];return 4!==arguments.length?accessor.get.call(instance):void accessor.set.call(instance,value)}function sortByIndex(array,indexes){for(var map={},i=0,n=indexes.length;n>i;i++){map[i]=array[i];var j=indexes[i];j in map?(array[i]=map[j],delete map[j]):array[i]=array[j]}}function createTrack(n){for(var ret=[],i=0;n>i;i++)ret[i]=generateID("$proxy$each");return ret}function addTrack(track,method,args){switch(method){case"push":case"unshift":args=createTrack(args.length);break;case"splice":if(args.length>2){{args[1],args.length-2}args=[args[0],args[1]].concat(createTrack(args.length-2))}}Array.prototype[method].apply(track,args)}function injectDependency(list,binding){binding.oneTime||list&&avalon.Array.ensure(list,binding)&&binding.element&&(injectDisposeQueue(binding,list),new Date-beginTime>444&&rejectDisposeQueue())}function getProxyIds(a,isArray){for(var el,ret=[],i=0;el=a[i++];)ret.push(isArray?el.$id:el.$key);return ret.join(";")}function getUid(data){if(!data.uniqueNumber){var elem=data.element;data.uniqueNumber=elem?1!==elem.nodeType?data.type+"-"+getUid(elem.parentNode)+"-"+ ++disposeCount:data.name+"-"+getUid(elem):++disposeCount}return data.uniqueNumber}function injectDisposeQueue(data,list){var lists=data.lists||(data.lists=[]),uuid=getUid(data);avalon.Array.ensure(lists,list),list.$uuid=list.$uuid||generateID(),disposeQueue[uuid]||(disposeQueue[uuid]=1,disposeQueue.push(data))}function rejectDisposeQueue(data){for(var i=disposeQueue.length,n=i,allTypes=[],iffishTypes={},newInfo={};data=disposeQueue[--i];){var type=data.type;newInfo[type]?newInfo[type]++:(newInfo[type]=1,allTypes.push(type))}var diff=!1;if(allTypes.forEach(function(type){oldInfo[type]!==newInfo[type]&&(iffishTypes[type]=1,diff=!0)}),i=n,diff)for(;data=disposeQueue[--i];)if(null!==data.element){if(iffishTypes[data.type]&&shouldDispose(data.element)){disposeQueue.splice(i,1),delete disposeQueue[data.uniqueNumber];for(var list,lists=data.lists,k=0;list=lists[k++];)avalon.Array.remove(lists,list),avalon.Array.remove(list,data);disposeData(data)}}else disposeQueue.splice(i,1);oldInfo=newInfo,beginTime=new Date}function disposeData(data){delete disposeQueue[data.uniqueNumber],data.element=null,data.rollback&&data.rollback();for(var key in data)data[key]=null}function shouldDispose(el){try{{el.parentNode.nodeType}}catch(e){return!0}return el.ifRemove&&!root.contains(el.ifRemove)&&ifGroup===el.parentNode?(el.parentNode&&el.parentNode.removeChild(el),!0):el.msRetain?0:1===el.nodeType?!root.contains(el):!avalon.contains(root,el)}function isVML(src){var nodeName=src.nodeName;return nodeName.toLowerCase()===nodeName&&src.scopeName&&""===src.outerText}function fixVML(node){"url(#default#VML)"!==node.currentStyle.behavior&&(node.style.behavior="url(#default#VML)",node.style.display="inline-block",node.style.zoom=1)}function hyphen(target){return target.replace(/([a-z\d])([A-Z]+)/g,"$1-$2").toLowerCase()}function camelize(target){return!target||target.indexOf("-")<0&&target.indexOf("_")<0?target:target.replace(/[-_][^-_]/g,function(match){return match.charAt(1).toUpperCase()})}function fakeClassList(node){if(!("classList"in node)){node.classList={node:node};for(var k in fakeClassListMethods)node.classList[k.slice(1)]=fakeClassListMethods[k]}return node.classList}function parseData(data){try{if("object"==typeof data)return data;data="true"===data?!0:"false"===data?!1:"null"===data?null:+data+""===data?+data:rbrace.test(data)?avalon.parseJSON(data):data}catch(e){}return data}function getWindow(node){return node.window&&node.document?node:9===node.nodeType?node.defaultView||node.parentWindow:!1}function showHidden(node,array){if(node.offsetWidth<=0){if(rdisplayswap.test(cssHooks["@:get"](node,"display"))){var obj={node:node};for(var name in cssShow)obj[name]=node.style[name],node.style[name]=cssShow[name];array.push(obj)}var parent=node.parentNode;parent&&1===parent.nodeType&&showHidden(parent,array)}}function getValType(elem){var ret=elem.tagName.toLowerCase();return"input"===ret&&/checkbox|radio/.test(elem.type)?"checked":ret}function getIdent(input,lastIndex){var result=[],subroutine=!!lastIndex;lastIndex=lastIndex||0;for(var state="unknown",variable="",i=0;i<input.length;i++){var c=input.charAt(i);if("'"===c||'"'===c)"unknown"===state?state=c:state===c&&(state="unknown");else if("\\"===c)("'"===state||'"'===state)&&i++;else if(ridentStart.test(c))"unknown"===state?(state="variable",variable=c):"maybePath"===state?(variable=result.pop(),variable+="."+c,state="variable"):"variable"===state&&(variable+=c);else if(/\w/.test(c))"variable"===state&&(variable+=c);else if("."===c)"variable"===state&&variable&&(result.push(variable),variable="",state="maybePath");else if("["===c){if("variable"===state||"maybePath"===state){variable&&(result.push(variable),variable="");var lastLength=result.length,last=result[lastLength-1],innerResult=getIdent(input.slice(i),i);if(innerResult.length)result[lastLength-1]=last+".*",result=innerResult.concat(result);else{var content=input.slice(i+1,innerResult.i);try{var text=scpCompile(["return "+content])();result[lastLength-1]=last+"."+text}catch(e){}}state="maybePath",i=innerResult.i}}else if("]"===c){if(subroutine)return result.i=i+lastIndex,addVar(result,variable),result}else rwhiteSpace.test(c)&&"\r"!==c&&"\n"!==c?"variable"===state&&(addVar(result,variable)&&(state="maybePath"),variable=""):(addVar(result,variable),state="unknown",variable="")}return addVar(result,variable),result}function addVar(array,element){return element&&!keyMap[element]?(array.push(element),!0):void 0}function addAssign(vars,vmodel,name,binding){for(var prop,ret=[],prefix=" = "+name+".",i=vars.length;prop=vars[--i];)for(var a,arr=prop.split("."),first=arr[0];a=arr.shift();)vmodel.hasOwnProperty(a)&&(ret.push(first+prefix+first),binding.observers.push({v:vmodel,p:prop}),vars.splice(i,1));return ret}function getVars(expr){expr=expr.trim();var ret=variablePool.get(expr);if(ret)return ret.concat();for(var el,array=getIdent(expr),uniq={},result=[],i=0;el=array[i++];)uniq[el]||(uniq[el]=1,result.push(el));return variablePool.put(expr,result).concat()}function parseExpr(expr,vmodels,binding){var filters=binding.filters;"string"==typeof filters&&filters.trim()&&!binding._filters&&(binding._filters=parseFilter(filters.trim()));var vars=getVars(expr),expose=new Date-0,assigns=[],names=[],args=[];binding.observers=[];for(var i=0,sn=vmodels.length;sn>i;i++)if(vars.length){var name="vm"+expose+"_"+i;names.push(name),args.push(vmodels[i]),assigns.push.apply(assigns,addAssign(vars,vmodels[i],name,binding))}binding.args=args;var dataType=binding.type,exprId=vmodels.map(function(el){return String(el.$id).replace(rproxy,"$1")})+expr+dataType,getter=evaluatorPool.get(exprId);if(getter){if("duplex"===dataType){var setter=evaluatorPool.get(exprId+"setter");binding.setter=setter.apply(setter,binding.args)}return binding.getter=getter}if(assigns.length||assigns.push("fix"+expose),"duplex"===dataType){var nameOne={};assigns.forEach(function(a){var arr=a.split("=");nameOne[arr[0].trim()]=arr[1].trim()}),expr=expr.replace(/[\$\w]+/,function(a){return nameOne[a]?nameOne[a]:a});var fn2=scpCompile(names.concat("'use strict';return function(vvv){"+expr+" = vvv\n}\n"));evaluatorPool.put(exprId+"setter",fn2),binding.setter=fn2.apply(fn2,binding.args)}if("on"===dataType){-1===expr.indexOf("(")?expr+=".call(this, $event)":expr=expr.replace("(",".call(this,"),names.push("$event"),expr="\nreturn "+expr+";";var lastIndex=expr.lastIndexOf("\nreturn"),header=expr.slice(0,lastIndex),footer=expr.slice(lastIndex);expr=header+"\n"+footer}else expr="\nreturn "+expr+";";return getter=scpCompile(names.concat("'use strict';\nvar "+assigns.join(",\n")+expr)),evaluatorPool.put(exprId,getter)}function stringifyExpr(code){var hasExpr=rexpr.test(code);if(hasExpr){var array=scanExpr(code);return 1===array.length?array[0].expr:array.map(function(el){return el.type?"("+el.expr+")":quote(el.expr)}).join(" + ")}return code}function parseFilter(filters){return filters=filters.replace(rthimRightParentheses,"").replace(rthimOtherParentheses,function(){return"],|"}).replace(rquoteFilterName,function(a,b){return"["+quote(b)}).replace(rpatchBracket,function(){return'"],["'}).replace(rthimLeftParentheses,function(){return'",'})+"]",scpCompile(["return ["+filters+"]"])()}function checkScan(elem,callback,innerHTML){var id=setTimeout(function(){var currHTML=elem.innerHTML;clearTimeout(id),currHTML===innerHTML?callback():checkScan(elem,callback,currHTML)})}function createSignalTower(elem,vmodel){var id=elem.getAttribute("avalonctrl")||vmodel.$id;elem.setAttribute("avalonctrl",id),vmodel.$events&&(vmodel.$events.expr=elem.tagName+'[avalonctrl="'+id+'"]')}function executeBindings(bindings,vmodels){for(var binding,i=0;binding=bindings[i++];)binding.vmodels=vmodels,directives[binding.type].init(binding),avalon.injectBinding(binding),binding.getter&&1===binding.element.nodeType&&binding.element.removeAttribute(binding.name);bindings.length=0}function bindingSorter(a,b){return a.priority-b.priority}function scanAttr(elem,vmodels,match){var scanNode=!0;if(vmodels.length){for(var attr,attributes=getAttributes?getAttributes(elem):elem.attributes,bindings=[],uniq={},i=0;attr=attributes[i++];){var name=attr.name;if(!uniq[name]&&(uniq[name]=1,attr.specified&&(match=name.match(rmsAttr)))){var type=match[1],param=match[2]||"",value=attr.value;if(events[type]?(param=type,type="on"):obsoleteAttrs[type]&&(param=type,type="attr",name="ms-"+type+"-"+param,log("warning!请改用"+name+"代替"+attr.name+"!")),directives[type]){var newValue=value.replace(roneTime,""),oneTime=value!==newValue,binding={type:type,param:param,element:elem,name:name,expr:newValue,oneTime:oneTime,uniqueNumber:attr.name+"-"+getUid(elem),priority:(directives[type].priority||10*type.charCodeAt(0))+(Number(param.replace(/\D/g,""))||0)};if("html"===type||"text"===type){var filters=getToken(value).filters;binding.expr=binding.expr.replace(filters,""),binding.filters=filters.replace(rhasHtml,function(){return binding.type="html",binding.group=1,""}).trim()}else if("duplex"===type)var hasDuplex=name;else if("ms-if-loop"===name)binding.priority+=100;else if("ms-attr-value"===name)var hasAttrValue=name;bindings.push(binding)}}}if(bindings.length){for(bindings.sort(bindingSorter),hasDuplex&&hasAttrValue&&"INPUT"===elem.nodeName&&"text"===elem.type&&log("warning!一个控件不能同时定义ms-attr-value与"+hasDuplex),i=0;binding=bindings[i];i++){if(type=binding.type,rnoscanAttrBinding.test(type))return executeBindings(bindings.slice(0,i+1),vmodels);scanNode&&(scanNode=!rnoscanNodeBinding.test(type))}executeBindings(bindings,vmodels)}}scanNode&&!stopScan[elem.tagName]&&(isWidget(elem)?elem.msResolved:1)&&(mergeTextNodes&&mergeTextNodes(elem),scanNodeList(elem,vmodels))}function getOptionsFromTag(elem){for(var attr,attributes=getAttributes?getAttributes(elem):elem.attributes,ret={},i=0;attr=attributes[i++];)attr.specified&&!rnoCollect.test(attr.name)&&(ret[camelize(attr.name)]=parseData(attr.value));return ret}function scanNodeList(parent,vmodels){var nodes=avalon.slice(parent.childNodes);scanNodeArray(nodes,vmodels)}function scanNodeArray(nodes,vmodels){for(var node,i=0;node=nodes[i++];)switch(node.nodeType){case 1:var elem=node;if(scanTag(node,vmodels),!elem.msResolved&&elem.parentNode&&1===elem.parentNode.nodeType){var library=isWidget(elem);if(library){var widget=elem.localName?elem.localName.replace(library+":",""):elem.nodeName,fullName=library+":"+camelize(widget);componentQueue.push({library:library,element:elem,fullName:fullName,widget:widget,vmodels:vmodels,name:"widget"}),avalon.components[fullName]&&avalon.component(fullName)}}node.msHasEvent&&avalon.fireDom(node,"datasetchanged",{bubble:node.msHasEvent});break;case 3:rexpr.test(node.nodeValue)&&scanText(node,vmodels,i)}}function scanTag(elem,vmodels,node){var a=elem.getAttribute("ms-skip");if(!elem.getAttributeNode)return log("warning "+elem.tagName+" no getAttributeNode method");var b=elem.getAttributeNode("ms-important"),c=elem.getAttributeNode("ms-controller");if("string"!=typeof a){if(node=b||c){var newVmodel=avalon.vmodels[node.value];if(!newVmodel)return;vmodels=node===b?[newVmodel]:[newVmodel].concat(vmodels);var name=node.name;elem.removeAttribute(name),avalon(elem).removeClass(name),createSignalTower(elem,newVmodel)}scanAttr(elem,vmodels)}}function getToken(value){if(value.indexOf("|")>0){var scapegoat=value.replace(rstringLiteral,function(_){return Array(_.length+1).join("1")}),index=scapegoat.replace(r11a,"ᄢ㍄").indexOf("|");if(index>-1)return{type:"text",filters:value.slice(index).trim(),expr:value.slice(0,index)}}return{type:"text",expr:value,filters:""}}function scanExpr(str){for(var value,stop,tokens=[],start=0;;){if(stop=str.indexOf(openTag,start),-1===stop)break;if(value=str.slice(start,stop),value&&tokens.push({expr:value}),start=stop+openTag.length,stop=str.indexOf(closeTag,start),-1===stop)break;value=str.slice(start,stop),value&&tokens.push(getToken(value,start)),start=stop+closeTag.length}return value=str.slice(start),value&&tokens.push({expr:value}),tokens}function scanText(textNode,vmodels,index){var bindings=[],tokens=scanExpr(textNode.data);if(tokens.length){for(var token,i=0;token=tokens[i++];){var node=DOC.createTextNode(token.expr);token.type&&(token.expr=token.expr.replace(roneTime,function(){return token.oneTime=!0,""}),token.element=node,token.filters=token.filters.replace(rhasHtml,function(){return token.type="html",""}),token.pos=1e3*index+i,bindings.push(token)),avalonFragment.appendChild(node)}textNode.parentNode.replaceChild(avalonFragment,textNode),bindings.length&&executeBindings(bindings,vmodels)}}function getOptionsFromVM(vmodels,pre){if(pre)for(var v,i=0;v=vmodels[i++];)if(v.hasOwnProperty(pre)&&"object"==typeof v[pre]){var vmOptions=v[pre];return vmOptions.$model||vmOptions}return{}}function isWidget(el){if(el.scopeName&&"HTML"!==el.scopeName)return el.scopeName;var fullName=el.nodeName.toLowerCase(),index=fullName.indexOf(":");return index>0?fullName.slice(0,index):void 0}function fixNull(val){return null==val?"":val}function pipe(val,binding,action){return binding.param.replace(rw20g,function(name){var hook=avalon.duplexHooks[name];hook&&"function"==typeof hook[action]&&(val=hook[action](val,binding))}),val}function ticker(){for(var n=ribbon.length-1;n>=0;n--){var el=ribbon[n];el()===!1&&ribbon.splice(n,1)}ribbon.length||clearInterval(TimerID)}function effectFactory(el,opts){if(!el||1!==el.nodeType)return null;if(opts)var name=opts.effectName,driver=opts.effectDriver;else name=el.getAttribute("data-effect-name"),driver=el.getAttribute("data-effect-driver");if(!name||!driver)return null;var instance=effectPool.pop()||new Effect;return instance.el=el,instance.driver=driver,instance.useCss="j"!==driver,instance.useCss&&(opts&&avalon(el).addClass(opts.effectClass),instance.cssEvent="t"===driver?transitionEndEvent:animationEndEvent),instance.name=name,instance.callbacks=avalon.effects[name]||{},instance}function effectBinding(elem,binding){var name=elem.getAttribute("data-effect-name");if(name){binding.effectName=name,binding.effectDriver=elem.getAttribute("data-effect-driver");var stagger=+elem.getAttribute("data-effect-stagger");binding.effectLeaveStagger=+elem.getAttribute("data-effect-leave-stagger")||stagger,binding.effectEnterStagger=+elem.getAttribute("data-effect-enter-stagger")||stagger,binding.effectClass=elem.className||0/0}}function upperFirstChar(str){return str.replace(/^[\S]/g,function(m){return m.toUpperCase()})}function Effect(){}function getEffectClass(instance,type){var a=instance.callbacks[type+"Class"];return"string"==typeof a?a:"function"==typeof a?a():instance.name+"-"+type}function callEffectHook(effect,name,cb){var hook=effect.callbacks[name];hook&&hook.call(effect,effect.el,cb)}function getTemplateContainer(binding,id,text){var div=binding.templateCache&&binding.templateCache[id];if(div){for(var firstChild,dom=DOC.createDocumentFragment();firstChild=div.firstChild;)dom.appendChild(firstChild);return dom}return avalon.parseHTML(text)}function nodesToFrag(nodes){for(var frag=DOC.createDocumentFragment(),i=0,len=nodes.length;len>i;i++)frag.appendChild(nodes[i]);return frag}function animateRepeat(nodes,isEnter,binding){for(var node,i=0;node=nodes[i++];)node.className===binding.effectClass&&avalon.effect.apply(node,isEnter,noop,noop,binding)}function mayStaggerAnimate(staggerTime,callback,index){return staggerTime?setTimeout(callback,++index*staggerTime):callback(),index}function removeItem(node,binding){for(var fragment=avalonFragment.cloneNode(!1),last=node,breakText=last.nodeValue,staggerIndex=binding&&Math.max(+binding.staggerIndex,0),nodes=avalon.slice(last.parentNode.childNodes),index=nodes.indexOf(last);;){var pre=nodes[--index];if(!pre||0===String(pre.nodeValue).indexOf(breakText))break;binding&&pre.className===binding.effectClass?(node=pre,function(cur){binding.staggerIndex=mayStaggerAnimate(binding.effectLeaveStagger,function(){avalon.effect.apply(cur,0,noop,function(){fragment.appendChild(cur)},binding)},staggerIndex)}(pre)):fragment.insertBefore(pre,fragment.firstChild)}return fragment.appendChild(last),fragment}function shimController(data,transation,proxy,fragments,init){var content=data.template.cloneNode(!0),nodes=avalon.slice(content.childNodes);content.appendChild(proxy.$anchor),init&&transation.appendChild(content);var nv=[proxy].concat(data.vmodels),fragment={nodes:nodes,vmodels:nv,content:content};fragments.push(fragment)}function getProxyVM(binding){var agent="object"===binding.xtype?withProxyAgent:eachProxyAgent,proxy=agent(binding),node=proxy.$anchor||(proxy.$anchor=binding.element.cloneNode(!1));return node.nodeValue=binding.signature,proxy.$outer=binding.$outer,proxy}function eachProxyAgent(data,proxy){for(var itemName=data.param||"el",i=0,n=eachProxyPool.length;n>i;i++){var candidate=eachProxyPool[i];if(candidate&&candidate.hasOwnProperty(itemName)){eachProxyPool.splice(i,1),proxy=candidate;break}}return proxy||(proxy=eachProxyFactory(itemName)),proxy}function eachProxyFactory(itemName){var source={$outer:{},$index:0,$oldIndex:0,$anchor:null,$first:!1,$last:!1,$remove:avalon.noop};source[itemName]=0/0;var force={$last:1,$first:1,$index:1};force[itemName]=1;var proxy=modelFactory(source,{force:force});return proxy.$id=generateID("$proxy$each"),proxy}function decorateProxy(proxy,binding,type){if("array"===type){proxy.$remove=function(){binding.$repeat.removeAt(proxy.$index)};var param=binding.param;proxy.$watch(param,function(a){var index=proxy.$index;binding.$repeat[index]=a})}else proxy.$watch("$val",function(a){binding.$repeat[proxy.$key]=a})}function withProxyAgent(){return withProxyPool.pop()||withProxyFactory()}function withProxyFactory(){var proxy=modelFactory({$key:"",$val:0/0,$index:0,$oldIndex:0,$outer:{},$anchor:null},{force:{$key:1,$val:1,$index:1}});return proxy.$id=generateID("$proxy$with"),proxy}function proxyRecycler(cache,key,param){var proxy=cache[key];if(proxy){var proxyPool=0===proxy.$id.indexOf("$proxy$each")?eachProxyPool:withProxyPool;proxy.$outer={};for(var i in proxy.$events){var a=proxy.$events[i];Array.isArray(a)&&(a.length=0,i===param?proxy[param]=0/0:"$val"===i&&(proxy.$val=0/0))}proxyPool.unshift(proxy)>kernel.maxRepeatSize&&proxyPool.pop(),delete cache[key]}}function parseDisplay(nodeName,val){var key="_"+nodeName;if(!parseDisplay[key]){var node=DOC.createElement(nodeName);root.appendChild(node),val=W3C?getComputedStyle(node,null).display:node.currentStyle.display,root.removeChild(node),parseDisplay[key]=val}return parseDisplay[key]}function numberFormat(number,decimals,point,thousands){number=(number+"").replace(/[^0-9+\-Ee.]/g,"");var n=isFinite(+number)?+number:0,prec=isFinite(+decimals)?Math.abs(decimals):3,sep=thousands||",",dec=point||".",s="",toFixedFix=function(n,prec){var k=Math.pow(10,prec);return""+(Math.round(n*k)/k).toFixed(prec)};return s=(prec?toFixedFix(n,prec):""+Math.round(n)).split("."),s[0].length>3&&(s[0]=s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,sep)),(s[1]||"").length<prec&&(s[1]=s[1]||"",s[1]+=new Array(prec-s[1].length+1).join("0")),s.join(dec)}function doScrollCheck(){try{root.doScroll("left"),fireReady()}catch(e){setTimeout(doScrollCheck)}}var expose=new Date-0,DOC=window.document,head=DOC.getElementsByTagName("head")[0],ifGroup=head.insertBefore(document.createElement("avalon"),head.firstChild);ifGroup.innerHTML="X<style id='avalonStyle'>.avalonHide{ display: none!important }</style>",ifGroup.setAttribute("ms-skip","1"),ifGroup.className="avalonHide";var rnative=/\[native code\]/,subscribers="$"+expose,nullObject={},rword=/[^, ]+/g,rw20g=/\w+/g,rsvg=/^\[object SVG\w*Element\]$/,rwindow=/^\[object (?:Window|DOMWindow|global)\]$/,oproto=Object.prototype,ohasOwn=oproto.hasOwnProperty,serialize=oproto.toString,ap=Array.prototype,aslice=ap.slice,W3C=window.dispatchEvent,root=DOC.documentElement,avalonFragment=DOC.createDocumentFragment(),cinerator=DOC.createElement("div"),class2type={};"Boolean Number String Function Array Date RegExp Object Error".replace(rword,function(name){class2type["[object "+name+"]"]=name.toLowerCase()});var generateID=function(prefix){return prefix=prefix||"avalon",String(Math.random()+Math.random()).replace(/\d\.\d{4}/,prefix)},IEVersion=IE();avalon=function(el){return new avalon.init(el)},avalon.nextTick=new function(){function callback(){for(var n=queue.length,i=0;n>i;i++)queue[i]();queue=queue.slice(n)}var tickImmediate=window.setImmediate,tickObserver=window.MutationObserver;if(tickImmediate)return tickImmediate.bind(window);var queue=[];if(tickObserver){var node=document.createTextNode("avalon");new tickObserver(callback).observe(node,{characterData:!0});var bool=!1;return function(fn){queue.push(fn),bool=!bool,node.data=bool}}return function(fn){setTimeout(fn,4)}},avalon.init=function(el){this[0]=this.element=el},avalon.fn=avalon.prototype=avalon.init.prototype,avalon.type=function(obj){return null==obj?String(obj):"object"==typeof obj||"function"==typeof obj?class2type[serialize.call(obj)]||"object":typeof obj;

};var isFunction="object"==typeof alert?function(fn){try{return/^\s*\bfunction\b/.test(fn+"")}catch(e){return!1}}:function(fn){return"[object Function]"===serialize.call(fn)};avalon.isFunction=isFunction,avalon.isWindow=function(obj){return obj?obj==obj.document&&obj.document!=obj:!1},isWindow(window)&&(avalon.isWindow=isWindow);var enu;for(enu in avalon({}))break;var enumerateBUG="0"!==enu;avalon.isPlainObject=function(obj,key){if(!obj||"object"!==avalon.type(obj)||obj.nodeType||avalon.isWindow(obj))return!1;try{if(obj.constructor&&!ohasOwn.call(obj,"constructor")&&!ohasOwn.call(obj.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}if(enumerateBUG)for(key in obj)return ohasOwn.call(obj,key);for(key in obj);return void 0===key||ohasOwn.call(obj,key)},rnative.test(Object.getPrototypeOf)&&(avalon.isPlainObject=function(obj){return"[object Object]"===serialize.call(obj)&&Object.getPrototypeOf(obj)===oproto}),avalon.mix=avalon.fn.mix=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=!1;for("boolean"==typeof target&&(deep=target,target=arguments[1]||{},i++),"object"==typeof target||isFunction(target)||(target={}),i===length&&(target=this,i--);length>i;i++)if(null!=(options=arguments[i]))for(name in options){src=target[name];try{copy=options[name]}catch(e){continue}target!==copy&&(deep&&copy&&(avalon.isPlainObject(copy)||(copyIsArray=Array.isArray(copy)))?(copyIsArray?(copyIsArray=!1,clone=src&&Array.isArray(src)?src:[]):clone=src&&avalon.isPlainObject(src)?src:{},target[name]=avalon.mix(deep,clone,copy)):void 0!==copy&&(target[name]=copy))}return target},avalon.mix({rword:rword,subscribers:subscribers,version:1.54,ui:{},log:log,slice:W3C?function(nodes,start,end){return aslice.call(nodes,start,end)}:function(nodes,start,end){var ret=[],len=nodes.length;if(void 0===end&&(end=len),"number"==typeof end&&isFinite(end)){start=_number(start,len),end=_number(end,len);for(var i=start;end>i;++i)ret[i-start]=nodes[i]}return ret},noop:noop,error:function(str,e){throw(e||Error)(str)},oneObject:oneObject,range:function(start,end,step){step||(step=1),null==end&&(end=start||0,start=0);for(var index=-1,length=Math.max(0,Math.ceil((end-start)/step)),result=new Array(length);++index<length;)result[index]=start,start+=step;return result},eventHooks:{},bind:function(el,type,fn,phase){var hooks=avalon.eventHooks,hook=hooks[type];"object"==typeof hook&&(type=hook.type||type,phase=hook.phase||!!phase,fn=hook.fn?hook.fn(el,fn):fn);var callback=W3C?fn:function(e){fn.call(el,fixEvent(e))};return W3C?el.addEventListener(type,callback,phase):el.attachEvent("on"+type,callback),callback},unbind:function(el,type,fn,phase){var hooks=avalon.eventHooks,hook=hooks[type],callback=fn||noop;"object"==typeof hook&&(type=hook.type||type,phase=hook.phase||!!phase),W3C?el.removeEventListener(type,callback,phase):el.detachEvent("on"+type,callback)},css:function(node,name,value){node instanceof avalon&&(node=node[0]);var fn,prop=/[_-]/.test(name)?camelize(name):name;if(name=avalon.cssName(prop)||prop,void 0===value||"boolean"==typeof value){fn=cssHooks[prop+":get"]||cssHooks["@:get"],"background"===name&&(name="backgroundColor");var val=fn(node,name);return value===!0?parseFloat(val)||0:val}if(""===value)node.style[name]="";else{if(null==value||value!==value)return;isFinite(value)&&!avalon.cssNumber[prop]&&(value+="px"),fn=cssHooks[prop+":set"]||cssHooks["@:set"],fn(node,name,value)}},each:function(obj,fn){if(obj){var i=0;if(isArrayLike(obj))for(var n=obj.length;n>i&&fn(i,obj[i])!==!1;i++);else for(i in obj)if(obj.hasOwnProperty(i)&&fn(i,obj[i])===!1)break}},getWidgetData:function(elem,prefix){var raw=avalon(elem).data(),result={};for(var i in raw)0===i.indexOf(prefix)&&(result[i.replace(prefix,"").replace(/\w/,function(a){return a.toLowerCase()})]=raw[i]);return result},Array:{ensure:function(target,item){return-1===target.indexOf(item)?target.push(item):void 0},removeAt:function(target,index){return!!target.splice(index,1).length},remove:function(target,item){var index=target.indexOf(item);return~index?avalon.Array.removeAt(target,index):!1}}});var bindingHandlers=avalon.bindingHandlers={},bindingExecutors=avalon.bindingExecutors={},directives=avalon.directives={};avalon.directive=function(name,obj){return bindingHandlers[name]=obj.init=obj.init||noop,bindingExecutors[name]=obj.update=obj.update||noop,directives[name]=obj};var Cache=new function(){function LRU(maxLength){this.size=0,this.limit=maxLength,this.head=this.tail=void 0,this._keymap={}}var p=LRU.prototype;return p.put=function(key,value){var entry={key:key,value:value};return this._keymap[key]=entry,this.tail?(this.tail.newer=entry,entry.older=this.tail):this.head=entry,this.tail=entry,this.size===this.limit?this.shift():this.size++,value},p.shift=function(){var entry=this.head;entry&&(this.head=this.head.newer,this.head.older=entry.newer=entry.older=this._keymap[entry.key]=void 0,delete this._keymap[entry.key])},p.get=function(key){var entry=this._keymap[key];if(void 0!==entry)return entry===this.tail?entry.value:(entry.newer&&(entry===this.head&&(this.head=entry.newer),entry.newer.older=entry.older),entry.older&&(entry.older.newer=entry.newer),entry.newer=void 0,entry.older=this.tail,this.tail&&(this.tail.newer=entry),this.tail=entry,entry.value)},LRU};if(!"司徒正美".trim){var rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(rtrim,"")}}var hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString"),hasProtoEnumBug=function(){}.propertyIsEnumerable("prototype"),dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;if(Object.keys||(Object.keys=function(object){var theKeys=[],skipProto=hasProtoEnumBug&&"function"==typeof object;if("string"==typeof object||object&&object.callee)for(var i=0;i<object.length;++i)theKeys.push(String(i));else for(var name in object)skipProto&&"prototype"===name||!ohasOwn.call(object,name)||theKeys.push(String(name));if(hasDontEnumBug)for(var ctor=object.constructor,skipConstructor=ctor&&ctor.prototype===object,j=0;dontEnumsLength>j;j++){var dontEnum=dontEnums[j];skipConstructor&&"constructor"===dontEnum||!ohasOwn.call(object,dontEnum)||theKeys.push(dontEnum)}return theKeys}),Array.isArray||(Array.isArray=function(a){return"[object Array]"===serialize.call(a)}),noop.bind||(Function.prototype.bind=function(scope){if(arguments.length<2&&void 0===scope)return this;var fn=this,argv=arguments;return function(){var i,args=[];for(i=1;i<argv.length;i++)args.push(argv[i]);for(i=0;i<arguments.length;i++)args.push(arguments[i]);return fn.apply(scope,args)}}),rnative.test([].map)||avalon.mix(ap,{indexOf:function(item,index){var n=this.length,i=~~index;for(0>i&&(i+=n);n>i;i++)if(this[i]===item)return i;return-1},lastIndexOf:function(item,index){var n=this.length,i=null==index?n-1:index;for(0>i&&(i=Math.max(0,n+i));i>=0;i--)if(this[i]===item)return i;return-1},forEach:iterator("","_",""),filter:iterator("r=[],j=0,","if(_)r[j++]=this[i]","return r"),map:iterator("r=[],","r[i]=_","return r"),some:iterator("","if(_)return true","return false"),every:iterator("","if(!_)return false","return true")}),avalon.contains=fixContains,DOC.contains||(DOC.contains=function(b){return fixContains(DOC,b)}),window.SVGElement){DOC.createTextNode("x").contains||(Node.prototype.contains=function(arg){return!!(16&this.compareDocumentPosition(arg))});var svgns="http://www.w3.org/2000/svg",svg=DOC.createElementNS(svgns,"svg");svg.innerHTML='<circle cx="50" cy="50" r="40" fill="red" />',rsvg.test(svg.firstChild)||Object.defineProperties(SVGElement.prototype,{outerHTML:{enumerable:!0,configurable:!0,get:outerHTML,set:function(html){var tagName=this.tagName.toLowerCase(),par=this.parentNode,frag=avalon.parseHTML(html);if("svg"===tagName)par.insertBefore(frag,this);else{var newFrag=DOC.createDocumentFragment();enumerateNode(frag,newFrag),par.insertBefore(newFrag,this)}par.removeChild(this)}},innerHTML:{enumerable:!0,configurable:!0,get:function(){var s=this.outerHTML,ropen=new RegExp("<"+this.nodeName+'\\b(?:(["\'])[^"]*?(\\1)|[^>])*>',"i"),rclose=new RegExp("</"+this.nodeName+">$","i");return s.replace(ropen,"").replace(rclose,"")},set:function(html){if(avalon.clearHTML){avalon.clearHTML(this);var frag=avalon.parseHTML(html);enumerateNode(frag,this)}}}})}!root.outerHTML&&window.HTMLElement&&HTMLElement.prototype.__defineGetter__("outerHTML",outerHTML);var rmouseEvent=/^(?:mouse|contextmenu|drag)|click/,eventHooks=avalon.eventHooks;if("onmouseenter"in root||avalon.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(origType,fixType){eventHooks[origType]={type:fixType,fn:function(elem,fn){return function(e){var t=e.relatedTarget;return t&&(t===elem||16&elem.compareDocumentPosition(t))?void 0:(delete e.type,e.type=origType,fn.call(elem,e))}}}}),avalon.each({AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"},function(construct,fixType){window[construct]&&!eventHooks.animationend&&(eventHooks.animationend={type:fixType})}),"oninput"in DOC.createElement("input")||(eventHooks.input={type:"propertychange",deel:function(elem,fn){return function(e){return"value"===e.propertyName?(e.type="input",fn.call(elem,e)):void 0}}}),void 0===DOC.onmousewheel){var fixWheelType=void 0!==DOC.onwheel?"wheel":"DOMMouseScroll",fixWheelDelta="wheel"===fixWheelType?"deltaY":"detail";eventHooks.mousewheel={type:fixWheelType,fn:function(elem,fn){return function(e){e.wheelDeltaY=e.wheelDelta=e[fixWheelDelta]>0?-120:120,e.wheelDeltaX=0,Object.defineProperty&&Object.defineProperty(e,"type",{value:"mousewheel"}),fn.call(elem,e)}}}}var openTag,closeTag,rexpr,rexprg,rbind,rregexp=/[-.*+?^${}()|[\]\/\\]/g,plugins={interpolate:function(array){if(openTag=array[0],closeTag=array[1],openTag===closeTag){throw new SyntaxError("openTag!==closeTag")}kernel.openTag=openTag,kernel.closeTag=closeTag;var o=escapeRegExp(openTag),c=escapeRegExp(closeTag);rexpr=new RegExp(o+"(.*?)"+c),rexprg=new RegExp(o+"(.*?)"+c,"g"),rbind=new RegExp(o+".*?"+c+"|\\sms-")}};kernel.async=!0,kernel.debug=!0,kernel.plugins=plugins,kernel.plugins.interpolate(["{{","}}"]),kernel.paths={},kernel.shim={},kernel.maxRepeatSize=100,avalon.config=kernel;var VMODELS=avalon.vmodels={};avalon.define=function(source){var $id=source.$id;$id||log("warning: vm必须指定$id");var vmodel=modelFactory(source);return vmodel.$id=$id,VMODELS[$id]=vmodel};var $$skipArray=oneObject("$id,$watch,$fire,$events,$model,$skipArray,$active,$pathname,$up,$track,$accessors"),defineProperty=Object.defineProperty,canHideOwn=!0;try{defineProperty({},"_",{value:"x"});var defineProperties=Object.defineProperties}catch(e){canHideOwn=!1}var getKeys=rnative.test(Object.key)?Object.key:function(a){var ret=[];for(var i in a)a.hasOwnProperty(i)&&!$$skipArray[i]&&ret.push(i);return ret},$modelDescriptor={get:function(){return toJson(this)},set:noop,enumerable:!1,configurable:!0};if(!canHideOwn&&("__defineGetter__"in avalon&&(defineProperty=function(obj,prop,desc){return"value"in desc&&(obj[prop]=desc.value),"get"in desc&&obj.__defineGetter__(prop,desc.get),"set"in desc&&obj.__defineSetter__(prop,desc.set),obj},defineProperties=function(obj,descs){for(var prop in descs)descs.hasOwnProperty(prop)&&defineProperty(obj,prop,descs[prop]);return obj}),IEVersion)){var VBClassPool={};window.execScript(["Function parseVB(code)","	ExecuteGlobal(code)","End Function"].join("\n"),"VBScript"),defineProperties=function(name,accessors,properties){var buffer=[];buffer.push("\r\n	Private [__data__], [__proxy__]","	Public Default Function [__const__](d"+expose+", p"+expose+")","		Set [__data__] = d"+expose+": set [__proxy__] = p"+expose,"		Set [__const__] = Me","	End Function");var uniq={};for(name in accessors)uniq[name]=!0,buffer.push("	Public Property Let ["+name+"](val"+expose+")",'		Call [__proxy__](Me,[__data__], "'+name+'", val'+expose+")","	End Property","	Public Property Set ["+name+"](val"+expose+")",'		Call [__proxy__](Me,[__data__], "'+name+'", val'+expose+")","	End Property","	Public Property Get ["+name+"]","	On Error Resume Next","		Set["+name+'] = [__proxy__](Me,[__data__],"'+name+'")',"	If Err.Number <> 0 Then","		["+name+'] = [__proxy__](Me,[__data__],"'+name+'")',"	End If","	On Error Goto 0","	End Property");for(name in properties)uniq[name]!==!0&&(uniq[name]=!0,buffer.push("	Public ["+name+"]"));for(name in $$skipArray)uniq[name]!==!0&&(uniq[name]=!0,buffer.push("	Public ["+name+"]"));buffer.push("	Public [hasOwnProperty]"),buffer.push("End Class");var body=buffer.join("\r\n"),className=VBClassPool[body];className||(className=generateID("VBClass"),window.parseVB("Class "+className+body),window.parseVB(["Function "+className+"Factory(a, b)","	Dim o","	Set o = (New "+className+")(a, b)","	Set "+className+"Factory = o","End Function"].join("\r\n")),VBClassPool[body]=className);var ret=window[className+"Factory"](accessors,VBMediator);return ret}}var arrayMethods=["push","pop","shift","unshift","splice"],arrayProto=Array.prototype,newProto={notify:function(){$emit.call(this.$up,this.$pathname)},set:function(index,val){if(index>>>0===index&&this[index]!==val){if(index>this.length)throw Error(index+"set方法的第一个参数不能大于原数组长度");$emit.call(this.$up,this.$pathname+".*",[val,this[index]]),this.splice(index,1,val)}},contains:function(el){return-1!==this.indexOf(el)},ensure:function(el){return this.contains(el)||this.push(el),this},pushArray:function(arr){return this.push.apply(this,arr)},remove:function(el){return this.removeAt(this.indexOf(el))},removeAt:function(index){return index>>>0===index?this.splice(index,1):[]},size:function(){return this._.length},removeAll:function(all){if(Array.isArray(all))for(var i=this.length-1;i>=0;i--)-1!==all.indexOf(this[i])&&(_splice.call(this.$track,i,1),_splice.call(this,i,1));else if("function"==typeof all)for(i=this.length-1;i>=0;i--){var el=this[i];all(el,i)&&(_splice.call(this.$track,i,1),_splice.call(this,i,1))}else _splice.call(this.$track,0,this.length),_splice.call(this,0,this.length);W3C||(this.$model=toJson(this)),this.notify(),this._.length=this.length},clear:function(){return this.removeAll()}},_splice=arrayProto.splice;arrayMethods.forEach(function(method){var original=arrayProto[method];newProto[method]=function(){for(var args=[],i=0,n=arguments.length;n>i;i++)args[i]=observe(arguments[i],0,1,1);var result=original.apply(this,args);return addTrack(this.$track,method,args),W3C||(this.$model=toJson(this)),this.notify(),this._.length=this.length,result}}),"sort,reverse".replace(rword,function(method){newProto[method]=function(){var oldArray=this.concat(),newArray=this,mask=Math.random(),indexes=[],hasSort=!1;arrayProto[method].apply(newArray,arguments);for(var i=0,n=oldArray.length;n>i;i++){var neo=newArray[i],old=oldArray[i];if(neo===old)indexes.push(i);else{var index=oldArray.indexOf(neo);indexes.push(index),oldArray[index]=mask,hasSort=!0}}return hasSort&&(sortByIndex(this.$track,indexes),W3C||(this.$model=toJson(this)),this.notify()),this}});var dependencyDetection=function(){var currentFrame,outerFrames=[];return{begin:function(binding){outerFrames.push(currentFrame),currentFrame=binding},end:function(){currentFrame=outerFrames.pop()},collectDependency:function(array){currentFrame&&currentFrame.callback(array)}}}();avalon.injectBinding=function(binding){binding.handler=binding.handler||directives[binding.type].update||noop,binding.update=function(){var begin=!1;binding.getter||(begin=!0,dependencyDetection.begin({callback:function(array){injectDependency(array,binding)}}),binding.getter=parseExpr(binding.expr,binding.vmodels,binding),binding.observers.forEach(function(a){a.v.$watch(a.p,binding)}),delete binding.observers);try{var a,b,args=binding.fireArgs;if(delete binding.fireArgs,args?(a=args[0],b=args[1]):a="on"===binding.type?binding.getter+"":binding.getter.apply(0,binding.args),b="undefined"==typeof b?binding.oldValue:b,binding._filters&&(a=filters.$filter.apply(0,[a].concat(binding._filters))),binding.signature){var xtype=avalon.type(a);if("array"!==xtype&&"object"!==xtype)throw Error("warning:"+binding.expr+"只能是对象或数组");binding.xtype=xtype;var vtrack=getProxyIds(binding.proxies||[],xtype),mtrack=a.$track||("array"===xtype?createTrack(a.length):Object.keys(a));binding.track=mtrack,vtrack!==mtrack.join(";")&&(binding.handler(a,b),binding.oldValue=1)}else(Array.isArray(a)?a.length===(b&&b.length):1)?"oldValue"in binding&&a===b||(binding.handler(a,b),binding.oldValue=a):(binding.handler(a,b),binding.oldValue=a.concat())}catch(e){delete binding.getter,log("warning:exception throwed in [avalon.injectBinding] ",e);var node=binding.element;node&&3===node.nodeType&&(node.nodeValue=openTag+(binding.oneTime?"::":"")+binding.expr+closeTag)}finally{begin&&dependencyDetection.end()}},binding.update()};var disposeCount=0,disposeQueue=avalon.$$subscribers=[],beginTime=new Date,oldInfo={},tagHooks={area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],col:[2,"<table><colgroup>","</colgroup></table>"],legend:[1,"<fieldset>","</fieldset>"],option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],tr:[2,"<table>","</table>"],td:[3,"<table><tr>","</tr></table>"],g:[1,'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1">',"</svg>"],_default:W3C?[0,"",""]:[1,"X<div>","</div>"]};tagHooks.th=tagHooks.td,tagHooks.optgroup=tagHooks.option,tagHooks.tbody=tagHooks.tfoot=tagHooks.colgroup=tagHooks.caption=tagHooks.thead,String("circle,defs,ellipse,image,line,path,polygon,polyline,rect,symbol,text,use").replace(rword,function(tag){tagHooks[tag]=tagHooks.g});var rtagName=/<([\w:]+)/,rxhtml=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rcreate=W3C?/[^\d\D]/:/(<(?:script|link|style|meta|noscript))/gi,scriptTypes=oneObject(["","text/javascript","text/ecmascript","application/ecmascript","application/javascript"]),rnest=/<(?:tb|td|tf|th|tr|col|opt|leg|cap|area)/,script=DOC.createElement("script"),rhtml=/<|&#?\w+;/;avalon.parseHTML=function(html){var fragment=avalonFragment.cloneNode(!1);if("string"!=typeof html)return fragment;if(!rhtml.test(html))return fragment.appendChild(DOC.createTextNode(html)),fragment;html=html.replace(rxhtml,"<$1></$2>").trim();var firstChild,neo,tag=(rtagName.exec(html)||["",""])[1].toLowerCase(),wrap=tagHooks[tag]||tagHooks._default,wrapper=cinerator;W3C||(html=html.replace(rcreate,"<br class=msNoScope>$1")),wrapper.innerHTML=wrap[1]+html+wrap[2];var els=wrapper.getElementsByTagName("script");if(els.length)for(var el,i=0;el=els[i++];)scriptTypes[el.type]&&(neo=script.cloneNode(!1),ap.forEach.call(el.attributes,function(attr){attr&&attr.specified&&(neo[attr.name]=attr.value,neo.setAttribute(attr.name,attr.value))}),neo.text=el.text,el.parentNode.replaceChild(neo,el));if(!W3C){var target="X<div>"===wrap[1]?wrapper.lastChild.firstChild:wrapper.lastChild;if(target&&"TABLE"===target.tagName&&"tbody"!==tag)for(els=target.childNodes,i=0;el=els[i++];)if("TBODY"===el.tagName&&!el.innerHTML){target.removeChild(el);break}els=wrapper.getElementsByTagName("br");for(var n=els.length;el=els[--n];)"msNoScope"===el.className&&el.parentNode.removeChild(el);for(els=wrapper.all,i=0;el=els[i++];)isVML(el)&&fixVML(el)}for(i=wrap[0];i--;wrapper=wrapper.lastChild);for(;firstChild=wrapper.firstChild;)fragment.appendChild(firstChild);return fragment},avalon.innerHTML=function(node,html){if(!W3C&&!rcreate.test(html)&&!rnest.test(html))try{return void(node.innerHTML=html)}catch(e){}var a=this.parseHTML(html);this.clearHTML(node).appendChild(a)},avalon.clearHTML=function(node){for(node.textContent="";node.firstChild;)node.removeChild(node.firstChild);return node};var fakeClassListMethods={_toString:function(){var node=this.node,cls=node.className,str="string"==typeof cls?cls:cls.baseVal;return str.split(/\s+/).join(" ")},_contains:function(cls){return(" "+this+" ").indexOf(" "+cls+" ")>-1},_add:function(cls){this.contains(cls)||this._set(this+" "+cls)},_remove:function(cls){this._set((" "+this+" ").replace(" "+cls+" "," "))},__set:function(cls){cls=cls.trim();var node=this.node;rsvg.test(node)?node.setAttribute("class",cls):node.className=cls}};"add,remove".replace(rword,function(method){avalon.fn[method+"Class"]=function(cls){var el=this[0];return cls&&"string"==typeof cls&&el&&1===el.nodeType&&cls.replace(/\S+/g,function(c){fakeClassList(el)[method](c)}),this}}),avalon.fn.mix({hasClass:function(cls){var el=this[0]||{};return 1===el.nodeType&&fakeClassList(el).contains(cls)},toggleClass:function(value,stateVal){for(var className,i=0,classNames=String(value).split(/\s+/),isBool="boolean"==typeof stateVal;className=classNames[i++];){var state=isBool?stateVal:!this.hasClass(className);this[state?"addClass":"removeClass"](className)}return this},attr:function(name,value){return 2===arguments.length?(this[0].setAttribute(name,value),this):this[0].getAttribute(name)},data:function(name,value){switch(name="data-"+hyphen(name||""),arguments.length){case 2:return this.attr(name,value),this;case 1:var val=this.attr(name);return parseData(val);case 0:var ret={};return ap.forEach.call(this[0].attributes,function(attr){attr&&(name=attr.name,name.indexOf("data-")||(name=camelize(name.slice(5)),ret[name]=parseData(attr.value)))}),ret}},removeData:function(name){return name="data-"+hyphen(name),this[0].removeAttribute(name),this},css:function(name,value){if(avalon.isPlainObject(name))for(var i in name)avalon.css(this,i,name[i]);else var ret=avalon.css(this,name,value);return void 0!==ret?ret:this},position:function(){var offsetParent,offset,elem=this[0],parentOffset={top:0,left:0};if(elem)return"fixed"===this.css("position")?offset=elem.getBoundingClientRect():(offsetParent=this.offsetParent(),offset=this.offset(),"HTML"!==offsetParent[0].tagName&&(parentOffset=offsetParent.offset()),parentOffset.top+=avalon.css(offsetParent[0],"borderTopWidth",!0),parentOffset.left+=avalon.css(offsetParent[0],"borderLeftWidth",!0),parentOffset.top-=offsetParent.scrollTop(),parentOffset.left-=offsetParent.scrollLeft()),{top:offset.top-parentOffset.top-avalon.css(elem,"marginTop",!0),left:offset.left-parentOffset.left-avalon.css(elem,"marginLeft",!0)}},offsetParent:function(){for(var offsetParent=this[0].offsetParent;offsetParent&&"static"===avalon.css(offsetParent,"position");)offsetParent=offsetParent.offsetParent;return avalon(offsetParent||root)},bind:function(type,fn,phase){return this[0]?avalon.bind(this[0],type,fn,phase):void 0},unbind:function(type,fn,phase){return this[0]&&avalon.unbind(this[0],type,fn,phase),this},val:function(value){var node=this[0];if(node&&1===node.nodeType){var get=0===arguments.length,access=get?":get":":set",fn=valHooks[getValType(node)+access];if(fn)var val=fn(node,value);else{if(get)return(node.value||"").replace(/\r/g,"");node.value=value}}return get?val:this}});var rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rvalidchars=/^[\],:{}\s]*$/,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rvalidescape=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,rvalidtokens=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g;avalon.parseJSON=window.JSON?JSON.parse:function(data){if("string"==typeof data){if(data=data.trim(),data&&rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,"")))return new Function("return "+data)();avalon.error("Invalid JSON: "+data)}return data},avalon.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){avalon.fn[method]=function(val){var node=this[0]||{},win=getWindow(node),top="scrollTop"===method;return arguments.length?void(win?win.scrollTo(top?avalon(win).scrollLeft():val,top?val:avalon(win).scrollTop()):node[method]=val):win?prop in win?win[prop]:root[method]:node[method]}});var cssHooks=avalon.cssHooks={},prefixes=["","-webkit-","-o-","-moz-","-ms-"],cssMap={"float":W3C?"cssFloat":"styleFloat"};if(avalon.cssNumber=oneObject("animationIterationCount,columnCount,order,flex,flexGrow,flexShrink,fillOpacity,fontWeight,lineHeight,opacity,orphans,widows,zIndex,zoom"),avalon.cssName=function(name,host,camelCase){if(cssMap[name])return cssMap[name];host=host||root.style;for(var i=0,n=prefixes.length;n>i;i++)if(camelCase=camelize(prefixes[i]+name),camelCase in host)return cssMap[name]=camelCase;return null},cssHooks["@:set"]=function(node,name,value){try{node.style[name]=value}catch(e){}},window.getComputedStyle)cssHooks["@:get"]=function(node,name){if(!node||!node.style)throw new Error("getComputedStyle要求传入一个节点 "+node);var ret,styles=getComputedStyle(node,null);return styles&&(ret="filter"===name?styles.getPropertyValue(name):styles[name],""===ret&&(ret=node.style[name])),ret},cssHooks["opacity:get"]=function(node){var ret=cssHooks["@:get"](node,"opacity");return""===ret?"1":ret};else{var rnumnonpx=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,rposition=/^(top|right|bottom|left)$/,ralpha=/alpha\([^)]*\)/i,ie8=!!window.XDomainRequest,salpha="DXImageTransform.Microsoft.Alpha",border={thin:ie8?"1px":"2px",medium:ie8?"3px":"4px",thick:ie8?"5px":"6px"};cssHooks["@:get"]=function(node,name){var currentStyle=node.currentStyle,ret=currentStyle[name];if(rnumnonpx.test(ret)&&!rposition.test(ret)){var style=node.style,left=style.left,rsLeft=node.runtimeStyle.left;node.runtimeStyle.left=currentStyle.left,style.left="fontSize"===name?"1em":ret||0,ret=style.pixelLeft+"px",style.left=left,node.runtimeStyle.left=rsLeft}return"medium"===ret&&(name=name.replace("Width","Style"),"none"===currentStyle[name]&&(ret="0px")),""===ret?"auto":border[ret]||ret},cssHooks["opacity:set"]=function(node,name,value){var style=node.style,opacity=isFinite(value)&&1>=value?"alpha(opacity="+100*value+")":"",filter=style.filter||"";style.zoom=1,style.filter=(ralpha.test(filter)?filter.replace(ralpha,opacity):filter+" "+opacity).trim(),style.filter||style.removeAttribute("filter")},cssHooks["opacity:get"]=function(node){var alpha=node.filters.alpha||node.filters[salpha],op=alpha&&alpha.enabled?alpha.opacity:100;return op/100+""}}"top,left".replace(rword,function(name){cssHooks[name+":get"]=function(node){var computed=cssHooks["@:get"](node,name);return/px$/.test(computed)?computed:avalon(node).position()[name]+"px"}});var cssShow={position:"absolute",visibility:"hidden",display:"block"},rdisplayswap=/^(none|table(?!-c[ea]).+)/;"Width,Height".replace(rword,function(name){var method=name.toLowerCase(),clientProp="client"+name,scrollProp="scroll"+name,offsetProp="offset"+name;cssHooks[method+":get"]=function(node,which,override){var boxSizing=-4;"number"==typeof override&&(boxSizing=override),which="Width"===name?["Left","Right"]:["Top","Bottom"];var ret=node[offsetProp];return 2===boxSizing?ret+avalon.css(node,"margin"+which[0],!0)+avalon.css(node,"margin"+which[1],!0):(0>boxSizing&&(ret=ret-avalon.css(node,"border"+which[0]+"Width",!0)-avalon.css(node,"border"+which[1]+"Width",!0)),-4===boxSizing&&(ret=ret-avalon.css(node,"padding"+which[0],!0)-avalon.css(node,"padding"+which[1],!0)),ret)},cssHooks[method+"&get"]=function(node){var hidden=[];showHidden(node,hidden);for(var obj,val=cssHooks[method+":get"](node),i=0;obj=hidden[i++];){node=obj.node;for(var n in obj)"string"==typeof obj[n]&&(node.style[n]=obj[n])}return val},avalon.fn[method]=function(value){var node=this[0];if(0===arguments.length){if(node.setTimeout)return node["inner"+name]||node.document.documentElement[clientProp]||node.document.body[clientProp];if(9===node.nodeType){var doc=node.documentElement;return Math.max(node.body[scrollProp],doc[scrollProp],node.body[offsetProp],doc[offsetProp],doc[clientProp])}return cssHooks[method+"&get"](node)}return this.css(method,value)},avalon.fn["inner"+name]=function(){return cssHooks[method+":get"](this[0],void 0,-2)},avalon.fn["outer"+name]=function(includeMargin){return cssHooks[method+":get"](this[0],void 0,includeMargin===!0?2:0)}}),avalon.fn.offset=function(){var node=this[0],box={left:0,top:0};if(!node||!node.tagName||!node.ownerDocument)return box;var doc=node.ownerDocument,body=doc.body,root=doc.documentElement,win=doc.defaultView||doc.parentWindow;if(!avalon.contains(root,node))return box;node.getBoundingClientRect&&(box=node.getBoundingClientRect());var clientTop=root.clientTop||body.clientTop,clientLeft=root.clientLeft||body.clientLeft,scrollTop=Math.max(win.pageYOffset||0,root.scrollTop,body.scrollTop),scrollLeft=Math.max(win.pageXOffset||0,root.scrollLeft,body.scrollLeft);return{top:box.top+scrollTop-clientTop,left:box.left+scrollLeft-clientLeft}};var roption=/^<option(?:\s+\w+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s>]+))?)*\s+value[\s=]/i,valHooks={"option:get":IEVersion?function(node){return roption.test(node.outerHTML)?node.value:node.text.trim()}:function(node){return node.value},"select:get":function(node,value){for(var option,options=node.options,index=node.selectedIndex,getter=valHooks["option:get"],one="select-one"===node.type||0>index,values=one?null:[],max=one?index+1:options.length,i=0>index?max:one?index:0;max>i;i++)if(option=options[i],(option.selected||i===index)&&!option.disabled){if(value=getter(option),one)return value;values.push(value)}return values},"select:set":function(node,values,optionSet){values=[].concat(values);for(var el,getter=valHooks["option:get"],i=0;el=node.options[i++];)(el.selected=values.indexOf(getter(el))>-1)&&(optionSet=!0);optionSet||(node.selectedIndex=-1)}},keyMap={},keys=["break,case,catch,continue,debugger,default,delete,do,else,false","finally,for,function,if,in,instanceof,new,null,return,switch,this","throw,true,try,typeof,var,void,while,with","abstract,boolean,byte,char,class,const,double,enum,export,extends","final,float,goto,implements,import,int,interface,long,native","package,private,protected,public,short,static,super,synchronized","throws,transient,volatile","arguments,let,yield,undefined"].join(",");keys.replace(/\w+/g,function(a){keyMap[a]=!0});var ridentStart=/[a-z_$]/i,rwhiteSpace=/[\s\uFEFF\xA0]/,rproxy=/(\$proxy\$[a-z]+)\d+$/,variablePool=new Cache(218),evaluatorPool=new Cache(128);avalon.parseExprProxy=parseExpr;var rthimRightParentheses=/\)\s*$/,rthimOtherParentheses=/\)\s*\|/g,rquoteFilterName=/\|\s*([$\w]+)/g,rpatchBracket=/"\s*\["/g,rthimLeftParentheses=/"\s*\(/g,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},quote=window.JSON&&JSON.stringify||function(str){return'"'+str.replace(/[\\\"\x00-\x1f]/g,function(a){var c=meta[a];return"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"'};avalon.scan=function(elem,vmodel){elem=elem||root;var vmodels=vmodel?[].concat(vmodel):[];scanTag(elem,vmodels)};var stopScan=oneObject("area,base,basefont,br,col,command,embed,hr,img,input,link,meta,param,source,track,wbr,noscript,script,style,textarea".toUpperCase()),getBindingCallback=function(elem,name,vmodels){var callback=elem.getAttribute(name);if(callback)for(var vm,i=0;vm=vmodels[i++];)if(vm.hasOwnProperty(callback)&&"function"==typeof vm[callback])return vm[callback]},mergeTextNodes=IEVersion&&window.MutationObserver?function(elem){for(var text,node=elem.firstChild;node;){var aaa=node.nextSibling;3===node.nodeType?text?(text.nodeValue+=node.nodeValue,elem.removeChild(node)):text=node:text=null,node=aaa}}:0,roneTime=/^\s*::/,rmsAttr=/ms-(\w+)-?(.*)/,events=oneObject("animationend,blur,change,input,click,dblclick,focus,keydown,keypress,keyup,mousedown,mouseenter,mouseleave,mousemove,mouseout,mouseover,mouseup,scan,scroll,submit"),obsoleteAttrs=oneObject("value,title,alt,checked,selected,disabled,readonly,enabled,href,src"),rnoscanAttrBinding=/^if|widget|repeat$/,rnoscanNodeBinding=/^each|with|html|include$/;if(!W3C)var attrPool=new Cache(512),rattrs=/\s+([^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,rquote=/^['"]/,rtag=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/i,ramp=/&amp;/g,getAttributes=function(elem){var html=elem.outerHTML;if("</"===html.slice(0,2)||!html.trim())return[];var k,v,str=html.match(rtag)[0],attributes=[],ret=attrPool.get(str);

if(ret)return ret;for(;k=rattrs.exec(str);){v=k[2],v&&(v=(rquote.test(v)?v.slice(1,-1):v).replace(ramp,"&"));var name=k[1].toLowerCase();match=name.match(rmsAttr);var binding={name:name,specified:!0,value:v||""};attributes.push(binding)}return attrPool.put(str,attributes)};var rnoCollect=/^(ms-\S+|data-\S+|on[a-z]+|id|style|class|tabindex)$/,rhasHtml=/\|\s*html(?:\b|$)/,r11a=/\|\|/g,rstringLiteral=/(['"])(\\\1|.)+?\1/g,Buffer=function(){this.queue=[]};Buffer.prototype={render:function(isAnimate){if(!this.locked){this.locked=isAnimate?root.offsetHeight+10:1;var me=this;avalon.nextTick(function(){me.flush()})}},flush:function(){for(var sub,i=0;sub=this.queue[i++];)sub.update();this.locked=0,this.queue=[]}};var buffer=new Buffer,componentQueue=[],widgetList=[],componentHooks={$construct:function(){return avalon.mix.apply(null,arguments)},$ready:noop,$init:noop,$dispose:noop,$container:null,$childReady:noop,$replace:!1,$extend:null,$$template:function(str){return str}};avalon.components={},avalon.component=function(name,opts){opts&&(avalon.components[name]=avalon.mix({},componentHooks,opts));for(var obj,i=0;obj=componentQueue[i];i++)name===obj.fullName&&(componentQueue.splice(i,1),i--,function(host,hooks,elem,widget){var dependencies=1,library=host.library,global=avalon.libraries[library]||componentHooks,elemOpts=getOptionsFromTag(elem),vmOpts=getOptionsFromVM(host.vmodels,elemOpts.config||host.widget),$id=elemOpts.$id||elemOpts.identifier||generateID(widget);delete elemOpts.config,delete elemOpts.$id,delete elemOpts.identifier;var componentDefinition={},parentHooks=avalon.components[hooks.$extend];parentHooks?(avalon.mix(!0,componentDefinition,parentHooks),componentDefinition=parentHooks.$construct.call(elem,componentDefinition,{},{})):avalon.mix(!0,componentDefinition,hooks),componentDefinition=avalon.components[name].$construct.call(elem,componentDefinition,vmOpts,elemOpts),componentDefinition.$refs={},componentDefinition.$id=$id;var keepSolt=componentDefinition.$slot,keepReplace=componentDefinition.$replace,keepContainer=componentDefinition.$container,keepTemplate=componentDefinition.$template;delete componentDefinition.$slot,delete componentDefinition.$replace,delete componentDefinition.$container,delete componentDefinition.$template,delete componentDefinition.$construct;var vmodel=avalon.define(componentDefinition)||{};elem.msResolved=1,vmodel.$init(vmodel,elem),global.$init(vmodel,elem);for(var snode,el,nodes=elem.childNodes,slots={},s=0;el=nodes[s++];){var type=1===el.nodeType&&el.getAttribute("slot")||keepSolt;type&&(slots[type]?slots[type].push(el):slots[type]=[el])}vmodel.$$template&&(avalon.clearHTML(elem),elem.innerHTML=vmodel.$$template(keepTemplate));for(s in slots)if(vmodel.hasOwnProperty(s)){var ss=slots[s];if(ss.length){for(var fragment=avalonFragment.cloneNode(!0),ns=0;snode=ss[ns++];)fragment.appendChild(snode);vmodel[s]=fragment}slots[s]=null}slots=null;var child=elem.firstChild;keepReplace&&(child=elem.firstChild,elem.parentNode.replaceChild(child,elem),child.msResolved=1,elem=host.element=child),keepContainer&&keepContainer.appendChild(elem),avalon.fireDom(elem,"datasetchanged",{library:library,vm:vmodel,childReady:1});var children=0,removeFn=avalon.bind(elem,"datasetchanged",function(e){if(e.childReady&&e.library===library&&(dependencies+=e.childReady,vmodel!==e.vm&&(vmodel.$refs[e.vm.$id]=e.vm,-1===e.childReady&&(children++,vmodel.$childReady(vmodel,elem,e)),e.stopPropagation())),0===dependencies){var id1=setTimeout(function(){clearTimeout(id1),vmodel.$ready(vmodel,elem),global.$ready(vmodel,elem)},children?Math.max(17*children,100):17);avalon.unbind(elem,"datasetchanged",removeFn),host.rollback=function(){try{vmodel.$dispose(vmodel,elem),global.$dispose(vmodel,elem)}catch(e){}delete avalon.vmodels[vmodel.$id]},injectDisposeQueue(host,widgetList),window.chrome&&elem.addEventListener("DOMNodeRemovedFromDocument",function(){setTimeout(rejectDisposeQueue)})}});if(scanTag(elem,[vmodel].concat(host.vmodels)),avalon.vmodels[vmodel.$id]=vmodel,elem.childNodes.length)var id2=setTimeout(function(){clearTimeout(id2),avalon.fireDom(elem,"datasetchanged",{library:library,vm:vmodel,childReady:-1})},17);else avalon.fireDom(elem,"datasetchanged",{library:library,vm:vmodel,childReady:-1})}(obj,avalon.components[name],obj.element,obj.widget))},avalon.fireDom=function(elem,type,opts){if(DOC.createEvent){var hackEvent=DOC.createEvent("Events");hackEvent.initEvent(type,!0,!0,opts),avalon.mix(hackEvent,opts),elem.dispatchEvent(hackEvent)}else root.contains(elem)&&(hackEvent=DOC.createEventObject(),avalon.mix(hackEvent,opts),elem.fireEvent("on"+type,hackEvent))},avalon.libraries=[],avalon.library=function(name,opts){DOC.namespaces&&DOC.namespaces.add(name,"http://www.w3.org/1999/xhtml"),avalon.libraries[name]=avalon.mix({$init:noop,$ready:noop,$dispose:noop},opts||{})},avalon.library("ms");var bools=["autofocus,autoplay,async,allowTransparency,checked,controls","declare,disabled,defer,defaultChecked,defaultSelected","contentEditable,isMap,loop,multiple,noHref,noResize,noShade","open,readOnly,selected"].join(","),boolMap={};bools.replace(rword,function(name){boolMap[name.toLowerCase()]=name});var propMap={"accept-charset":"acceptCharset","char":"ch",charoff:"chOff","class":"className","for":"htmlFor","http-equiv":"httpEquiv"},anomaly=["accessKey,bgColor,cellPadding,cellSpacing,codeBase,codeType,colSpan","dateTime,defaultValue,frameBorder,longDesc,maxLength,marginWidth,marginHeight","rowSpan,tabIndex,useMap,vSpace,valueType,vAlign"].join(",");anomaly.replace(rword,function(name){propMap[name.toLowerCase()]=name});var attrDir=avalon.directive("attr",{init:function(binding){if(binding.expr=stringifyExpr(binding.expr.trim()),"include"===binding.type){var elem=binding.element;effectBinding(elem,binding),binding.includeRendered=getBindingCallback(elem,"data-include-rendered",binding.vmodels),binding.includeLoaded=getBindingCallback(elem,"data-include-loaded",binding.vmodels);var outer=binding.includeReplace=!!avalon(elem).data("includeReplace");avalon(elem).data("includeCache")&&(binding.templateCache={}),binding.start=DOC.createComment("ms-include"),binding.end=DOC.createComment("ms-include-end"),outer?(binding.element=binding.end,binding._element=elem,elem.parentNode.insertBefore(binding.start,elem),elem.parentNode.insertBefore(binding.end,elem.nextSibling)):(elem.insertBefore(binding.start,elem.firstChild),elem.appendChild(binding.end))}},update:function(val){var elem=this.element,attrName=this.param;if("href"===attrName||"src"===attrName){if("string"!=typeof val||root.hasAttribute||(val=val.replace(/&amp;/g,"&")),elem[attrName]=val,window.chrome&&"EMBED"===elem.tagName){var parent=elem.parentNode,comment=document.createComment("ms-src");parent.replaceChild(comment,elem),parent.replaceChild(elem,comment)}}else{var toRemove=val===!1||null===val||void 0===val;!W3C&&propMap[attrName]&&(attrName=propMap[attrName]);var bool=boolMap[attrName];if("boolean"==typeof elem[bool]&&(elem[bool]=!!val,val||(toRemove=!0)),toRemove)return elem.removeAttribute(attrName);var isInnate=rsvg.test(elem)?!1:DOC.namespaces&&isVML(elem)?!0:attrName in elem.cloneNode(!1);isInnate?elem[attrName]=val+"":elem.setAttribute(attrName,val)}}});"title,alt,src,value,css,include,href".replace(rword,function(name){directives[name]=attrDir}),avalon.directive("class",{init:function(binding){var oldStyle=binding.param,method=binding.type;if(!oldStyle||isFinite(oldStyle)?(binding.param="",directives.effect.init(binding)):(log("ms-"+method+'-xxx="yyy"这种用法已经过时,请使用ms-'+method+'="xxx:yyy"'),binding.expr="["+quote(oldStyle)+","+binding.expr+"]",binding.oldStyle=oldStyle),"hover"===method||"active"===method){if(!binding.hasBindEvent){var elem=binding.element,$elem=avalon(elem),activate="mouseenter",abandon="mouseleave";if("active"===method){elem.tabIndex=elem.tabIndex||-1,activate="mousedown",abandon="mouseup";var fn0=$elem.bind("mouseleave",function(){binding.toggleClass&&$elem.removeClass(binding.newClass)})}}var fn1=$elem.bind(activate,function(){binding.toggleClass&&$elem.addClass(binding.newClass)}),fn2=$elem.bind(abandon,function(){binding.toggleClass&&$elem.removeClass(binding.newClass)});binding.rollback=function(){$elem.unbind("mouseleave",fn0),$elem.unbind(activate,fn1),$elem.unbind(abandon,fn2)},binding.hasBindEvent=!0}},update:function(arr){var binding=this,$elem=avalon(this.element);binding.newClass=arr[0],binding.toggleClass=!!arr[1],binding.oldClass&&binding.newClass!==binding.oldClass&&$elem.removeClass(binding.oldClass),binding.oldClass=binding.newClass,"class"===binding.type&&(binding.oldStyle?$elem.toggleClass(binding.oldStyle,!!arr[1]):$elem.toggleClass(binding.newClass,binding.toggleClass))}}),"hover,active".replace(rword,function(name){directives[name]=directives["class"]}),avalon.directive("css",{init:directives.attr.init,update:function(val){avalon(this.element).css(this.param,val)}}),avalon.directive("data",{priority:100,update:function(val){var elem=this.element,key="data-"+this.param;val&&"object"==typeof val?elem[key]=val:elem.setAttribute(key,String(val))}});{var rduplexType=/^(?:checkbox|radio)$/,rduplexParam=/^(?:radio|checked)$/;avalon.directive("duplex",{priority:2e3,init:function(binding,hasCast){function callback(value){binding.changed.call(this,value,binding)}function compositionStart(){composing=!0}function compositionEnd(){composing=!1}var elem=binding.element,vmodels=binding.vmodels;binding.changed=getBindingCallback(elem,"data-duplex-changed",vmodels)||noop;var params=[],casting=oneObject("string,number,boolean,checked");"radio"===elem.type&&""===binding.param&&(binding.param="checked"),binding.param.replace(rw20g,function(name){rduplexType.test(elem.type)&&rduplexParam.test(name)&&("radio"===name&&log("ms-duplex-radio已经更名为ms-duplex-checked"),name="checked",binding.isChecked=!0,binding.xtype="radio"),"bool"===name?(name="boolean",log("ms-duplex-bool已经更名为ms-duplex-boolean")):"text"===name&&(name="string",log("ms-duplex-text已经更名为ms-duplex-string")),casting[name]&&(hasCast=!0),avalon.Array.ensure(params,name)}),hasCast||params.push("string"),binding.param=params.join("-"),binding.xtype||(binding.xtype="SELECT"===elem.tagName?"select":"checkbox"===elem.type?"checkbox":"radio"===elem.type?"radio":/^change/.test(elem.getAttribute("data-duplex-event"))?"change":"input"),binding.bound=function(type,callback){elem.addEventListener?elem.addEventListener(type,callback,!1):elem.attachEvent("on"+type,callback);var old=binding.rollback;binding.rollback=function(){elem.avalonSetter=null,avalon.unbind(elem,type,callback),old&&old()}};var composing=!1,updateVModel=function(){var val=elem.value;if(!composing&&val!==binding.oldValue){var lastValue=binding.pipe(val,binding,"get");try{binding.setter(lastValue),callback.call(elem,lastValue)}catch(ex){log(ex)}}};switch(binding.xtype){case"radio":binding.bound("click",function(){var lastValue=binding.pipe(elem.value,binding,"get");try{binding.setter(lastValue),callback.call(elem,lastValue)}catch(ex){log(ex)}});break;case"checkbox":binding.bound(W3C?"change":"click",function(){var method=elem.checked?"ensure":"remove",array=binding.getter.apply(0,binding.vmodels);Array.isArray(array)||(log("ms-duplex应用于checkbox上要对应一个数组"),array=[array]);var val=binding.pipe(elem.value,binding,"get");avalon.Array[method](array,val),callback.call(elem,array)});break;case"change":binding.bound("change",updateVModel);break;case"input":IEVersion?(IEVersion>8?binding.bound("input",updateVModel):binding.bound("propertychange",function(e){"value"===e.propertyName&&updateVModel()}),binding.bound("dragend",function(){setTimeout(function(){updateVModel()},17)})):(binding.bound("input",updateVModel),binding.bound("compositionstart",compositionStart),binding.bound("compositionend",compositionEnd),binding.bound("DOMAutoComplete",updateVModel));break;case"select":binding.bound("change",function(){var val=avalon(elem).val();if(val=Array.isArray(val)?val.map(function(v){return binding.pipe(v,binding,"get")}):binding.pipe(val,binding,"get"),val+""!==binding.oldValue)try{binding.setter(val),callback.call(elem,val)}catch(ex){log(ex)}})}binding.bound("focus",function(){elem.msFocus=!0}),binding.bound("blur",function(){elem.msFocus=!1}),"input"===binding.xtype&&/^(text|password|hidden)/.test(elem.type)&&(elem.avalonSetter=updateVModel,watchValueInTimer(function(){if(elem.contains(elem))this.msFocus||binding.oldValue===elem.value||updateVModel();else if(!elem.msRetain)return!1}))},update:function(value){var curValue,elem=this.element,binding=this;if(!this.init){for(var i in avalon.vmodels){var v=avalon.vmodels[i];v.$fire("avalon-ms-duplex-init",binding)}var cpipe=binding.pipe||(binding.pipe=pipe);cpipe(null,binding,"init"),this.init=1}switch(this.xtype){case"input":case"change":curValue=this.pipe(value,this,"set"),curValue!==this.oldValue&&(elem.value=this.oldValue=curValue);break;case"radio":curValue=binding.isChecked?!!value:value+""===elem.value,6===IEVersion?setTimeout(function(){elem.defaultChecked=curValue,elem.checked=curValue},31):elem.checked=curValue;break;case"checkbox":var array=[].concat(value);curValue=this.pipe(elem.value,this,"get"),elem.checked=array.indexOf(curValue)>-1;break;case"select":binding._value=value,elem.msHasEvent="selectDuplex",avalon.bind(elem,"datasetchanged",function(e){if("selectDuplex"===e.bubble){var value=binding._value,curValue=Array.isArray(value)?value.map(String):value+"";avalon(elem).val(curValue),elem.oldValue=curValue+"",binding.changed.call(elem,curValue)}})}"select"!==binding.xtype&&binding.changed.call(elem,curValue)}})}IEVersion&&avalon.bind(DOC,"selectionchange",function(){var el=DOC.activeElement;el&&"function"==typeof el.avalonSetter&&el.avalonSetter()}),avalon.duplexHooks={checked:{get:function(val,binding){return!binding.oldValue}},string:{get:function(val){return val},set:fixNull},"boolean":{get:function(val){return"true"===val},set:fixNull},number:{get:function(val,binding){var number=parseFloat(val+"");if(-val===-number)return number;var arr=/strong|medium|weak/.exec(binding.element.getAttribute("data-duplex-number"))||["medium"];switch(arr[0]){case"strong":return 0;case"medium":return""===val?"":0;case"weak":return val}},set:fixNull}};var TimerID,ribbon=[];avalon.tick=function(fn){1===ribbon.push(fn)&&(TimerID=setInterval(ticker,60))};var watchValueInTimer=noop;!new function(){function newSetter(value){setters[this.tagName].call(this,value),!this.msFocus&&this.avalonSetter&&this.oldValue!==value&&this.avalonSetter()}try{var setters={},aproto=HTMLInputElement.prototype,bproto=HTMLTextAreaElement.prototype,inputProto=HTMLInputElement.prototype;Object.getOwnPropertyNames(inputProto),setters.INPUT=Object.getOwnPropertyDescriptor(aproto,"value").set,Object.defineProperty(aproto,"value",{set:newSetter}),setters.TEXTAREA=Object.getOwnPropertyDescriptor(bproto,"value").set,Object.defineProperty(bproto,"value",{set:newSetter})}catch(e){watchValueInTimer=avalon.tick}},avalon.directive("effect",{priority:5,init:function(binding){var className,rightExpr,text=binding.expr,colonIndex=text.replace(rexprg,function(a){return a.replace(/./g,"0")}).indexOf(":");-1===colonIndex?(className=text,rightExpr=!0):(className=text.slice(0,colonIndex),rightExpr=text.slice(colonIndex+1)),className=rexpr.test(text)?stringifyExpr(className):quote(className),binding.expr="["+className+","+rightExpr+"]"},update:function(arr){var name=arr[0],elem=this.element;if(elem.getAttribute("data-effect-name")!==name){elem.removeAttribute("data-effect-driver");var inlineStyles=elem.style,computedStyles=window.getComputedStyle?window.getComputedStyle(elem):null,useAni=!1;if(computedStyles&&(supportTransition||supportAnimation)){var duration=inlineStyles[transitionDuration]||computedStyles[transitionDuration];duration&&"0s"!==duration&&(elem.setAttribute("data-effect-driver","t"),useAni=!0),useAni||(duration=inlineStyles[animationDuration]||computedStyles[animationDuration],duration&&"0s"!==duration&&(elem.setAttribute("data-effect-driver","a"),useAni=!0))}useAni||avalon.effects[name]&&(elem.setAttribute("data-effect-driver","j"),useAni=!0),useAni&&elem.setAttribute("data-effect-name",name)}}}),avalon.effects={},avalon.effect=function(name,callbacks){avalon.effects[name]=callbacks};var transitionEndEvent,animationEndEvent,supportTransition=!1,supportAnimation=!1,transitionDuration=avalon.cssName("transition-duration"),animationDuration=avalon.cssName("animation-duration");!new function(){var tran,checker={TransitionEvent:"transitionend",WebKitTransitionEvent:"webkitTransitionEnd",OTransitionEvent:"oTransitionEnd",otransitionEvent:"otransitionEnd"};for(var name in checker){if(window[name]){tran=checker[name];break}try{{document.createEvent(name)}tran=checker[name];break}catch(e){}}"string"==typeof tran&&(supportTransition=!0,transitionEndEvent=tran),checker={AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"};var ani;for(name in checker)if(window[name]){ani=checker[name];break}"string"==typeof ani&&(supportTransition=!0,animationEndEvent=ani)};var effectPool=[],effectBuffer=new Buffer;Effect.prototype={contrustor:Effect,enterClass:function(){return getEffectClass(this,"enter")},leaveClass:function(){return getEffectClass(this,"leave")},actionFun:function(name,before,after){if(!document.hidden){var me=this,el=me.el,isLeave="leave"===name;name=isLeave?"leave":"enter";var oppositeName=isLeave?"enter":"leave";callEffectHook(me,"abort"+upperFirstChar(oppositeName)),callEffectHook(me,"before"+upperFirstChar(name)),isLeave||before(el);var cssCallback=function(cancel){el.removeEventListener(me.cssEvent,me.cssCallback),isLeave?(before(el),avalon(el).removeClass(me.cssClass)):"a"===me.driver&&avalon(el).removeClass(me.cssClass),cancel!==!0&&(callEffectHook(me,"after"+upperFirstChar(name)),after&&after(el)),me.dispose()};me.useCss?(me.cssCallback&&me.cssCallback(!0),me.cssClass=getEffectClass(me,name),me.cssCallback=cssCallback,me.update=function(){el.addEventListener(me.cssEvent,me.cssCallback),isLeave||"t"!==me.driver||avalon(el).removeClass(me.cssClass)},avalon(el).addClass(me.cssClass),effectBuffer.render(!0),effectBuffer.queue.push(me)):callEffectHook(me,name,cssCallback)}},enter:function(){this.actionFun.apply(this,["enter"].concat(avalon.slice(arguments)))},leave:function(){this.actionFun.apply(this,["leave"].concat(avalon.slice(arguments)))},dispose:function(){this.update=this.cssCallback=null,effectPool.unshift(this)>100&&effectPool.pop()}};var applyEffect=function(el,dir){var args=aslice.call(arguments,0);"function"!=typeof args[2]&&args.splice(2,0,noop),"function"!=typeof args[3]&&args.splice(3,0,noop);var before=args[2],after=args[3],opts=args[4],effect=effectFactory(el,opts);if(!effect)return before(),after(),!1;var method=dir?"enter":"leave";effect[method](before,after)};avalon.mix(avalon.effect,{apply:applyEffect,append:function(el,parent,after,opts){return applyEffect(el,1,function(){parent.appendChild(el)},after,opts)},before:function(el,target,after,opts){return applyEffect(el,1,function(){target.parentNode.insertBefore(el,target)},after,opts)},remove:function(el,parent,after,opts){return applyEffect(el,0,function(){el.parentNode===parent&&parent.removeChild(el)},after,opts)}}),avalon.directive("html",{update:function(val){var binding=this,elem=this.element,isHtmlFilter=1!==elem.nodeType,parent=isHtmlFilter?elem.parentNode:elem;if(parent){if(val=null==val?"":val,3===elem.nodeType){var signature=generateID("html");parent.insertBefore(DOC.createComment(signature),elem),binding.element=DOC.createComment(signature+":end"),parent.replaceChild(binding.element,elem),elem=binding.element}if("object"!=typeof val)var fragment=avalon.parseHTML(String(val));else if(11===val.nodeType)fragment=val;else if(1===val.nodeType||val.item){var nodes=1===val.nodeType?val.childNodes:val.item;for(fragment=avalonFragment.cloneNode(!0);nodes[0];)fragment.appendChild(nodes[0])}if(nodes=avalon.slice(fragment.childNodes),isHtmlFilter){for(var endValue=elem.nodeValue.slice(0,-4);;){var node=elem.previousSibling;if(!node||8===node.nodeType&&node.nodeValue===endValue)break;parent.removeChild(node)}parent.insertBefore(fragment,elem)}else avalon.clearHTML(elem).appendChild(fragment);scanNodeArray(nodes,binding.vmodels)}}}),avalon.directive("if",{priority:10,update:function(val){function alway(){elem.getAttribute(binding.name)&&(elem.removeAttribute(binding.name),scanAttr(elem,binding.vmodels)),binding.rollback=null}var par,binding=this,elem=this.element,stamp=binding.stamp=+new Date,after=function(){stamp===binding.stamp&&(binding.recoverNode=null)};binding.recoverNode&&binding.recoverNode();try{if(!elem.parentNode)return;par=elem.parentNode}catch(e){return}if(val){if(8===elem.nodeType){var keep=binding.keep,hasEffect=avalon.effect.apply(keep,1,function(){stamp===binding.stamp&&(elem.parentNode.replaceChild(keep,elem),elem=binding.element=keep,keep.getAttribute("_required")&&(elem.required=!0,elem.removeAttribute("_required")),elem.querySelectorAll&&avalon.each(elem.querySelectorAll("[_required=true]"),function(el){el.required=!0,el.removeAttribute("_required")}),alway())},after);hasEffect=hasEffect===!1}hasEffect||alway()}else if(1===elem.nodeType){elem.required===!0&&(elem.required=!1,elem.setAttribute("_required","true"));try{avalon.each(elem.querySelectorAll(":required"),function(el){elem.required=!1,el.setAttribute("_required","true")})}catch(e){}var node=binding.element=DOC.createComment("ms-if"),pos=elem.nextSibling;binding.recoverNode=function(){binding.recoverNode=null,node.parentNode!==par&&(par.insertBefore(node,pos),binding.keep=elem)},avalon.effect.apply(elem,0,function(){binding.recoverNode=null,stamp===binding.stamp&&(elem.parentNode.replaceChild(node,elem),binding.keep=elem,ifGroup.appendChild(elem),binding.rollback=function(){elem.parentNode===ifGroup&&ifGroup.removeChild(elem)})},after)}}});var rnoscripts=/<noscript.*?>(?:[\s\S]+?)<\/noscript>/gim,rnoscriptText=/<noscript.*?>([\s\S]+?)<\/noscript>/im,getXHR=function(){return new(window.XMLHttpRequest||ActiveXObject)("Microsoft.XMLHTTP")},templatePool=avalon.templateCache={};avalon.directive("include",{init:directives.attr.init,update:function(val){var binding=this,elem=this.element,vmodels=binding.vmodels,rendered=binding.includeRendered,effectClass=binding.effectName&&binding.effectClass,templateCache=binding.templateCache,outer=binding.includeReplace,loaded=binding.includeLoaded,target=outer?elem.parentNode:elem,_ele=binding._element;binding.recoverNodes=binding.recoverNodes||avalon.noop;var scanTemplate=function(text){var _stamp=binding._stamp=+new Date;if(loaded){var newText=loaded.apply(target,[text].concat(vmodels));"string"==typeof newText&&(text=newText)}rendered&&checkScan(target,function(){rendered.call(target)},0/0);var lastID=binding.includeLastID||"_default";binding.includeLastID=val;var leaveEl=templateCache&&templateCache[lastID]||DOC.createElement(elem.tagName||binding._element.tagName);effectClass&&(leaveEl.className=effectClass,target.insertBefore(leaveEl,binding.start)),(templateCache||{})[lastID]=leaveEl;var fragOnDom=binding.recoverNodes();for(fragOnDom&&target.insertBefore(fragOnDom,binding.end);;){var node=binding.start.nextSibling;if(!node||node===leaveEl||node===binding.end)break;leaveEl.appendChild(node)}avalon.effect.remove(leaveEl,target,function(){templateCache&&_stamp===binding._stamp&&ifGroup.appendChild(leaveEl)},binding);var enterEl=target,before=avalon.noop,after=avalon.noop,fragment=getTemplateContainer(binding,val,text),nodes=avalon.slice(fragment.childNodes);outer&&effectClass?(enterEl=_ele,enterEl.innerHTML="",enterEl.setAttribute("ms-skip","true"),target.insertBefore(enterEl,binding.end.nextSibling),before=function(){enterEl.insertBefore(fragment,null)},after=function(){binding.recoverNodes=avalon.noop,_stamp===binding._stamp&&(fragment=nodesToFrag(nodes),target.insertBefore(fragment,binding.end),scanNodeArray(nodes,vmodels)),enterEl.parentNode===target&&target.removeChild(enterEl)},binding.recoverNodes=function(){return binding.recoverNodes=avalon.noop,nodesToFrag(nodes)}):before=function(){target.insertBefore(fragment,binding.end),scanNodeArray(nodes,vmodels)},avalon.effect.apply(enterEl,"enter",before,after)};if("src"===binding.param)if("string"==typeof templatePool[val])avalon.nextTick(function(){scanTemplate(templatePool[val])});else if(Array.isArray(templatePool[val]))templatePool[val].push(scanTemplate);else{var xhr=getXHR();xhr.onreadystatechange=function(){if(4===xhr.readyState){var s=xhr.status;if(s>=200&&300>s||304===s||1223===s){for(var fn,text=xhr.responseText,f=0;fn=templatePool[val][f++];)fn(text);templatePool[val]=text}else log("ms-include load ["+val+"] error")}},templatePool[val]=[scanTemplate],xhr.open("GET",val,!0),"withCredentials"in xhr&&(xhr.withCredentials=!0),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.send(null)}else{var el=val&&1===val.nodeType?val:DOC.getElementById(val);if(el){if("NOSCRIPT"===el.tagName&&!el.innerHTML&&!el.fixIE78){xhr=getXHR(),xhr.open("GET",location,!1),xhr.send(null);for(var noscripts=DOC.getElementsByTagName("noscript"),array=(xhr.responseText||"").match(rnoscripts)||[],n=array.length,i=0;n>i;i++){var tag=noscripts[i];tag&&(tag.style.display="none",tag.fixIE78=(array[i].match(rnoscriptText)||["","&nbsp;"])[1])}}avalon.nextTick(function(){scanTemplate(el.fixIE78||el.value||el.innerText||el.innerHTML)})}}}});var rdash=/\(([^)]*)\)/,onDir=avalon.directive("on",{priority:3e3,init:function(binding){var value=binding.expr;binding.type="on";var eventType=binding.param.replace(/-\d+$/,"");if("function"==typeof onDir[eventType+"Hook"]&&onDir[eventType+"Hook"](binding),value.indexOf("(")>0&&value.indexOf(")")>-1){var matched=(value.match(rdash)||["",""])[1].trim();(""===matched||"$event"===matched)&&(value=value.replace(rdash,""))}binding.expr=value},update:function(callback){var binding=this,elem=this.element;callback=function(e){var fn=binding.getter||noop;return fn.apply(this,binding.args.concat(e))};var eventType=binding.param.replace(/-\d+$/,"");if("scan"===eventType)callback.call(elem,{type:eventType});else if("function"==typeof binding.specialBind)binding.specialBind(elem,callback);else var removeFn=avalon.bind(elem,eventType,callback);binding.rollback=function(){"function"==typeof binding.specialUnbind?binding.specialUnbind():avalon.unbind(elem,eventType,removeFn)}}});avalon.directive("repeat",{priority:90,init:function(binding){var type=binding.type;binding.cache={},binding.enterCount=0;var elem=binding.element;if(1===elem.nodeType){elem.removeAttribute(binding.name),effectBinding(elem,binding),binding.param=binding.param||"el",binding.sortedCallback=getBindingCallback(elem,"data-with-sorted",binding.vmodels);var rendered=getBindingCallback(elem,"data-"+type+"-rendered",binding.vmodels),signature=generateID(type),start=DOC.createComment(signature+":start"),end=binding.element=DOC.createComment(signature+":end");if(binding.signature=signature,binding.start=start,binding.template=avalonFragment.cloneNode(!1),"repeat"===type){var parent=elem.parentNode;parent.replaceChild(end,elem),parent.insertBefore(start,end),binding.template.appendChild(elem)}else{for(;elem.firstChild;)binding.template.appendChild(elem.firstChild);elem.appendChild(start),elem.appendChild(end),parent=elem}if(binding.element=end,rendered)var removeFn=avalon.bind(parent,"datasetchanged",function(){rendered.apply(parent,parent.args),avalon.unbind(parent,"datasetchanged",removeFn),parent.msRendered=rendered})}},update:function(value,oldValue){var binding=this,xtype=this.xtype;this.enterCount+=1;var init=!oldValue;if(init){binding.$outer={};var check0="$key",check1="$val";"array"===xtype&&(check0="$first",check1="$last");for(var v,i=0;v=binding.vmodels[i++];)if(v.hasOwnProperty(check0)&&v.hasOwnProperty(check1)){binding.$outer=v;break}}var track=this.track;if(binding.sortedCallback){var keys2=binding.sortedCallback.call(parent,track);keys2&&Array.isArray(keys2)&&(track=keys2)}var action="move";binding.$repeat=value;var fragments=[],transation=init&&avalonFragment.cloneNode(!1),proxies=[],param=this.param,retain=avalon.mix({},this.cache),elem=this.element,length=track.length,parent=elem.parentNode;for(i=0;length>i;i++){var keyOrId=track[i],proxy=retain[keyOrId];if(proxy)fragments.push({}),retain[keyOrId]=!0;else{proxy=getProxyVM(this),"array"===xtype?(action="add",proxy.$id=keyOrId,proxy[param]=value[i]):(action="append",proxy.$key=keyOrId,proxy.$val=value[keyOrId]),this.cache[keyOrId]=proxy;var node=proxy.$anchor||(proxy.$anchor=elem.cloneNode(!1));node.nodeValue=this.signature,shimController(binding,transation,proxy,fragments,init&&!binding.effectDriver),decorateProxy(proxy,binding,xtype)}1===this.enterCount&&(proxy.$active=!1,proxy.$oldIndex=proxy.$index,proxy.$active=!0,proxy.$index=i),"array"===xtype?(proxy.$first=0===i,proxy.$last=i===length-1):proxy.$val=toJson(value[keyOrId]),proxies.push(proxy)}if(this.proxies=proxies,init&&!binding.effectDriver)parent.insertBefore(transation,elem),fragments.forEach(function(fragment){scanNodeArray(fragment.nodes||[],fragment.vmodels),fragment.nodes=fragment.vmodels=null});else{var staggerIndex=binding.staggerIndex=0;for(keyOrId in retain)retain[keyOrId]!==!0&&(action="del",removeItem(retain[keyOrId].$anchor,binding),proxyRecycler(this.cache,keyOrId,param),retain[keyOrId]=null);for(i=0;length>i;i++){proxy=proxies[i],keyOrId="array"===xtype?proxy.$id:proxy.$key;var pre=proxies[i-1],preEl=pre?pre.$anchor:binding.start;retain[keyOrId]?proxy.$index!==proxy.$oldIndex&&!function(proxy2,preElement){staggerIndex=mayStaggerAnimate(binding.effectEnterStagger,function(){var curNode=removeItem(proxy2.$anchor),inserted=avalon.slice(curNode.childNodes);parent.insertBefore(curNode,preElement.nextSibling),animateRepeat(inserted,1,binding)},staggerIndex)}(proxy,preEl):!function(fragment,preElement){var nodes=fragment.nodes,vmodels=fragment.vmodels;nodes&&(staggerIndex=mayStaggerAnimate(binding.effectEnterStagger,function(){parent.insertBefore(fragment.content,preElement.nextSibling),scanNodeArray(nodes,vmodels),animateRepeat(nodes,1,binding)},staggerIndex)),fragment.nodes=fragment.vmodels=null}(fragments[i],preEl)}}if(!value.$track)for(keyOrId in this.cache)proxyRecycler(this.cache,keyOrId,param);!function(args){parent.args=args,parent.msRendered&&parent.msRendered.apply(parent,args)}(kernel.newWatch?arguments:[action]);var id=setTimeout(function(){clearTimeout(id),avalon.fireDom(parent,"datasetchanged",{bubble:parent.msHasEvent})});this.enterCount-=1}}),"with,each".replace(rword,function(name){directives[name]=avalon.mix({},directives.repeat,{priority:1400})});var eachProxyPool=[],withProxyPool=[];avalon.directive("text",{update:function(value){var elem=this.element;if(value=null==value?"":value,3===elem.nodeType)try{elem.data=value}catch(e){}else"textContent"in elem?elem.textContent=value:elem.innerText=value}}),avalon.parseDisplay=parseDisplay,avalon.directive("visible",{init:function(){},update:function(val){var elem=this.element,binding=this,stamp=binding.stamp=+new Date;val?(elem.style.display="none",avalon.effect.apply(elem,1,function(){if(stamp===binding.stamp){var data=elem.getAttribute("data-effect-driver")||"a";/^[atn]/.test(data)&&(this.effectName||(elem.style.display=""),"none"===avalon(elem).css("display")&&(elem.style.display=parseDisplay(elem.nodeName)))}})):avalon.effect.apply(elem,0,function(){stamp===binding.stamp&&(elem.style.display="none")})}});var rscripts=/<script[^>]*>([\S\s]*?)<\/script\s*>/gim,ron=/\s+(on[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,ropen=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/gi,rsanitize={a:/\b(href)\=("javascript[^"]*"|'javascript[^']*')/gi,img:/\b(src)\=("javascript[^"]*"|'javascript[^']*')/gi,form:/\b(action)\=("javascript[^"]*"|'javascript[^']*')/gi},rsurrogate=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,rnoalphanumeric=/([^\#-~| |!])/g,filters=avalon.filters={uppercase:function(str){return str.toUpperCase()},lowercase:function(str){
return str.toLowerCase()},truncate:function(str,length,truncation){return length=length||30,truncation="string"==typeof truncation?truncation:"...",str.length>length?str.slice(0,length-truncation.length)+truncation:String(str)},$filter:function(val){for(var i=1,n=arguments.length;n>i;i++){var array=arguments[i],fn=avalon.filters[array[0]];if("function"==typeof fn){var arr=[val].concat(array.slice(1));val=fn.apply(null,arr)}}return val},camelize:camelize,sanitize:function(str){return str.replace(rscripts,"").replace(ropen,function(a){var match=a.toLowerCase().match(/<(\w+)\s/);if(match){var reg=rsanitize[match[1]];reg&&(a=a.replace(reg,function(s,name,value){var quote=value.charAt(0);return name+"="+quote+"javascript:void(0)"+quote}))}return a.replace(ron," ").replace(/\s+/g," ")})},escape:function(str){return String(str).replace(/&/g,"&amp;").replace(rsurrogate,function(value){var hi=value.charCodeAt(0),low=value.charCodeAt(1);return"&#"+(1024*(hi-55296)+(low-56320)+65536)+";"}).replace(rnoalphanumeric,function(value){return"&#"+value.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")},currency:function(amount,symbol,fractionSize){return(symbol||"￥")+numberFormat(amount,isFinite(fractionSize)?fractionSize:2)},number:numberFormat};!new function(){function toInt(str){return parseInt(str,10)||0}function padNumber(num,digits,trim){var neg="";for(0>num&&(neg="-",num=-num),num=""+num;num.length<digits;)num="0"+num;return trim&&(num=num.substr(num.length-digits)),neg+num}function dateGetter(name,size,offset,trim){return function(date){var value=date["get"+name]();return(offset>0||value>-offset)&&(value+=offset),0===value&&-12===offset&&(value=12),padNumber(value,size,trim)}}function dateStrGetter(name,shortForm){return function(date,formats){var value=date["get"+name](),get=(shortForm?"SHORT"+name:name).toUpperCase();return formats[get][value]}}function timeZoneGetter(date){var zone=-1*date.getTimezoneOffset(),paddedZone=zone>=0?"+":"";return paddedZone+=padNumber(Math[zone>0?"floor":"ceil"](zone/60),2)+padNumber(Math.abs(zone%60),2)}function ampmGetter(date,formats){return date.getHours()<12?formats.AMPMS[0]:formats.AMPMS[1]}var DATE_FORMATS={yyyy:dateGetter("FullYear",4),yy:dateGetter("FullYear",2,0,!0),y:dateGetter("FullYear",1),MMMM:dateStrGetter("Month"),MMM:dateStrGetter("Month",!0),MM:dateGetter("Month",2,1),M:dateGetter("Month",1,1),dd:dateGetter("Date",2),d:dateGetter("Date",1),HH:dateGetter("Hours",2),H:dateGetter("Hours",1),hh:dateGetter("Hours",2,-12),h:dateGetter("Hours",1,-12),mm:dateGetter("Minutes",2),m:dateGetter("Minutes",1),ss:dateGetter("Seconds",2),s:dateGetter("Seconds",1),sss:dateGetter("Milliseconds",3),EEEE:dateStrGetter("Day"),EEE:dateStrGetter("Day",!0),a:ampmGetter,Z:timeZoneGetter},rdateFormat=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/,raspnetjson=/^\/Date\((\d+)\)\/$/;filters.date=function(date,format){var fn,match,locate=filters.date.locate,text="",parts=[];if(format=format||"mediumDate",format=locate[format]||format,"string"==typeof date)if(/^\d+$/.test(date))date=toInt(date);else if(raspnetjson.test(date))date=+RegExp.$1;else{var trimDate=date.trim(),dateArray=[0,0,0,0,0,0,0],oDate=new Date(0);trimDate=trimDate.replace(/^(\d+)\D(\d+)\D(\d+)/,function(_,a,b,c){var array=4===c.length?[c,a,b]:[a,b,c];return dateArray[0]=toInt(array[0]),dateArray[1]=toInt(array[1])-1,dateArray[2]=toInt(array[2]),""});var dateSetter=oDate.setFullYear,timeSetter=oDate.setHours;trimDate=trimDate.replace(/[T\s](\d+):(\d+):?(\d+)?\.?(\d)?/,function(_,a,b,c,d){return dateArray[3]=toInt(a),dateArray[4]=toInt(b),dateArray[5]=toInt(c),d&&(dateArray[6]=Math.round(1e3*parseFloat("0."+d))),""});var tzHour=0,tzMin=0;trimDate=trimDate.replace(/Z|([+-])(\d\d):?(\d\d)/,function(z,symbol,c,d){return dateSetter=oDate.setUTCFullYear,timeSetter=oDate.setUTCHours,symbol&&(tzHour=toInt(symbol+c),tzMin=toInt(symbol+d)),""}),dateArray[3]-=tzHour,dateArray[4]-=tzMin,dateSetter.apply(oDate,dateArray.slice(0,3)),timeSetter.apply(oDate,dateArray.slice(3)),date=oDate}if("number"==typeof date&&(date=new Date(date)),"date"===avalon.type(date)){for(;format;)match=rdateFormat.exec(format),match?(parts=parts.concat(match.slice(1)),format=parts.pop()):(parts.push(format),format=null);return parts.forEach(function(value){fn=DATE_FORMATS[value],text+=fn?fn(date,locate):value.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),text}};var locate={AMPMS:{0:"上午",1:"下午"},DAY:{0:"星期日",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},MONTH:{0:"1月",1:"2月",2:"3月",3:"4月",4:"5月",5:"6月",6:"7月",7:"8月",8:"9月",9:"10月",10:"11月",11:"12月"},SHORTDAY:{0:"周日",1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六"},fullDate:"y年M月d日EEEE",longDate:"y年M月d日",medium:"yyyy-M-d H:mm:ss",mediumDate:"yyyy-M-d",mediumTime:"H:mm:ss","short":"yy-M-d ah:mm",shortDate:"yy-M-d",shortTime:"ah:mm"};locate.SHORTMONTH=locate.MONTH,filters.date.locate=locate};var modules=avalon.modules={"domReady!":{exports:avalon,state:3},avalon:{exports:avalon,state:4}};modules.exports=modules.avalon;var innerRequire,otherRequire=window.require,otherDefine=window.define;plugins.loader=function(builtin){var flag=innerRequire&&builtin;window.require=flag?innerRequire:otherRequire,window.define=flag?innerRequire.define:otherDefine},new function(){function makeRequest(name,config){var res="js";name=name.replace(/^(\w+)\!/,function(a,b){return res=b,""}),"ready"===res&&(log("debug: ready!已经被废弃，请使用domReady!"),res="domReady");var query="";name=name.replace(rquery,function(a){return query=a,""});var suffix="."+res,ext=/js|css/.test(suffix)?suffix:"";name=name.replace(/\.[a-z0-9]+$/g,function(a){return a===suffix?(ext=a,""):a});var req=avalon.mix({query:query,ext:ext,res:res,name:name,toUrl:toUrl},config);return req.toUrl(name),req}function fireRequest(req){var name=req.name,res=req.res,module=modules[name],urlNoQuery=name&&req.urlNoQuery;if(module&&module.state>=1)return name;if(module=modules[urlNoQuery],module&&module.state>=3)return innerRequire(module.deps||[],module.factory,urlNoQuery),urlNoQuery;if(name&&!module){module=modules[urlNoQuery]={id:urlNoQuery,state:1};var wrap=function(obj){resources[res]=obj,obj.load(name,req,function(a){arguments.length&&void 0!==a&&(module.exports=a),module.state=4,checkDeps()})};resources[res]?wrap(resources[res]):innerRequire([res],wrap)}return name?urlNoQuery:res+"!"}function checkCycle(deps,nick){for(var id,i=0;id=deps[i++];)if(4!==modules[id].state&&(id===nick||checkCycle(modules[id].deps,nick)))return!0}function checkFail(node,onError,fuckIE){var id=trimQuery(node.src);return node.onload=node.onreadystatechange=node.onerror=null,onError||fuckIE&&modules[id]&&!modules[id].state?(setTimeout(function(){head.removeChild(node),node=null}),void log("debug: 加载 "+id+" 失败"+onError+" "+!modules[id].state)):!0}function checkDeps(){loop:for(var id,i=loadings.length;id=loadings[--i];){var obj=modules[id],deps=obj.deps;if(deps){for(var key,j=0;key=deps[j];j++)if(4!==Object(modules[key]).state)continue loop;4!==obj.state&&(loadings.splice(i,1),fireFactory(obj.id,obj.deps,obj.factory),checkDeps())}}}function loadJS(url,id,callback){function onload(){var factory=factorys.pop();factory&&factory.require(id),callback&&callback(),checkFail(node,!1,!supportLoad)&&(log("debug: 已成功加载 "+url),id&&loadings.push(id),checkDeps())}var node=DOC.createElement("script"),supportLoad="onload"in node,onEvent=supportLoad?"onload":"onreadystatechange";node[onEvent]=supportLoad?onload:function(){rreadyState.test(node.readyState)&&onload()},node.onerror=function(){checkFail(node,!0)},node.className=subscribers,node.src=url,head.insertBefore(node,head.firstChild),log("debug: 正准备加载 "+url)}function trimQuery(url){return(url||"").replace(rquery,"")}function isAbsUrl(path){return/^(?:[a-z]+:)?\/\//i.test(String(path))}function getFullUrl(node,src){return"1"[0]?node[src]:node.getAttribute(src,4)}function getCurrentScript(){var stack;try{a.b.c()}catch(e){stack=e.stack,!stack&&window.opera&&(stack=(String(e).match(/of linked script \S+/g)||[]).join(" "))}if(stack)return stack=stack.split(/[@ ]/g).pop(),stack="("===stack[0]?stack.slice(1,-1):stack.replace(/\s/,""),trimQuery(stack.replace(/(:\d+)?:\d+$/i,""));for(var node,nodes=head.getElementsByTagName("script"),i=nodes.length;node=nodes[--i];)if(node.className===subscribers&&"interactive"===node.readyState){var url=getFullUrl(node,"src");return node.className=trimQuery(url)}}function fireFactory(id,deps,factory){var module=Object(modules[id]);module.state=4;for(var d,i=0,array=[];d=deps[i++];)if("exports"===d){var obj=module.exports||(module.exports={});array.push(obj)}else array.push(modules[d].exports);try{var ret=factory.apply(window,array)}catch(e){log("执行["+id+"]模块的factory抛错： ",e)}return void 0!==ret&&(module.exports=ret),rcallback.test(id)&&delete modules[id],delete module.factory,ret}function toUrl(id){0===id.indexOf(this.res+"!")&&(id=id.slice(this.res.length+1));var url=id,usePath=0,baseUrl=this.baseUrl,rootUrl=this.parentUrl||baseUrl;eachIndexArray(id,kernel.paths,function(value,key){url=url.replace(key,value),usePath=1}),usePath||eachIndexArray(id,kernel.packages,function(value,key,item){url=url.replace(item.name,item.location)}),this.mapUrl&&eachIndexArray(this.mapUrl,kernel.map,function(array){eachIndexArray(url,array,function(mdValue,mdKey){url=url.replace(mdKey,mdValue),rootUrl=baseUrl})});var ext=this.ext;ext&&usePath&&url.slice(-ext.length)===ext&&(url=url.slice(0,-ext.length)),isAbsUrl(url)||(rootUrl=this.built||/^\w/.test(url)?baseUrl:rootUrl,url=joinPath(rootUrl,url));var urlNoQuery=url+ext;return url=urlNoQuery+this.query,urlNoQuery=url.replace(rquery,function(a){return this.query=a,""}),eachIndexArray(id,kernel.urlArgs,function(value){url+=(-1===url.indexOf("?")?"?":"&")+value}),this.url=url,this.urlNoQuery=urlNoQuery}function makeIndexArray(hash,useStar,part){var index=hash2array(hash,useStar,part);return index.sort(descSorterByName),index}function makeMatcher(prefix){return new RegExp("^"+prefix+"(/|$)")}function makeExports(value){return function(){var ret;return value.init&&(ret=value.init.apply(window,arguments)),ret||value.exports&&getGlobal(value.exports)}}function hash2array(hash,useStar,part){var array=[];for(var key in hash)if(ohasOwn.call(hash,key)){var item={name:key,val:hash[key]};array.push(item),item.reg="*"===key&&useStar?/^/:makeMatcher(key),part&&"*"!==key&&(item.reg=new RegExp("/"+key.replace(/^\//,"")+"(/|$)"))}return array}function eachIndexArray(moduleID,array,matcher){array=array||[];for(var el,i=0;el=array[i++];)if(el.reg.test(moduleID))return matcher(el.val,el.name,el),!1}function descSorterByName(a,b){var aaa=a.name,bbb=b.name;return"*"===bbb?-1:"*"===aaa?1:bbb.length-aaa.length}function joinPath(a,b){if("/"!==a.charAt(a.length-1)&&(a+="/"),"./"===b.slice(0,2))return a+b.slice(2);if(".."===b.slice(0,2)){for(a+=b;rdeuce.test(a);)a=a.replace(rdeuce,"");return a}return"/"===b.slice(0,1)?a+b.slice(1):a+b}function getGlobal(value){if(!value)return value;var g=window;return value.split(".").forEach(function(part){g=g[part]}),g}var loadings=[],factorys=[],rjsext=/\.js$/i,rquery=/(\?[^#]*)$/,requireQueue=[],isUserFirstRequire=!1;innerRequire=avalon.require=function(array,factory,parentUrl,defineConfig){if(isUserFirstRequire){Array.isArray(array)||avalon.error("require方法的第一个参数应为数组 "+array);var deps=[],uniq={},id=parentUrl||"callback"+setTimeout("1");defineConfig=defineConfig||{},defineConfig.baseUrl=kernel.baseUrl;var isBuilt=!!defineConfig.built;if(parentUrl&&(defineConfig.parentUrl=parentUrl.substr(0,parentUrl.lastIndexOf("/")),defineConfig.mapUrl=parentUrl.replace(rjsext,"")),isBuilt){var req=makeRequest(defineConfig.defineName,defineConfig);id=req.urlNoQuery}else array.forEach(function(name){var req=makeRequest(name,defineConfig),url=fireRequest(req);url&&(uniq[url]||(deps.push(url),uniq[url]="司徒正美"))});var module=modules[id];module&&4===module.state||(modules[id]={id:id,deps:isBuilt?array.concat():deps,factory:factory||noop,state:3}),module||loadings.push(id),checkDeps()}else if(requireQueue.push(avalon.slice(arguments)),arguments.length<=2){isUserFirstRequire=!0;for(var args,queue=requireQueue.splice(0,requireQueue.length);args=queue.shift();)innerRequire.apply(null,args)}},innerRequire.define=function(name,deps,factory){"string"!=typeof name&&(factory=deps,deps=name,name="anonymous"),Array.isArray(deps)||(factory=deps,deps=[]);var config={built:!isUserFirstRequire,defineName:name},args=[deps,factory,config];factory.require=function(url){if(args.splice(2,0,url),modules[url]){modules[url].state=3;var isCycle=!1;try{isCycle=checkCycle(modules[url].deps,url)}catch(e){}isCycle&&avalon.error(url+"模块与之前的模块存在循环依赖，请不要直接用script标签引入"+url+"模块")}delete factory.require,innerRequire.apply(null,args)};var url=config.built?"unknown":getCurrentScript();if(url){var module=modules[url];module&&(module.state=2),factory.require(url)}else factorys.push(factory)},innerRequire.config=kernel,innerRequire.define.amd=modules;var allpaths=kernel["orig.paths"]={},allmaps=kernel["orig.map"]={},allpackages=kernel.packages=[],allargs=kernel["orig.args"]={};avalon.mix(plugins,{paths:function(hash){avalon.mix(allpaths,hash),kernel.paths=makeIndexArray(allpaths)},map:function(hash){avalon.mix(allmaps,hash);var list=makeIndexArray(allmaps,1,1);avalon.each(list,function(_,item){item.val=makeIndexArray(item.val)}),kernel.map=list},packages:function(array){array=array.concat(allpackages);for(var pkg,uniq={},ret=[],i=0;pkg=array[i++];){pkg="string"==typeof pkg?{name:pkg}:pkg;var name=pkg.name;if(!uniq[name]){var url=joinPath(pkg.location||name,pkg.main||"main");url=url.replace(rjsext,""),ret.push(pkg),uniq[name]=pkg.location=url,pkg.reg=makeMatcher(name)}}kernel.packages=ret.sort()},urlArgs:function(hash){"string"==typeof hash&&(hash={"*":hash}),avalon.mix(allargs,hash),kernel.urlArgs=makeIndexArray(allargs,1)},baseUrl:function(url){if(!isAbsUrl(url)){var baseElement=head.getElementsByTagName("base")[0];baseElement&&head.removeChild(baseElement);var node=DOC.createElement("a");node.href=url,url=getFullUrl(node,"href"),baseElement&&head.insertBefore(baseElement,head.firstChild)}url.length>3&&(kernel.baseUrl=url)},shim:function(obj){for(var i in obj){var value=obj[i];Array.isArray(value)&&(value=obj[i]={deps:value}),value.exportsFn||!value.exports&&!value.init||(value.exportsFn=makeExports(value))}kernel.shim=obj}});var rreadyState=/complete|loaded/,resources=innerRequire.plugins={domReady:{load:noop},js:{load:function(name,req,onLoad){var url=req.url,id=req.urlNoQuery,shim=kernel.shim[name.replace(rjsext,"")];shim?innerRequire(shim.deps||[],function(){var args=avalon.slice(arguments);loadJS(url,id,function(){onLoad(shim.exportsFn?shim.exportsFn.apply(0,args):void 0)})}):loadJS(url,id)}},css:{load:function(name,req,onLoad){var url=req.url,node=DOC.createElement("link");node.rel="stylesheet",node.href=url,head.insertBefore(node,head.firstChild),log("debug: 已成功加载 "+url),onLoad()}},text:{load:function(name,req,onLoad){var url=req.url,xhr=getXHR();xhr.onreadystatechange=function(){if(4===xhr.readyState){var status=xhr.status;status>399&&600>status?avalon.error(url+" 对应资源不存在或没有开启 CORS"):(log("debug: 已成功加载 "+url),onLoad(xhr.responseText))}};var time="_="+(new Date-0),_url=-1===url.indexOf("?")?url+"?"+time:url+"&"+time;xhr.open("GET",_url,!0),"withCredentials"in xhr&&(xhr.withCredentials=!0),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.send(),log("debug: 正准备加载 "+url)}}};innerRequire.checkDeps=checkDeps;var rcallback=/^callback\d+$/,rdeuce=/\/\w+\/\.\./,mainNode=DOC.scripts[DOC.scripts.length-1],dataMain=mainNode.getAttribute("data-main");if(dataMain){plugins.baseUrl(dataMain);var href=kernel.baseUrl;kernel.baseUrl=href.slice(0,href.lastIndexOf("/")+1),loadJS(href.replace(rjsext,"")+".js")}else{var loaderUrl=trimQuery(getFullUrl(mainNode,"src"));kernel.baseUrl=loaderUrl.slice(0,loaderUrl.lastIndexOf("/")+1)}};var isReady,readyList=[],fireReady=function(fn){for(isReady=!0,innerRequire&&(modules["domReady!"].state=4,innerRequire.checkDeps());fn=readyList.shift();)fn(avalon)};if("complete"===DOC.readyState)setTimeout(fireReady);else if(W3C)DOC.addEventListener("DOMContentLoaded",fireReady);else{DOC.attachEvent("onreadystatechange",function(){"complete"===DOC.readyState&&fireReady()});try{var isTop=null===window.frameElement}catch(e){}root.doScroll&&isTop&&window.external&&doScrollCheck()}avalon.bind(window,"load",fireReady),avalon.ready=function(fn){isReady?fn(avalon):readyList.push(fn)},avalon.config({loader:!0}),avalon.ready(function(){avalon.scan(DOC.body)}),"function"==typeof define&&define.amd&&define("avalon",[],function(){return avalon});var _avalon=window.avalon;return avalon.noConflict=function(deep){return deep&&window.avalon===avalon&&(window.avalon=_avalon),avalon},void 0===noGlobal&&(window.avalon=avalon),avalon});
//# sourceMappingURL=avalon.js.map