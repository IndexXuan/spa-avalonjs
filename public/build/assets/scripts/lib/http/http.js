!function(global,factory){"object"==typeof module&&"object"==typeof module.exports?module.exports=global.document?factory(global,!0):function(w){if(!w.document)throw new Error("$http requires a window with a document");return factory(w)}:factory(global)}("undefined"!=typeof window?window:this,function(window,noGlobal){function noop(){}function isEmptyObject(obj){for(var name in obj)if(obj.hasOwnProperty(name))return!1;return!0}function jsonToquerystring(data){for(var querystring="",keys=Object.keys(data),str="",i=0,len=keys.length;len>i;i++){var key=keys[i];str+=keys[i]+"="+data[key]+"&"}return querystring=str.substring(0,str.length-1)}function parseUrl(url,data){var hasQueryString=url.indexOf("?")>=0;return url+=hasQueryString?isEmptyObject(data)?"&cache="+Date.now():"&"+jsonToquerystring(data)+"&cache="+Date.now():isEmptyObject(data)?"?cache="+Date.now():"?"+jsonToquerystring(data)+"&cache="+Date.now()}function parseJSON(str){try{return JSON.parse(str+"")}catch(e){return console.log("JSON PARSE ERROR! "+str),str}}function setHeaders(xhr,headers){if(!isEmptyObject(headers))for(var keys=Object.keys(headers),x=0,len=keys.length;len>x;x++){var key=keys[x],val=headers[key];xhr.setRequestHeader(keys[x],val)}}var getXHR=function(){var xhr=new XMLHttpRequest;return xhr},argsToConfigObj=function(arr){return{method:arr[0],url:arr[1],data:arr[2],beforeSend:arr[3],headers:arr[4],success:arr[5],error:arr[6],ajaxFail:arr[7],timeout:arr[8]}},request=function(method,url,data,beforeSend,headers,success,error,ajaxFail,timeout){var xhr=getXHR(),oldSettings=argsToConfigObj(arguments),newSettings=$http.requestInterceptor(oldSettings,xhr)||oldSettings;method=newSettings.method.toUpperCase(),data=newSettings.data||{},beforeSend=newSettings.beforeSend||noop,headers=newSettings.headers||{},success=newSettings.success||noop,error=newSettings.error||noop,ajaxFail=newSettings.ajaxFail||noop,timeout=1e3*(newSettings.timeout||15),xhr.open(method,"GET"===method?parseUrl(url,data):url,!0),xhr.onreadystatechange=function(){var msg="inner onreadystatechange";4===xhr.readyState&&(200===xhr.status?(msg="xhr "+method+" success in "+url,$http.log(msg),ajaxTimer&&clearTimeout(ajaxTimer),success(parseJSON(xhr.responseText)),$http.resolveInterceptor()):(msg="xhr "+method+" failed in "+url,$http.log(msg),$http.rejectInterceptor(parseJSON(xhr.responseText)),error(parseJSON(xhr.responseText))))},beforeSend(xhr),xhr.setRequestHeader("Content-Type","application/json"),setHeaders(xhr,headers),xhr.send("GET"!==method?JSON.stringify(data):null);var ajaxTimer=setTimeout(function(){xhr.abort();var msg="xhr "+method+" abort when timeout in "+timeout/1e3+" seconds, with url "+url;$http.log(msg)},timeout);xhr.onerror=function(){$http.rejectInterceptor();var msg="xhr "+method+" error in "+url;$http.log(msg),ajaxFail(xhr.response)}},$http={debug:!1,log:function(msg){this.debug&&console.log(msg)},requestInterceptor:noop,resolveInterceptor:noop,rejectInterceptor:noop,get:function(settings){request("GET",settings.url,settings.data,settings.beforeSend,settings.headers,settings.success,settings.error,settings.ajaxFail,settings.timeout)},post:function(settings){request("POST",settings.url,settings.data,settings.beforeSend,settings.headers,settings.success,settings.error,settings.ajaxFail,settings.timeout)},ajax:function(settings){request(settings.method||"GET",settings.url,settings.data,settings.beforeSend,settings.headers,settings.success,settings.error,settings.ajaxFail,settings.timeout)}};"function"==typeof define&&define.amd&&define("$http",[],function(){return $http});var _http=window.$http;return $http.noConflict=function(deep){return deep&&window.$http===$http&&(window.$http=_http),$http},void 0===noGlobal&&(window.$http=$http),$http});
//# sourceMappingURL=http.js.map